C.r("mdx2/components/mdxControls.jsx",function(t,e,n){"use strict";var i=t("babel-runtime/helpers/extends"),s=function(t){return t&&t.__esModule?t:{default:t}}(i),o=t("./mdxStatus.jsx"),a=t("./mdxPostplay.jsx"),r=t("../utils/mdxConstants"),l=t("./mdxProgressBar.jsx"),c=t("./mdxVolume.jsx"),p=t("./mdxTimeRemaining.jsx"),d=t,u=d("react"),m=d("create-react-class"),h=d("prop-types"),g=d("react-dom"),x=d("lodash"),f=d("classnames"),y=d("../../akira/utils/linkDefs.jsx"),E=d("../../player/components/pinEntry.jsx"),T=d("../../player/nfplayer/common/PlayerUIState"),S=d("../../player/nfplayer/components/controls/audioSubtitlePopup.jsx"),b=d("../../player/nfplayer/components/controls/episodes.jsx"),C=d("../../player/nfplayer/components/controls/play.jsx"),v=d("../../player/nfplayer/components/controls/popup.jsx"),P=d("../../player/nfplayer/components/controls/stop.jsx"),I=d("../../player/nfplayer/components/controls/mdx.jsx"),k=d("../../player/nfplayer/components/playerSurface.jsx"),N=d("../../player/nfplayer/components/svgDefs.jsx"),A=d("../../player/nfplayer/mixins/controlFocus.js"),D=d("../../player/nfplayer/components/hoc/withEffects.jsx"),_=d("../../player/nfplayer/utils/getDefaultStaticConfig.js"),M=d("../../player/nfplayer/utils/playerKeyDownHandler.js"),V=d("../../player/session/sessionManager.js"),j=d("../../akira/containers/timeoutTransition/timeoutTransitionGroup.jsx"),w=d("../../utils/shallowCompare.js"),L=d("../../akira/components/hoc/withUpdateDimensions.jsx"),U=d("../../components/focusTrap.jsx"),O=d("../../player/components/adultVerificationPrompt.jsx"),R=d("../../utils/Routes"),K=d("../../player/nfplayer/types/staticConfiguration"),H={MDX_POSTPLAY_STATE:"mdx-postplay-state",MDX_PLAY_STATE:"mdx-play-state",MDX_CONNECTED_STATE:"mdx-connected-state",MDX_DISCONNECTED_STATE:"mdx-disconnected-state",MDX_PLAYBACK_UNAVAILABLE:"mdx-playback-unavailable"},B="discovery/akira/Mdx",F=m({displayName:"MdxControls",getInitialState:function(){return{staticConfiguration:_({geo:this.context.getModelData("geo"),browserInfo:this.context.getModelData("browserInfo"),loggingPlayerType:"mdx",playbackSupport:this.context.getModelData("playerModel","playbackSupport")})}},childContextTypes:{staticConfiguration:K},getChildContext:function(){return{staticConfiguration:this.state.staticConfiguration}},mixins:[A],shouldComponentUpdate:w.pureRender,contextTypes:{getI18nString:h.func.isRequired,getModelData:h.func.isRequired,history:h.object.isRequired,isKidsPage:h.bool,models:h.object.isRequired,routeHandler:h.object.isRequired},componentWillReceiveProps:function(t){var e=this.props,n=e.mdxTarget,i=e.initParams,s=x.get(i,"pinConfig.isAdultVerified",!0),o=x.get(i,"pinConfig.isEnabled",!0),a=!V.isExpired(V.SESSION_TYPES.PIN);s&&!o||t.adultVerification||"boolean"!=typeof t.adultVerification||(a||!t.isPinProtected&&"boolean"==typeof t.isPinProtected)&&(t.isPinProtected&&!a&&t.adultVerification||n.resumeCast())},onClick:function(t){"INPUT"!==t.target.nodeName&&g.findDOMNode(this).focus()},onPlayClick:function(t){this.props.paused?this.props.mdxTarget.play():this.props.mdxTarget.pause()},getTargetId:function(){return x.get(this,"props.ancestorSummary.id",x.get(this,"props.videoSummary.id"))},onStatusClick:function(){var t=this.getTargetId();t&&(this.context.history.pushState(y.getTitleRoute(this.context.models,this.context.isKidsPage).makePath({id:t})),window.scrollTo(0,0))},onEpisodesClick:function(){var t=this.getTargetId(),e=this.props,n=e.mdxTarget,i=e.mdxManager,s=this.context.routeHandler,o=s.route===R.titleShowEpisodes||s.route===R.title,a=o&&s.params&&s.params.id?parseInt(s.params.id,10):void 0,r=o&&t&&a&&!isNaN(a)&&a!==t;!o||r?(window.scrollTo(0,0),this.context.history.pushState(y.getEpisodeRoute(this.context.models,this.context.isKidsPage).makePath({id:t}))):n&&i&&(window.scrollTo(0,0),i.emit(i.EVENTS.SHOW_EPISODES))},onStopClick:function(){this.props.mdxTarget.stop()},onPostplayClick:function(){this.props.mdxTarget.cast(this.props.nextVideoId,this.props.trackId,!1,{})},setAudioTrack:function(t){this.props.mdxTarget.setAudioTrack(t)},setSubtitleTrack:function(t){this.props.mdxTarget.setTimedTextTrack(t)},componentDidMount:function(){g.findDOMNode(this).focus()},getStatusString:function(){var t=this.props.mdxTarget,e=void 0;if(x.isNumber(this.props.nextVideoId))e=this.context.getI18nString(B,"mdx-postplay-status",{DEVICE_NAME:this.props.deviceName});else switch(this.props.currentState){case t.DEVICE_STATES.PLAY:case t.DEVICE_STATES.PROGRESS:e=this.context.getI18nString(B,"mdx2-description-loading",{DEVICE_NAME:this.props.deviceName});break;case t.DEVICE_STATES.PAUSE:e=this.context.getI18nString(B,"mdx2-description-paused",{DEVICE_NAME:this.props.deviceName});break;case t.DEVICE_STATES.PLAYING:default:e=this.context.getI18nString(B,"mdx2-description-playing",{DEVICE_NAME:this.props.deviceName})}return e+" "},isEpisodic:function(){var t=this.props.videoSummary;return t&&"episode"===t.type},getTitleString:function(t){var e=this.props,n=e.videoSummary,i=e.videoTitle,s=e.nextVideoTitle,o=e.nextVideoSummary,a=e.ancestorTitle,r=this.isEpisodic(),l=null;if(r&&a){var c=void 0,p=void 0,d=void 0;o?(c=o.episode,p=o.season,d=s):n&&(c=n.episode,p=n.season,d=i);l=a+" "+this.context.getI18nString(B,"mdx-loading-show-title",{SEASON:p,EPISODE:c,TITLE:d})}else(s||i)&&(l=s||i);return l},getNFPlayerNode:function(){return g.findDOMNode(this)},onValidPin:function(){this.props.mdxTarget.validPin()},onPinCancel:function(){this.props.mdxTarget.cancelPin()},onAgeVerifyCancel:function(){this.props.mdxTarget.resetCurrentContentId()},handleWatchLocal:function(){var t=this.props,e=t.mdxTarget,n=t.unavailableVideoId,i=t.unavailableTrackId;e&&n&&e.disconnect(function(t){t||(window.location=R.watchNow.makePath({id:n},{trkid:i||0}))})},handleCancelUnavailablePlayback:function(){this.props.mdxTarget&&this.props.mdxTarget.clearUnavailablePlayback()},renderAudioSubtitleButton:function(t){return this.props.audioList.length>0||this.props.subtitleList>0?u.createElement(v,(0,s.default)({},t,{ariaLabel:this.context.getI18nString("player/player","button.audio.subtitles"),iconName:"nfplayerSubtitles",focusName:A.AUDIO_SUBTITLE,popupHasStaticPosition:!0,positionedAtTop:!0}),u.createElement(S,(0,s.default)({},t,{setAudioTrack:this.setAudioTrack,setSubtitleTrack:this.setSubtitleTrack,audioList:this.props.audioList,subtitleList:this.props.subtitleList}))):null},renderStatus:function(){var t=this.getTitleString();return t?u.createElement(o,{onClick:this.onStatusClick,status:this.getStatusString(),title:t}):null},renderPrompts:function(){var t=this.props,e=t.initParams,n=t.adultVerification,i=t.showPinEntry,s=t.isPinProtected,o=x.get(e,"pinConfig.isAdultVerified",!0),a=x.get(e,"pinConfig.isEnabled",!0),r=!V.isExpired(V.SESSION_TYPES.PIN);return!o&&n?u.createElement(U,null,u.createElement(O,{isRTL:this.state.staticConfiguration.isRTL,videoId:this.props.contentId,adultVerificationURL:x.get(this,"props.initParams.pinConfig.adultVerificationUrl",R.verifyAge.makePath()),onCancel:this.onAgeVerifyCancel})):i||a&&s&&!r?u.createElement(U,null,u.createElement(E,{onValidPinEntry:this.onValidPin,onCancel:this.onPinCancel,apiEndpoint:this.props.initParams.pinConfig.apiEndpoint,resetURL:this.props.initParams.pinConfig.resetUrl})):null},renderControls:function(t){var e=this.isEpisodic();return u.createElement("div",{key:"mdx-controls",className:"controls"},u.createElement(k,{ref:"controlsContainer",className:f({"main-controls":!0,active:this.props.isActive,inactive:!this.props.isActive})},this.renderStatus(),u.createElement(a,{inPostplay:this.props.inPostplay,onClick:this.onPostplayClick}),u.createElement("div",{className:f("controls-container","bottom-controls")},u.createElement(C,(0,s.default)({},t,{onClick:this.onPlayClick,ref:"playButton"})),u.createElement(c,(0,s.default)({},t,{ref:"volumeButton"})),u.createElement(P,(0,s.default)({},t,{onClick:this.onStopClick,ref:"stopButton"})),u.createElement(l,(0,s.default)({},t,{buffered:this.props.runtime,duration:this.props.runtime})),u.createElement(p,(0,s.default)({},t,{duration:this.props.runtime})),e&&u.createElement(b,(0,s.default)({},t,{onClick:this.onEpisodesClick,ref:"episodesButton"})),this.renderAudioSubtitleButton(t),u.createElement(I,(0,s.default)({},t,{connected:!0,videoId:this.props.contentId}))),this.renderPrompts()))},renderDefaultStatus:function(){var t=this.context.getI18nString(B,"mdx-device-connected",{DEVICE_NAME:this.props.deviceName}),e=this.context.getI18nString(B,"mdx-device-connected-instruction");return u.createElement("div",{key:"mdx-connected-status",className:"controls connected-status"},u.createElement("h3",null,t),u.createElement("h4",null,e))},renderPlaybackUnavailableStatus:function(){var t=this.context.getI18nString(B,"mdx-playback-unavailable-branching-watch-here"),e=this.context.getI18nString(B,"mdx-playback-unavailable-branching-cancel");return u.createElement("div",{key:"mdx-playback-unavailabe",className:"controls connected-status"},u.createElement("h3",{className:"mdx-playback-unavailable-title"},this.context.getI18nString(B,"mdx-playback-unavailable-branching-title")),u.createElement("h4",{className:"mdx-playback-unavailable-message"},this.context.getI18nString(B,"mdx-playback-unavailable-branching-message")),u.createElement("div",{className:"mdx-controls-actions-container"},u.createElement("button",{"aria-label":t,type:"button",tabIndex:0,className:"MdxControls__button MdxControls__button--primary",onClick:this.handleWatchLocal},t),u.createElement("button",{"aria-label":e,type:"button",tabIndex:0,className:"MdxControls__button",onClick:this.handleCancelUnavailablePlayback},e)))},onKeyDown:function(t){M(t,{allowManualLogging:this.props.allowManualLogging,currentScrubTime:-1,disableKeyHandler:{},ended:this.props.ended,logKeyDownEvent:this.props.logKeyDownEvent,playbackTimedOut:!1,playerElement:this.getNFPlayerNode(),playerInstance:this.props.mdxTarget,scrubbing:this.props.scrubbing,setKeepActive:x.noop,started:this.props.started})},render:function(){var t=x.assign({onClick:x.noop,startHover:this.startHover,stopHover:this.stopHover,hovered:this.state.hovered,grabFocus:this.grabFocus,releaseFocus:this.releaseFocus,focused:this.state.focused,player:this.props.mdxTarget,grabAndHoldFocus:this.grabAndHoldFocus,releaseFocusHold:this.releaseFocusHold,setKeepActive:x.noop,delay:2e3,uiState:T.ACTIVE,dimensions:this.props.dimensions},this.props),e=void 0,n=void 0;return this.props.connected?t.playbackUnavailableReason?(e=this.renderPlaybackUnavailableStatus(),n=H.MDX_PLAYBACK_UNAVAILABLE):this.props.contentId||this.props.showPinEntry?(e=this.renderControls(t),n=this.props.inPostplay?H.MDX_POSTPLAY_STATE:H.MDX_PLAY_STATE):(e=this.renderDefaultStatus(),n=H.MDX_CONNECTED_STATE):(e=null,n=H.MDX_DISCONNECTED_STATE),u.createElement("div",{className:f("mdx-controls-bar-container",n),tabIndex:-1,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onClick:this.onClick},N(this.context.models),u.createElement(j,{component:"div",transitionName:"mdx-controls-trans",transitionAppear:!0,enterTimeout:r.TRANSITION_DURATION,leaveTimeout:r.TRANSITION_DURATION},e))}});e.exports=D(L(F))});C.r("mdx2/components/mdxPostplay.jsx",function(t,e,s){"use strict";var n=t,o=n("react"),a=n("create-react-class"),r=n("prop-types"),p=n("classnames"),l=n("../../common/svgIcon.jsx"),c=n("../../utils/shallowCompare"),i=a({displayName:"MdxPostplay",statics:{BUNDLE:"discovery/akira/Mdx"},contextTypes:{getI18nString:r.func.isRequired},shouldComponentUpdate:c.pureRender,render:function(){var t=this.props.inPostplay?o.createElement("button",{className:"MdxControls__button MdxControls__button--primary",onClick:this.props.onClick},o.createElement(l,{name:"nfplayerPlay"}),this.context.getI18nString(i.BUNDLE,"mdx-postplay-prompt")):null;return o.createElement("div",{className:p("mdx-postplay-container",{"mdx-postplay-showing":this.props.inPostplay})},t)}});e.exports=i});C.r("mdx2/components/mdxProgressBar.jsx",function(r,e,t){"use strict";var o=r,s=o("react"),n=o("create-react-class"),a=(o("prop-types"),o("react-dom")),i=(o("lodash"),o("classnames")),p=o("../../player/nfplayer/components/controls/horizontalScrubber.jsx"),l=o("../../common/keyCodes"),c=o("../../player/nfplayer/mixins/controlFocus"),u=o("../../player/nfplayer/utils/time"),d=o("../../utils/shallowCompare"),h=o("../../player/nfplayer/common/PlayerUIState"),S=o("../../player/nfplayer/common/playerControls"),y=n({displayName:"ProgressBar",statics:{CONTROL_NAME:S.PROGRESS_BAR},shouldComponentUpdate:d.partialProps(["duration","currentTime","buffered","player","playerDimensions","uiState","hovered","focused"]),handleMouseEnter:function(r){var e=this.props,t=e.startHover,o=e.grabFocus,s=e.onPointerEnter;t(c.PROGRESS),o(c.PROGRESS),s&&s(r)},handleMouseLeave:function(r){var e=this.props,t=e.releaseFocus,o=e.stopHover,s=e.onPointerLeave;t(c.PROGRESS),o(c.PROGRESS),s&&s(r)},handleScrubStart:function(r){this.props.onScrubStart&&this.props.onScrubStart(r);var e=this.props,t=e.grabAndHoldFocus,o=e.setKeepActive,s=e.player;t(c.PROGRESS),o(!0),s.scrubStart(this.props.duration*r)},handleScrubEnd:function(r){var e=this.props,t=e.duration,o=e.onScrubEnd,s=e.player,n=e.releaseFocusHold,a=e.setKeepActive;o&&o(r),n(c.PROGRESS),a(!1),r?s.scrubEnd(t*r):s.scrubEnd(void 0)},handleScrub:function(r){var e=this.props,t=e.duration;e.player.scrub(t*r)},handleKeyDown:function(r){var e=r.keyCode;a.findDOMNode(this.refs.scrubber)!==document.activeElement||e!==l.ENTER&&e!==l.SPACE||(r.preventDefault(),this.props.player.togglePlay())},trickplayGenerator:function(r){if(!this.props.player)return{};var e=this.props.player.getTrickPlayURL(this.props.duration*r);return e?{image:e,text:u.convert(this.props.duration*r)}:{text:u.convert(this.props.duration*r)}},render:function(){return s.createElement("div",{className:i("PlayerControls--control-element","progress-control",{"PlayerControls--control-element-hidden":this.props.uiState!==h.ACTIVE,"PlayerControls--control-element-blurred":this.props.focused&&c.PROGRESS!==this.props.focused}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},s.createElement(p,{ref:"scrubber",isScrubbing:this.props.scrubbing,onScrub:this.handleScrub,onScrubStart:this.handleScrubStart,onScrubEnd:this.handleScrubEnd,onKeyDown:this.handleKeyDown,duration:this.props.duration,currentPlayerTime:this.props.currentTime,buffered:this.props.buffered,playerDimensions:this.props.playerDimensions,trickplayGenerator:this.trickplayGenerator}))}});e.exports=y});C.r("mdx2/components/mdxStatus.jsx",function(t,e,n){"use strict";var i=t("../utils/mdxConstants"),a=t,s=a("react"),o=a("create-react-class"),r=(a("prop-types"),a("lodash")),u=a("../../akira/containers/timeoutTransition/timeoutTransitionGroup.jsx"),p=o({displayName:"MdxStatus",getInitialState:function(){return{transitioning:!1}},componentDidUpdate:function(){this.updateTransitionState(!0)},updateTransitionState:function(t){this.setState({transitioning:t})},shouldComponentUpdate:function(t,e){return!e.transitioning&&(t.status!==this.props.status||t.title!==this.props.title)},afterTransitionLeave:function(){this.updateTransitionState(!1)},render:function(){return s.createElement(u,{component:"div",transitionAppear:!0,transitionName:"mdx-status",afterTransitionLeave:this.afterTransitionLeave,enterTimeout:i.TRANSITION_DURATION,leaveTimeout:i.TRANSITION_DURATION},s.createElement("div",{key:r.uniqueId("mdx-status-"),className:"title-name-container"},s.createElement("strong",null,this.props.status),s.createElement("a",{onClick:this.props.onClick},this.props.title)))}});e.exports=p});C.r("mdx2/components/mdxTimeRemaining.jsx",function(e,t,r){"use strict";var o=e,a=o("react"),n=o("create-react-class"),s=(o("prop-types"),o("lodash"),o("../../player/nfplayer/utils/time")),l=o("classnames"),i=o("../../utils/shallowCompare"),p=o("../../player/nfplayer/mixins/controlFocus"),m=o("../../player/nfplayer/common/PlayerUIState"),c=o("../../player/nfplayer/common/playerControls"),u=n({displayName:"TimeRemaining",statics:{CONTROL_NAME:c.TIME_REMAINING},shouldComponentUpdate:i.partialProps(["duration","currentTime","uiState","focused"]),render:function(){var e=void 0;return e=this.props.duration?s.convert(this.props.duration-this.props.currentTime):"0:00",a.createElement("div",{className:l("PlayerControls--control-element","time-remaining","text-control",{"PlayerControls--control-element-hidden":this.props.uiState!==m.ACTIVE,"PlayerControls--control-element-blurred":this.props.focused&&p.PROGRESS!==this.props.focused})},a.createElement("time",{className:"time"},e))}});t.exports=u});C.r("mdx2/components/mdxVolume.jsx",function(e,o,t){"use strict";var n=e,r=n("../../player/nfplayer/components/controls/button.jsx"),s=n("../../utils/shallowCompare"),l=n("../../player/nfplayer/mixins/controlFocus"),i=n("../../player/nfplayer/common/playerControls"),u=n("../../player/nfplayer/components/controls/popup.jsx"),a=n("react"),p=n("create-react-class"),c=n("prop-types"),d=n("../../player/nfplayer/components/controls/volumeController.jsx"),m=n("../../player/nfplayer/components/hoc/withEffects.jsx"),h=m(u),y=p({displayName:"MdxVolumeButton",contextTypes:{getI18nString:c.func.isRequired},statics:{CONTROL_NAME:i.VOLUME},oldVolume:null,shouldComponentUpdate:s.partialProps(["focused","hovered","isHidden","muted","player","volume"]),getDefaultProps:function(){return{isHidden:!1}},handleScrubStart:function(e){var o=this.props.onScrubStart;this.props.grabAndHoldFocus(l.VOLUME),this.props.setKeepActive(!0),this.oldVolume=this.props.volume,this.setVolume(e),o&&o(e)},handleScrubEnd:function(e){var o=this.props,t=o.releaseFocusHold,n=o.setKeepActive,r=o.onScrubEnd;t(l.VOLUME),n(!1),e&&this.setVolume(e),r&&r(e)},handleScrub:function(e){var o=this.props.onScrub;this.setVolume(e),o&&o(e)},setVolume:function(e){0===e?(this.props.player.setMuted(!0),this.props.player.setVolume(this.oldVolume?this.oldVolume:0)):(this.props.player.setMuted(!1),this.props.player.setVolume(e))},toggleMute:function(){this.props.player.toggleMute()},render:function(){var e=this.props,o=e.caretPosition,t=e.delay,n=e.focused,s=e.grabFocus,i=e.holdingFocus,u=e.hovered,p=e.isHidden,c=e.muted,y=e.onClick,v=e.onClickCapture,b=e.onDoubleClickCapture,f=e.onKeyDownCapture,g=e.onKeyUp,C=e.releaseFocus,S=e.setKeepActive,V=e.startHover,M=e.stopHover,x=e.tooltipAlignment,E=e.tooltipPosition,H=e.volume,L=void 0;L=c?"volumeMuted":H>.666?"volumeMax":H>.333?"volumeMedium":"volumeLow";var A=this.context.getI18nString("player/player","button.volume"+(c?".muted":""));return a.createElement(h,{ariaLabel:A,buttonType:"default",commandLoggingName:m.VOLUME,delay:t,focused:n,focusName:l.VOLUME,grabFocus:s,positionedAtTop:!0,holdingFocus:i,hovered:u,iconName:L,isHidden:p,noPadding:!0,onButtonClick:this.toggleMute,onClick:y,onClickCapture:v,onDoubleClickCapture:b,onKeyDownCapture:f,onKeyUp:g,releaseFocus:C,setKeepActive:S,startHover:V,stopHover:M,tabIndex:0,tooltip:A,tooltipAlignment:x,tooltipPosition:E},n===l.VOLUME&&a.createElement(d,{caretPosition:o,muted:c,onScrub:this.handleScrub,onScrubEnd:this.handleScrubEnd,onScrubStart:this.handleScrubStart,volume:H},a.createElement(r,{ariaLabel:A,iconName:L,isHidden:!1,onClick:this.toggleMute,tabIndex:0,type:"default"})))}});o.exports=y});C.r("mdx2/hoc/mdxTargetData.jsx",function(t,e,n){"use strict";function i(t){t.getPaths=t.getPaths?t.getPaths:function(){return[]};var e=l(t,{autoFetch:!0,usePqls:!0});return u({displayName:"MdxTargetData("+t.displayName+")",shouldComponentUpdate:c.pureRender,getInitialState:function(){return d.assign({runtime:0,currentTime:0,paused:!1,connected:!1,statusTransitioning:!1,player:this.props.mdxTarget},this.props.mdxTarget.state)},componentDidMount:function(){this.props.mdxTarget.on(this.props.mdxTarget.EVENTS.STATE_CHANGED,this.onStateChange)},componentWillUnmount:function(){this.props.mdxTarget.removeListener(this.props.mdxTarget.EVENTS.STATE_CHANGED,this.onStateChange)},getVideoId:function(){return this.state.contentId||this.state.nextVideoId},getPqls:function(){var t=this.state.contentId,e=this.state.nextVideoId;if(!t)return null;var n={videoSummary:["videos",t,"current","summary"],videoTitle:["videos",t,"current","title"],ancestorSummary:["videos",t,"ancestor","summary"],ancestorTitle:["videos",t,"ancestor","title"],isPinProtected:["videos",t,"current","pinProtected"],adultVerification:["videos",t,"current","adultVerification"]};return e&&(n.nextVideoSummary=["videos",e,"summary"],n.nextVideoTitle=["videos",e,"title"]),n},onStateChange:function(t){this.setState(t)},render:function(){var t=this.getPqls(),n=this.getVideoId(),i=d.values(t),r=n?{}:{ancestorSummary:null,videoSummary:null,ancestorTitle:null,videoTitle:null,nextVideoSummary:null,nextVideoTitle:null,isPinProtected:null,adultVerification:null};return o.createElement(e,(0,s.default)({},this.state,this.props,r,{mappedPqls:t,paths:i}))}})}var r=t("babel-runtime/helpers/extends"),s=function(t){return t&&t.__esModule?t:{default:t}}(r),a=t,o=a("react"),u=a("create-react-class"),d=(a("prop-types"),a("lodash")),l=a("../../akira/utils/setDataAsProps.jsx"),c=a("../../utils/shallowCompare.js");e.exports=i});C.r("mdx2/mdx2ConnectionLogging.js",function(e,n,t){"use strict";var i=e("./utils/mdxConstants.js"),o=e("./utils/mdxException"),c=e("./utils/mdxLogblob"),r=function(e,n,t,i){this.RxObservable=i,this.mdxManager=e,this.initParams=n,c.setMdxVersion(t),this.mdxManager.on(this.mdxManager.EVENTS.NEW_DEVICE_AVAILABLE,this.onNewDeviceAvailable.bind(this))};r.prototype.logConnectEvent=function(){var e=this,n={startTime:Date.now()};this.connectToDeviceSubscription&&this.connectToDeviceSubscription.error({errorcode:i.ERROR_CODES.CONNECTION_CANCELED}),this.connectToDeviceSubscription=this.RxObservable.of({}).flatMap(function(){return e.RxObservable.create(function(t){return e.mdxManager.on(e.mdxManager.EVENTS.NEW_DEVICE_AVAILABLE,function(e){n.sdkConnected=Date.now(),n.deviceId=e.id,n.deviceName=e.friendlyName,t.next(),t.complete()}),function(){}}).timeoutWith(e.initParams.castSdkConnectTimeout,e.RxObservable.throw({errorcode:i.ERROR_CODES.SDK_CONNECTION_TIMEOUT,timeout:e.initParams.castSdkConnectTimeout}))}).flatMap(this.createObservableFromMdxConnectToAppEvent.bind(this)).do(function(t){n.mdxConnected=Date.now(),n.launchSource=e.mdxManager.launchSource(),n.usermismatch=t.usermismatch}).timeoutWith(this.initParams.mdxConnectionTimeout,this.RxObservable.throw({errorcode:i.ERROR_CODES.MDX_CONNECTION_TIMEOUT,timeout:this.initParams.mdxConnectionTimeout,castsdkdelay:n.sdkConnected?n.sdkConnected-n.startTime:void 0,deviceid:n.deviceId,devicename:n.deviceName})).subscribe(function(){},function(t){var r=void 0;if(t.errorcode)r=t;else{var d=t;r={errorcode:i.ERROR_CODES.UNHANDLED_EXCEPTION,errordetails:o.exceptionToString(d)}}r.uilaunchorigin=n.launchSource,c.queue("connect","error",r),c.flush(),e.connectToDeviceSubscription=void 0},function(){c.queue("connect","info",{castsdkdelay:n.sdkConnected?n.sdkConnected-n.startTime:void 0,mdxdelay:n.mdxConnected&&n.sdkConnected?n.mdxConnected-n.sdkConnected:void 0,delay:n.mdxConnected?n.mdxConnected-n.startTime:void 0,deviceid:n.deviceId,devicename:n.deviceName,uilaunchorigin:n.launchSource,usermismatch:n.usermismatch}),e.connectToDeviceSubscription=void 0})},r.prototype.onNewDeviceAvailable=function(e){this.connectToDeviceSubscription||this.logReconnectEvent(e)},r.prototype.logReconnectEvent=function(e){this.reconnectToDeviceSubscription&&this.reconnectToDeviceSubscription.error({errorcode:i.ERROR_CODES.CONNECTION_CANCELED});var n={startTime:Date.now(),deviceId:e.id,deviceName:e.friendlyName};this.reconnectToDeviceSubscription=this.RxObservable.of({}).flatMap(this.createObservableFromMdxConnectToAppEvent.bind(this)).do(function(e){n.mdxConnected=Date.now(),n.usermismatch=e.usermismatch}).timeoutWith(this.initParams.mdxConnectionTimeout,this.RxObservable.throw({errorcode:i.ERROR_CODES.MDX_CONNECTION_TIMEOUT,timeout:this.initParams.mdxConnectionTimeout,deviceid:n.deviceId,devicename:n.deviceName})).subscribe(function(){},function(e){var t=void 0;if(e.errorcode)t=e;else{var r=e;t={errorcode:i.ERROR_CODES.UNHANDLED_EXCEPTION,errordetails:o.exceptionToString(r)}}t.delay=Date.now()-n.startTime,c.queue("reconnect","error",t),c.flush()},function(){c.queue("reconnect","info",{delay:n.mdxConnected?n.mdxConnected-n.startTime:void 0,deviceid:n.deviceId,devicename:n.deviceName,usermismatch:n.usermismatch})})},r.prototype.logDisconnectEvent=function(){var e=this;this.disconnectDeviceSubscription&&this.disconnectDeviceSubscription.error({errorcode:i.ERROR_CODES.CONNECTION_CANCELED});var n={startTime:Date.now()};this.disconnectDeviceSubscription=this.RxObservable.of({}).flatMap(function(){return e.RxObservable.create(function(t){return e.mdxManager.on(e.mdxManager.EVENTS.TARGET_CONNECTION_CHANGED,function(e,i){e||(n.disconnected=Date.now(),i&&i.device&&(n.deviceId=i.device.id,n.deviceName=i.device.friendlyName),t.next(),t.complete())}),function(){}}).timeoutWith(e.initParams.castSdkDisconnectTimeout,e.RxObservable.throw({errorcode:i.ERROR_CODES.DISCONNECT_TIMEOUT,timeout:e.initParams.castSdkDisconnectTimeout}))}).subscribe(function(){},function(e){var n=void 0;if(e.errorcode)n=e;else{var t=e;n={errorcode:i.ERROR_CODES.UNHANDLED_EXCEPTION,errordetails:o.exceptionToString(t)}}c.queue("disconnect","error",n),c.flush()},function(){c.queue("disconnect","info",{delay:n.disconnected?n.disconnected-n.startTime:void 0,deviceid:n.deviceId,devicename:n.deviceName})})},r.prototype.createObservableFromMdxConnectToAppEvent=function(){var e=this;return this.RxObservable.create(function(n){var t=function(e,t){e&&(n.next(t),n.complete())},c=function(e){n.error({errorcode:i.ERROR_CODES.MDX_CONNECT_FAILED,errordetails:o.exceptionToString(e)})};return e.mdxManager.on(e.mdxManager.EVENTS.TARGET_CONNECTION_CHANGED,t),e.mdxManager.on(e.mdxManager.EVENTS.TARGET_CONNECTION_FAILED,c),function(){e.mdxManager.removeListener(e.mdxManager.EVENTS.TARGET_CONNECTION_CHANGED,t),e.mdxManager.removeListener(e.mdxManager.EVENTS.TARGET_CONNECTION_FAILED,c)}})},n.exports=r});C.r("mdx2/mdx2Manager.js",function(e,t,i){"use strict";var n=e("nf-mdx"),s=e("./mdx2Target.js"),a=e("./utils/mdxLog.js"),o=e("./mdx2ConnectionLogging"),c=e,r=c("lodash"),E=c("nf-cons-log"),u=c("../utils/rx/shakti-rx").RxObservable,d=c("../utils/rx/shakti-rx").RxSubject,T=c("../utils/profileManager.js"),l=c("../reactMixins/eventBus.js"),g=c("../player/session/sessionManager.js"),A=c("shakti-platform/dist/ui/ShaktiProperties"),h=function(e,t,i,s){var c=A.get("wwwplayer.config.ui.mdx.log.level");this.mdxApi=new n(n.PLATFORMS.CADMIUM_CONTROLLER),this.initParams=i,this.mdxApi.addEventListener(n.EVENTS.MDX_DEVICES_AVAILABLE,this.onMdxDevicesAvailable.bind(this)),this.mdxApi.addEventListener(n.EVENTS.DEVICE_AVAILABLE,this.onDeviceAvailable.bind(this)),this.mdxApi.addEventListener(n.EVENTS.START_CONNECTING,this.onStartConnectingToDevice.bind(this)),this.mdxApi.addEventListener(n.EVENTS.START_DISCONNECTING,this.onStartDisconnectingDevice.bind(this)),this.mdxApi.configure({logLevel:c&&n.LOG_LEVELS[c]||n.LOG_LEVELS.TRACE,profileId:t}),this.mdxConnectionLogging=new o(this,i,this.mdxApi.config.version,u);var r=this;this.mdxApi.start({platformMdxLib:e.mdx}).done(function(){r.mdxInitTime=Date.now(),a("MDX initialization complete. Ready for communication."),s({success:!0})},function(e){a("MDX failed to start"),a(e),s({success:!1,error:e})}),this.connectToDeviceSubscription=void 0},v=function(e){r.isFunction(r.get(E,"clientNotifications.notify"))&&E.clientNotifications.notify("mdx2event",e)};h.prototype={state:{deviceLaunchInFlight:!1,mdxDevicesFound:!1,currentTarget:null},targetDisposedObs:new d,setCurrentTarget:function(e){var t=this.state.currentTarget;if(t&&(t.destroy(),this.targetDisposedObs.next()),e){t=new s(e,this.initParams),this.state.currentTarget=t;var i=e.CONNECT_INTENTS.JOIN;this.state.deviceLaunchInFlight&&(this.state.deviceLaunchInFlight=!1,i=e.CONNECT_INTENTS.LAUNCH_AND_CONTROL),a("Attempting to connectToApp() to create an MDX session");var n=this;e.connectToApp(i).done(function(){a("MdxTarget.connectToApp success. Target is now usable!"),v({category:"uiAction",data:{reason:"deviceConnectSuccess"}}),n.emit(n.EVENTS.TARGET_CONNECTION_CHANGED,t,{usermismatch:!1}),T.get().do(function(e){return e.disableProfileGateSessionTracking()}).subscribe(),e.getPlayerState().done(function(){a("got player state")}),e.getAudioSubtitles().done(function(){a("getting audio subtitles")})},function(e){e.code===r.get(e,"ERRORS.USER_MISMATCH.code")?(a("MdxTarget.connectToApp success. Target is now usable!"),v({category:"uiAction",data:{reason:"deviceConnectUserMismatch"}}),t.state.connected=!0,n.emit(n.EVENTS.TARGET_CONNECTION_CHANGED,t,{usermismatch:!0}),T.get().do(function(e){return e.disableProfileGateSessionTracking()}).subscribe()):(a("MdxTarget.connectToApp failed."+e.message),v({category:"uiAction",data:{reason:"deviceConnectError"}}),n.emit(n.EVENTS.TARGET_CONNECTION_FAILED,e))}),u.fromEvent(e,e.EVENTS.NEW_APP_MESSAGE).takeUntil(this.targetDisposedObs).do(function(e){a("got new_app_message");var i=e.name,s=e.payload&&e.payload.currentState;i!==t.DEVICE_EVENTS.PLAYER_STATE_CHANGED&&i!==t.DEVICE_EVENTS.PLAYER_CURRENT_STATE||(r.includes(t.DEVICE_PLAY_STATES,s)?n.emit(n.EVENTS.TARGET_PLAYING,t):n.emit(n.EVENTS.TARGET_STOPPED,t))}).subscribe(r.noop),u.merge(u.fromEvent(e,e.EVENTS.APP_CONNECTION_ENDED),u.fromEvent(e,e.EVENTS.DISCOVERY_STATE_CHANGED)).takeUntil(this.targetDisposedObs).take(1).do(function(e){a("target connection ended message"),n.emit(n.EVENTS.TARGET_CONNECTION_CHANGED,null,{device:e.device}),this.setCurrentTarget(null),g.stopHeartbeat(),T.get().do(function(e){return e.enableProfileGateSessionTracking()}).subscribe()}.bind(this)).subscribe(r.noop)}else this.state.currentTarget=null},onMdxDevicesAvailable:function(e){a("MDX Reported device availabitity as: "+(e.available?"AVAILABLE":"NOT_AVAILABLE")),this.state.mdxDevicesFound=e.available,this.emit(this.EVENTS.MDX_DEVICES_AVAILABLE,e.available)},onDeviceAvailable:function(e){if(a("MDX device available for communication."),!this.isSameDevice(e.device)){var t=this.launchSource();this.emit(this.EVENTS.NEW_DEVICE_AVAILABLE,e.device),this.setCurrentTarget(e.device),v({category:"uiAction",data:{reason:"deviceAvailable",launchSource:t}})}},onStartConnectingToDevice:function(){this.mdxConnectionLogging.logConnectEvent()},onStartDisconnectingDevice:function(){this.mdxConnectionLogging.logDisconnectEvent()},canAttemptToCast:function(){return this.state&&this.state.currentTarget},cast:function(e,t,i,n){var s=this.state.currentTarget;s&&s.cast(e,t,i,n)},requestMdxDevice:function(){var e=this;this.mdxApi.requestMdxDevice().done(function(t){e.state.deviceLaunchInFlight=!0,a("Device request success - "+t.id+" : "+t.friendlyName),v({category:"uiAction",data:{reason:"deviceRequestSuccess",launchSource:"manual-launch"}})},function(e){a("Device request error "+e.message),v({category:"uiAction",data:{reason:"deviceRequestError",launchSource:"manual-launch"}})})},isSameDevice:function(e){return r.get(this,"state.currentTarget.state.target.id",null)===e.id},configure:function(e){this.mdxApi.configure(e)},launchSource:function(){return this.state.deviceLaunchInFlight?"manual-launch":"auto-launch"},EVENTS:{MDX_DEVICES_AVAILABLE:"mdx-devices-available",TARGET_CONNECTION_CHANGED:"target-connection_changed",TARGET_CONNECTION_FAILED:"target-connection_failed",TARGET_PLAYING:"target-playing",TARGET_STOPPED:"target-stopped",NEW_DEVICE_AVAILABLE:"new-device-available",SHOW_EPISODES:"show-title-episodes"}},r.assign(h.prototype,l),t.exports=h});C.r("mdx2/mdx2Target.js",function(t,e,i){"use strict";function s(t){return r.assign({},m,t)}var a=t("babel-runtime/helpers/typeof"),n=function(t){return t&&t.__esModule?t:{default:t}}(a),u=t("./utils/mdxLog.js"),o=t,r=o("lodash"),d=o("shakti-platform/dist/ui/ShaktiProperties"),l=o("../reactMixins/eventBus.js"),c=o("../utils/htmlUtils.js"),E=o("../player/session/sessionManager.js"),h=o("../utils/titles/interactiveTitles"),T=d.get("netflix.ui.akira.mdx.catalog.prefix"),S={PLAYER_CURRENT_STATE:"PLAYER_CURRENT_STATE",PLAYER_STATE_CHANGED:"PLAYER_STATE_CHANGED",AUDIO_SUBTITLES_SETTINGS:"AUDIO_SUBTITLES_SETTINGS",AUDIO_SUBTITLES_CHANGED:"AUDIO_SUBTITLES_CHANGED",PIN_VERIFICATION_SHOW:"PIN_VERIFICATION_SHOW",PIN_VERIFICATION_NOT_REQUIRED:"PIN_VERIFICATION_NOT_REQUIRED",PIN_VERIFICATION_CANCEL:"PIN_VERIFICATION_CANCEL",PIN_VERIFICATION_RESPONSE:"PIN_VERIFICATION_RESPONSE"},f={PLAY:"PLAY",PROGRESS:"PROGRESS",PLAYING:"PLAYING",PAUSE:"PAUSE",STOP:"STOP",STALLED:"STALLED",AUTO_ADVANCE:"AUTO_ADVANCE",END_PLAYBACK:"END_PLAYBACK"},I={ENDED:"ENDED"},m={connected:!1,currentState:null,contentId:null,catalogId:null,episodeId:null,currentTime:0,runtime:0,muted:!1,volume:1,paused:!0,started:!1,ended:!0,audioList:[],subtitleList:[],playbackUnavailableReason:void 0,unavailableTrackId:void 0,unavailableVideoId:void 0},A={BRANCHING_TITLE:"BRANCHING_TITLE"},_=function(t){if(!t||"object"!==(void 0===t?"undefined":(0,n.default)(t)))throw new Error("Video summary not provided to MDX cast() call.");if(h.isBranchingTitle(t))return A.BRANCHING_TITLE},g=function(t,e){this.target=t,this.initParams=e,this.boundUpdateState=this.updateState.bind(this),this.target.addEventListener(this.target.EVENTS.NEW_APP_MESSAGE,this.boundUpdateState),this.state=s({deviceName:c.unescapeHtmlCharacters(t.friendlyName)})},p=function(t){return r.get(t,"payload.currentState","")},N=function(t){var e=r.last(r.get(t,"payload.episodeId","").split("/"));return e=r.isEmpty(e)?null:parseFloat(e)},P=function(t){var e=r.last(r.get(t,"payload.catalogId","").split("/"));return e=r.isEmpty(e)?null:parseFloat(e)},C=function(t){return parseFloat(r.first(r.get(t,"payload.duration","").split(".")))},V=function(t){return parseFloat(r.first(r.get(t,"payload.time","").split(".")))},v=function(t){return r.get(t,"payload.volume","")/100},D=function(t){return r.get(t,"payload.postplayState",null)},L=function(t){return r.get(t,"payload.targetState",null)},R=function(t){return t.selected="true"===t.selected,t},U=function(t,e){var i=r.get(t,"payload."+e,[]);return r.map(i,function(t){R(t)}),i},O=r.debounce(function(t,e,i){t.setVolume(e,100*i).done(function(){u("setVolume message delivered!")},function(){u("setVolume message failed!")})},100,{leading:!0,trailing:!0,maxWait:100});g.prototype={waiting:!1,messageFulfilled:function(){this._defaultAckFunc()},_defaultAckFunc:function(){return!0},shouldUpdateState:function(t){return this.waiting&&this.messageFulfilled(t)&&(u("message fulfilled!"),this.waiting=!1,this.messageFulfilled=this._defaultAckFunc),p(t)===this.DEVICE_STATES.STOP||!this.waiting},fakeUpdateState:function(t){r.assign(this.state,t),this.emit(this.EVENTS.STATE_CHANGED,r.clone(this.state))},localTimerId:null,startLocalTimer:function(){if(null===this.localTimerId){var t=this;this.localTimerId=setInterval(function(){t.fakeUpdateState({currentTime:parseFloat(t.state.currentTime)+1})},1e3)}},stopLocalTimer:function(){null!==this.localTimerId&&(clearTimeout(this.localTimerId),this.localTimerId=null)},updateState:function(t){var e=p(t),i=r.get(t,"device.discoveryState")===r.get(t,"device.DISCOVERY_STATES.AVAILABLE");if(this.DEVICE_AUDIO_EVENTS.indexOf(t.name)>=0)this.state.audioList=U(t,"audio_tracks"),this.state.subtitleList=U(t,"timed_text_track"),this.emit(this.EVENTS.STATE_CHANGED,r.clone(this.state));else if(t.name!==this.DEVICE_EVENTS.PLAYER_STATE_CHANGED||L(t)!==I.ENDED||D(t))if(this.DEVICE_PLAYER_EVENTS.indexOf(t.name)>=0){if(this.shouldUpdateState(t)){if(this.state.xid=t.transactionId||this.state.xid,this.state.connected=i,this.state.currentState=e||this.state.currentState,this.state.paused=this.state.currentState===this.DEVICE_STATES.PAUSE,this.state.currentState!==f.END_PLAYBACK){var s=P(t),a=N(t);this.state.catalogId=s,this.state.episodeId=a,this.state.contentId=a||s}var n=C(t);r.isNaN(n)||(this.state.runtime=n);var u=V(t);r.isNaN(u)||(this.state.currentTime=Math.min(u,this.state.runtime)),e===this.DEVICE_STATES.PLAYING?this.startLocalTimer():this.stopLocalTimer(),e===this.DEVICE_EVENTS.STOP&&(this.state.contentId=null,this.state.catalogId=null,this.state.episodeId=null,this.state.runtime=0,this.currentTime=0);var o=parseFloat(v(t));0===o?this.state.muted=!0:(this.state.muted=!1,this.state.volume=o);var d=D(t);d?(this.state.inPostplay=!0,this.state.nextVideoId=parseFloat(r.get(d,"title.id"))):(this.state.inPostplay=!1,this.state.nextVideoId=null),r.includes(this.DEVICE_PLAY_STATES,e)?(this.state.started=!0,this.state.ended=!1):(this.state.started=!1,this.state.ended=!0),this.emit(this.EVENTS.STATE_CHANGED,r.clone(this.state))}}else t.name===S.PIN_VERIFICATION_SHOW?this.showPinEntry():t.name===S.PIN_VERIFICATION_NOT_REQUIRED&&this.hidePinEntry();else this.state.connected=i,this.state.contentId=null,this.state.catalogId=null,this.state.episodeId=null,this.emit(this.EVENTS.STATE_CHANGED,r.clone(this.state))},showPinEntry:function(){this.state.showPinEntry=!0,this.emit(this.EVENTS.STATE_CHANGED,r.clone(this.state))},hidePinEntry:function(){this.state.showPinEntry=!1,this.emit(this.EVENTS.STATE_CHANGED,r.clone(this.state))},clearUnavailablePlayback:function(){this.fakeUpdateState({playbackUnavailableReason:void 0})},cast:function(t,e,i,s){var a=r.get(this,"initParams.pinConfig.isEnabled",!1),n=r.get(this,"initParams.pinConfig.isAdultVerified",!0),u=!E.isExpired(E.SESSION_TYPES.PIN);if(t!==this.state.contentId){var o=_(s);if(o)return void this.fakeUpdateState({playbackUnavailableReason:o,unavailableVideoId:t,unavailableTrackId:e});var d={currentState:this.DEVICE_STATES.PROGRESS,contentId:t,trackId:e,paused:!1,runtime:0,currentTime:0,inPostplay:!1,nextVideoId:null,playbackUnavailableReason:void 0,unavailableVideoId:void 0,unavailableTrackId:void 0};if(!i&&(a&&!u||!n))return this.currentVideoId=this.state.contentId,this.currentTrackId=this.state.trackId,this.fakeUpdateState({contentId:t,trackId:e}),void(this._castAttempted=!0);this._castAttempted=!1,this.stopLocalTimer(),this.fakeUpdateState(d),this._connect({isPinVerified:!0})}},resetCurrentContentId:function(){this.fakeUpdateState({contentId:this.currentVideoId||null,trackId:this.currentTrackId||-1})},_connect:function(t){var e=this,i=this.state.contentId,s={enablePostPlay:!0};this.waiting=!0,this.messageFulfilled=function(t){var s=!(p(t)!==this.DEVICE_STATES.PLAYING&&p(t)!==this.DEVICE_STATES.PLAY||P(t)!==i&&N(t)!==i);return s&&E.startHeartbeat(e),s},this.target.connectToApp(this.target.CONNECT_INTENTS.LAUNCH_AND_CONTROL).done(function(){e.state.contentId&&e.target.play(T+e.state.contentId,e.state.trackId,r.assign(s,t)).done(function(){u("cast message delivered!")},function(){u("cast message failed!")})},function(){u("cast connectToApp message failed!")})},disconnect:function(t){this.target.disconnectFromApp(!0).done(function(){u("disconnect message delivered!"),t&&"function"==typeof t&&t()},function(){u("disconnect message failed!"),t&&"function"==typeof t&&t(new Error("MDX Disconnect Failed"))})},stop:function(){this.waiting=!0,this.messageFulfilled=function(t){return p(t)===this.DEVICE_STATES.STOP};var t={currentState:this.DEVICE_STATES.STOP,contentId:null,paused:!1,runtime:0,currentTime:0};this.stopLocalTimer(),this.fakeUpdateState(t),this.target.stop().done(function(){u("stop message delivered!"),E.stopHeartbeat(!0)},function(){u("stop message failed!")})},pause:function(t){this.waiting=!0,this.messageFulfilled=t?function(){return!1}:function(t){return p(t)===this.DEVICE_STATES.PAUSE};var e={scrubbing:!!t,currentState:this.DEVICE_STATES.PAUSE,paused:!0};this.stopLocalTimer(),this.fakeUpdateState(e),this.target.pause(this.xid).done(function(){u("pause message delivered!")},function(){u("pause message failed!")})},getCatalogId:function(){return this.state.catalogId},getContentId:function(){return this.state.contentId},getPaused:function(){return this.state.paused},play:function(){this.waiting=!0,this.messageFulfilled=function(t){return p(t)===this.DEVICE_STATES.PLAYING};var t={currentState:this.DEVICE_STATES.PLAYING,paused:!1};this.fakeUpdateState(t),this.target.resume(this.xid).done(function(){u("resume message delivered!")},function(){u("resume message failed!")})},seek:function(t){this.waiting=!0,t=Math.floor(t),this.messageFulfilled=function(e){return p(e)===this.DEVICE_STATES.PLAYING&&r.inRange(V(e),.95*t,1.05*t)};var e={scrubbing:!1,currentState:this.DEVICE_STATES.PROGRESS,currentTime:t,paused:!1};this.fakeUpdateState(e),this.target.setTime(this.xid,t).done(function(){u("seek/setTime message delivered!")},function(){u("seek/setTime message failed!")})},setVolume:function(t){var e={volume:t};this.fakeUpdateState(e),this.state.muted||(this.waiting=!0,this.messageFulfilled=function(t){return v(t)===this.state.volume},O(this.target,this.xid,t))},setMuted:function(t){this.state.muted!==t&&this.toggleMute()},toggleMute:function(){var t=this.state.muted?this.state.volume:0;this.state.muted=!this.state.muted;var e={muted:this.state.muted};this.fakeUpdateState(e),this.target.setVolume(this.xid,100*t).done(function(){u("setVolume for toggleVolume message delivered!")},function(){u("setVolume for toggleVolume message failed!")})},setAudioTrack:function(t){this.target.setAudioSubtitles(t.id,null).done(function(){u("setAudioSubtitles message delivered!")},function(){u("setVolume message failed!")})},setTimedTextTrack:function(t){this.target.setAudioSubtitles(null,t.id).done(function(){u("setAudioSubtitles message delivered!")},function(){u("setVolume message failed!")})},scrubStart:function(){this.state.paused||this.pause(!0)},getTrickPlayURL:function(t){},lastScrubTime:0,scrub:function(t){this.fakeUpdateState({currentTime:t}),this.lastScrubTime=t},getCurrentTime:function(){return this.state.currentTime},getDuration:function(){return this.state.runtime},getVolume:function(){return this.state.volume},toggleFullscreen:r.noop,togglePlay:function(){this.state.paused?this.play():this.pause()},scrubEnd:function(t){var e=t||this.lastScrubTime;this.seek(e)},resumeCast:function(){this._castAttempted&&(this._castAttempted=!1,this._connect({pinVerified:!0}))},validPin:function(){var t=this;E.setSessionData(E.SESSION_TYPES.PIN,!0),this.waiting=!1,this.messageFulfilled=this._defaultAckFunc,this.target.sendAppMessage(this.DEVICE_EVENTS.PIN_VERIFICATION_RESPONSE).done(function(){u("validPin message delivered!"),t._connect({isPinVerified:!0})},function(){u("validPin message failed!"),t._connect({isPinVerified:!0})})},cancelPin:function(){var t=this;this.waiting=!1,this.messageFulfilled=this._defaultAckFunc,this.target.sendAppMessage(this.DEVICE_EVENTS.PIN_VERIFICATION_CANCEL).done(function(){u("cancelPin message delivered!"),t.resetCurrentContentId()},function(){u("cancelPin message failed!"),t.resetCurrentContentId()})},destroy:function(){this.target.removeEventListener(this.target.EVENTS.NEW_APP_MESSAGE,this.boundUpdateState),this.stopLocalTimer()},TARGET_STATES:I,DEVICE_STATES:f,DEVICE_EVENTS:S,DEVICE_PLAYER_EVENTS:[S.PLAYER_CURRENT_STATE,S.PLAYER_STATE_CHANGED],DEVICE_AUDIO_EVENTS:[S.AUDIO_SUBTITLES_CHANGED,S.AUDIO_SUBTITLES_SETTINGS],DEVICE_PLAY_STATES:[f.PLAY,f.PROGRESS,f.PLAYING,f.PAUSE],EVENTS:{STATE_CHANGED:"STATE_CHANGED"}},r.assign(g.prototype,l),e.exports=g});C.r("mdx2/utils/mdxLog.js",function(o,n,s){"use strict";var t=o("./mdxConstants.js"),c=document.location.search.indexOf(t.DEBUG_PARAM)>=0,i=function(o){var n=window.console;c&&n.log(o)};n.exports=i});C.r("node_modules/nf-mdx/mdx.npm.js",function(e,n,t){n.exports=function(){var n,t="4.3.14",r="420";return function n(t,r,o){function i(c,a){if(!r[c]){if(!t[c]){var u="function"==typeof e&&e;if(!a&&u)return u(c,!0);if(s)return s(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var l=r[c]={exports:{}};t[c][0].call(l.exports,function(e){var n=t[c][1][e];return i(n||e)},l,l.exports,n,t,r,o)}return r[c].exports}for(var s="function"==typeof e&&e,c=0;c<o.length;c++)i(o[c]);return i}({1:[function(e,n,t){(function(e){(function(){function r(e,n){if(e!==n){var t=e===e,r=n===n;if(e>n||!t||void 0===e&&r)return 1;if(e<n||!r||void 0===n&&t)return-1}return 0}function o(e,n,t){for(var r=e.length,o=t?r:-1;t?o--:++o<r;)if(n(e[o],o,e))return o;return-1}function i(e,n,t){if(n!==n)return u(e,t);for(var r=t-1,o=e.length;++r<o;)if(e[r]===n)return r;return-1}function s(e){return"function"==typeof e||!1}function c(e){return"string"==typeof e?e:null==e?"":e+""}function a(e,n){return r(e.criteria,n.criteria)||e.index-n.index}function u(e,n,t){for(var r=e.length,o=n+(t?0:-1);t?o--:++o<r;){var i=e[o];if(i!==i)return o}return-1}function d(e){return!!e&&"object"==typeof e}function l(e){if(d(e)&&!At(e)&&!(e instanceof v)){if(e instanceof p)return e;if(Fn.call(e,"__chain__")&&Fn.call(e,"__wrapped__"))return Ee(e)}return new p(e)}function f(){}function p(e,n,t){this.__wrapped__=e,this.__actions__=t||[],this.__chain__=!!n}function v(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=st,this.__views__=null}function g(e){var n=e?e.length:0;for(this.data={hash:tt(null),set:new Qn};n--;)this.push(e[n])}function E(e,n){var t=e.data;return("string"==typeof n||Me(n)?t.set.has(n):t.hash[n])?0:-1}function h(e){var n=this.data;"string"==typeof e||Me(e)?n.set.add(e):n.hash[e]=!0}function m(e,n){var t=-1,r=e.length;for(n||(n=Array(r));++t<r;)n[t]=e[t];return n}function y(e,n){for(var t=-1,r=e.length;++t<r&&!1!==n(e[t],t,e););return e}function R(e,n){for(var t=-1,r=e.length,o=-1,i=[];++t<r;){var s=e[t];n(s,t,e)&&(i[++o]=s)}return i}function S(e,n){for(var t=-1,r=e.length,o=Array(r);++t<r;)o[t]=n(e[t],t,e);return o}function I(e,n,t,r){var o=-1,i=e.length;for(r&&i&&(t=e[++o]);++o<i;)t=n(t,e[o],o,e);return t}function A(e,n){for(var t=-1,r=e.length;++t<r;)if(n(e[t],t,e))return!0;return!1}function T(e,n){for(var t=-1,r=e.length,o=ue(r),i=n.length,s=Array(i);++t<i;){var c=n[t];o?(c=parseFloat(c),s[t]=ce(c,r)?e[c]:Qe):s[t]=e[c]}return s}function N(e,n,t){t||(t=n,n={});for(var r=-1,o=t.length;++r<o;){var i=t[r];n[i]=e[i]}return n}function O(e,n,t){var r=typeof e;return"function"==r?void 0===n?e:Q(e,n,t):null==e?We:"object"==r?k(e):void 0===n?B(e+""):G(e+"",n)}function j(e,n,t,r,o,i,s){var c;if(t&&(c=o?t(e,r,o):t(e)),void 0!==c)return c;if(!Me(e))return e;var a=At(e);if(a){if(c=oe(e),!n)return m(e,c)}else{var u=Bn.call(e),d=u==on;if(u!=cn&&u!=Ze&&(!d||o))return On[u]?se(e,u,n):o?e:{};if(Pn(e))return o?e:{};if(c=ie(d?{}:e),!n)return N(e,c,jt(e))}i||(i=[]),s||(s=[]);for(var l=i.length;l--;)if(i[l]==e)return s[l];return i.push(e),s.push(c),(a?y:M)(e,function(r,o){c[o]=j(r,n,t,o,e,i,s)}),c}function C(e,n){var t=e?e.length:0,r=[];if(!t)return r;var o=-1,s=re(),c=s==i,a=c&&n.length>=200?mt(n):null,u=n.length;a&&(s=E,c=!1,n=a);e:for(;++o<t;){var d=e[o];if(c&&d===d){for(var l=u;l--;)if(n[l]===d)continue e;r.push(d)}else s(n,d,0)<0&&r.push(d)}return r}function D(e,n){var t=[];return Et(e,function(e,r,o){n(e,r,o)&&t.push(e)}),t}function b(e,n,t,r){var o;return t(e,function(e,t,i){if(n(e,t,i))return o=r?t:e,!1}),o}function x(e,n,t){for(var r=-1,o=e.length,i=-1,s=[];++r<o;){var c=e[r];if(d(c)&&ue(c.length)&&(At(c)||be(c))){n&&(c=x(c,n,t));var a=-1,u=c.length;for(s.length+=u;++a<u;)s[++i]=c[a]}else t||(s[++i]=c)}return s}function _(e,n){return ht(e,n,He)}function M(e,n){return ht(e,n,jt)}function w(e,n){for(var t=-1,r=n.length,o=-1,i=[];++t<r;){var s=n[t];Tt(e[s])&&(i[++o]=s)}return i}function P(e,n,t,r,o,i){if(e===n)return 0!==e||1/e==1/n;var s=typeof e,c=typeof n;return"function"!=s&&"object"!=s&&"function"!=c&&"object"!=c||null==e||null==n?e!==e&&n!==n:L(e,n,P,t,r,o,i)}function L(e,n,t,r,o,i,s){var c=At(e),a=At(n),u=en,d=en;c||(u=Bn.call(e),u==Ze?u=cn:u!=cn&&(c=ke(e))),a||(d=Bn.call(n),d==Ze?d=cn:d!=cn&&(a=ke(n)));var l=(u==cn||o&&u==on)&&!Pn(e),f=(d==cn||o&&d==on)&&!Pn(n),p=u==d;if(p&&!c&&!l)return ee(e,n,u);if(o){if(!(p||l&&f))return!1}else{var v=l&&Fn.call(e,"__wrapped__"),g=f&&Fn.call(n,"__wrapped__");if(v||g)return t(v?e.value():e,g?n.value():n,r,o,i,s);if(!p)return!1}i||(i=[]),s||(s=[]);for(var E=i.length;E--;)if(i[E]==e)return s[E]==n;i.push(e),s.push(n);var h=(c?Z:ne)(e,n,t,r,o,i,s);return i.pop(),s.pop(),h}function U(e,n,t,r,o){for(var i=-1,s=n.length,c=!o;++i<s;)if(c&&r[i]?t[i]!==e[n[i]]:!(n[i]in e))return!1;for(i=-1;++i<s;){var a=n[i],u=e[a],d=t[i];if(c&&r[i])var l=void 0!==u||a in e;else void 0===(l=o?o(u,d,a):Qe)&&(l=P(d,u,o,!0));if(!l)return!1}return!0}function V(e,n){var t=[];return Et(e,function(e,r,o){t.push(n(e,r,o))}),t}function k(e){var n=jt(e),t=n.length;if(!t)return Ke(!0);if(1==t){var r=n[0],o=e[r];if(de(o))return function(e){return null!=e&&e[r]===o&&(void 0!==o||r in ge(e))}}for(var i=Array(t),s=Array(t);t--;)o=e[n[t]],i[t]=o,s[t]=de(o);return function(e){return null!=e&&U(ge(e),n,i,s)}}function G(e,n){return de(n)?function(t){return null!=t&&t[e]===n&&(void 0!==n||e in ge(t))}:function(t){return null!=t&&P(n,t[e],null,!0)}}function F(e,n,t,r,o){if(!Me(e))return e;var i=ue(n.length)&&(At(n)||ke(n));return(i?y:M)(n,function(n,s,c){if(d(n))return r||(r=[]),o||(o=[]),H(e,c,s,F,t,r,o);var a=e[s],u=t?t(a,n,s,e,c):Qe,l=void 0===u;l&&(u=n),!i&&void 0===u||!l&&(u===u?u===a:a!==a)||(e[s]=u)}),e}function H(e,n,t,r,o,i,s){for(var c=i.length,a=n[t];c--;)if(i[c]==a)return void(e[t]=s[c]);var u=e[t],d=o?o(u,a,t,e,n):Qe,l=void 0===d;l&&(d=a,ue(a.length)&&(At(a)||ke(a))?d=At(u)?u:u&&u.length?m(u):[]:Nt(a)||be(a)?d=be(u)?Fe(u):Nt(u)?u:{}:l=!1),i.push(a),s.push(d),l?e[t]=r(d,a,o,i,s):(d===d?d!==u:u===u)&&(e[t]=d)}function B(e){return function(n){return null==n?Qe:n[e]}}function q(e,n,t,r,o){return o(e,function(e,o,i){t=r?(r=!1,e):n(t,e,o,i)}),t}function Y(e,n,t){var r=-1,o=e.length;n=null==n?0:+n||0,n<0&&(n=-n>o?0:o+n),t=void 0===t||t>o?o:+t||0,t<0&&(t+=o),o=n>t?0:t-n>>>0,n>>>=0;for(var i=Array(o);++r<o;)i[r]=e[r+n];return i}function K(e,n){var t;return Et(e,function(e,r,o){return!(t=n(e,r,o))}),!!t}function W(e,n){var t=e.length;for(e.sort(n);t--;)e[t]=e[t].value;return e}function X(e,n){for(var t=-1,r=n.length,o=Array(r);++t<r;)o[t]=e[n[t]];return o}function J(e,n,t){var r=0,o=e?e.length:r;if("number"==typeof n&&n===n&&o<=ut){for(;r<o;){var i=r+o>>>1,s=e[i];(t?s<=n:s<n)?r=i+1:o=i}return o}return z(e,n,We,t)}function z(e,n,t,r){n=t(n);for(var o=0,i=e?e.length:0,s=n!==n,c=void 0===n;o<i;){var a=Wn((o+i)/2),u=t(e[a]),d=u===u;if(s)var l=d||r;else l=c?d&&(r||void 0!==u):r?u<=n:u<n;l?o=a+1:i=a}return it(i,at)}function Q(e,n,t){if("function"!=typeof e)return We;if(void 0===n)return e;switch(t){case 1:return function(t){return e.call(n,t)};case 3:return function(t,r,o){return e.call(n,t,r,o)};case 4:return function(t,r,o,i){return e.call(n,t,r,o,i)};case 5:return function(t,r,o,i,s){return e.call(n,t,r,o,i,s)}}return function(){return e.apply(n,arguments)}}function $(e){return Kn.call(e,0)}function Z(e,n,t,r,o,i,s){var c=-1,a=e.length,u=n.length,d=!0;if(a!=u&&!(o&&u>a))return!1;for(;d&&++c<a;){var l=e[c],f=n[c];if(d=Qe,r&&(d=o?r(f,l,c):r(l,f,c)),void 0===d)if(o)for(var p=u;p--&&(f=n[p],!(d=l&&l===f||t(l,f,r,o,i,s))););else d=l&&l===f||t(l,f,r,o,i,s)}return!!d}function ee(e,n,t){switch(t){case nn:case tn:return+e==+n;case rn:return e.name==n.name&&e.message==n.message;case sn:return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case an:case un:return e==n+""}return!1}function ne(e,n,t,r,o,i,s){var c=jt(e),a=c.length;if(a!=jt(n).length&&!o)return!1;for(var u=o,d=-1;++d<a;){var l=c[d],f=o?l in n:Fn.call(n,l);if(f){var p=e[l],v=n[l];f=Qe,r&&(f=o?r(v,p,l):r(p,v,l)),void 0===f&&(f=p&&p===v||t(p,v,r,o,i,s))}if(!f)return!1;u||(u="constructor"==l)}if(!u){var g=e.constructor,E=n.constructor;if(g!=E&&"constructor"in e&&"constructor"in n&&!("function"==typeof g&&g instanceof g&&"function"==typeof E&&E instanceof E))return!1}return!0}function te(e,n,t){var r=l.callback||Ye;return r=r===Ye?O:r,t?r(e,n,t):r}function re(e,n,t){var r=l.indexOf||ye;return r=r===ye?i:r,e?r(e,n,t):r}function oe(e){var n=e.length,t=new e.constructor(n);return n&&"string"==typeof e[0]&&Fn.call(e,"index")&&(t.index=e.index,t.input=e.input),t}function ie(e){var n=e.constructor;return"function"==typeof n&&n instanceof n||(n=Object),new n}function se(e,n,t){var r=e.constructor;switch(n){case dn:return $(e);case nn:case tn:return new r(+e);case ln:case fn:case pn:case vn:case gn:case En:case hn:case mn:case yn:r instanceof r&&(r=ft[n]);var o=e.buffer;return new r(t?$(o):o,e.byteOffset,e.length);case sn:case un:return new r(e);case an:var i=new r(e.source,Rn.exec(e));i.lastIndex=e.lastIndex}return i}function ce(e,n){return e=+e,n=null==n?lt:n,e>-1&&e%1==0&&e<n}function ae(e,n,t){if(!Me(t))return!1;var r=typeof n;if("number"==r)var o=t.length,i=ue(o)&&ce(n,o);else i="string"==r&&n in t;if(i){var s=t[n];return e===e?e===s:s!==s}return!1}function ue(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=lt}function de(e){return e===e&&(0===e?1/e>0:!Me(e))}function le(e,n){e=ge(e);for(var t=-1,r=n.length,o={};++t<r;){var i=n[t];i in e&&(o[i]=e[i])}return o}function fe(e,n){var t={};return _(e,function(e,r,o){n(e,r,o)&&(t[r]=e)}),t}function pe(e){var n,t=l.support;if(!d(e)||Bn.call(e)!=cn||Pn(e)||!Fn.call(e,"constructor")&&"function"==typeof(n=e.constructor)&&!(n instanceof n)||!t.argsTag&&be(e))return!1;var r;return t.ownLast?(_(e,function(e,n,t){return r=Fn.call(t,n),!1}),!1!==r):(_(e,function(e,n){r=n}),void 0===r||Fn.call(e,r))}function ve(e){for(var n=He(e),t=n.length,r=t&&e.length,o=l.support,i=r&&ue(r)&&(At(e)||o.nonEnumStrings&&Ve(e)||o.nonEnumArgs&&be(e)),s=-1,c=[];++s<t;){var a=n[s];(i&&ce(a,r)||Fn.call(e,a))&&c.push(a)}return c}function ge(e){if(l.support.unindexedChars&&Ve(e)){for(var n=-1,t=e.length,r=Object(e);++n<t;)r[n]=e.charAt(n);return r}return Me(e)?e:Object(e)}function Ee(e){return e instanceof v?e.clone():new p(e.__wrapped__,e.__chain__,m(e.__actions__))}function he(e,n,t){return(e?e.length:0)?((t?ae(e,n,t):null==n)&&(n=1),Y(e,n<0?0:n)):[]}function me(e,n,t){var r=e?e.length:0;return t&&ae(e,n,t)&&(n=!1),r?x(e,n):[]}function ye(e,n,t){var r=e?e.length:0;if(!r)return-1;if("number"==typeof t)t=t<0?ot(r+t,0):t;else if(t){var o=J(e,n),s=e[o];return(n===n?n===s:s!==s)?o:-1}return i(e,n,t||0)}function Re(){var e=arguments,n=e[0];if(!n||!n.length)return n;for(var t=0,r=re(),o=e.length;++t<o;)for(var i=0,s=e[t];(i=r(n,s,i))>-1;)$n.call(n,i,1);return n}function Se(e,n,t){return(e?e.length:0)?((t?ae(e,n,t):null==n)&&(n=1),Y(e,0,n<0?0:n)):[]}function Ie(e,n){var t=-1,r=e?e.length:0,o={};for(!r||n||At(e[0])||(n=[]);++t<r;){var i=e[t];n?o[i]=n[t]:i&&(o[i[0]]=i[1])}return o}function Ae(e,n,t){var r=At(e)?R:D;return n=te(n,t,3),r(e,n)}function Te(e,n,t,r){var o=e?e.length:0;return ue(o)||(e=Be(e),o=e.length),!!o&&(t="number"!=typeof t||r&&ae(n,t,r)?0:t<0?ot(o+t,0):t||0,"string"==typeof e||!At(e)&&Ve(e)?t<o&&e.indexOf(n,t)>-1:re(e,n,t)>-1)}function Ne(e,n,t){var r=At(e)?S:V;return n=te(n,t,3),r(e,n)}function Oe(e,n,t){var r=At(e)?A:K;return t&&ae(e,n,t)&&(n=null),"function"==typeof n&&void 0===t||(n=te(n,t,3)),r(e,n)}function je(e,n,t){if(null==e)return[];var r=-1,o=e.length,i=ue(o)?Array(o):[];return t&&ae(e,n,t)&&(n=null),n=te(n,t,3),Et(e,function(e,t,o){i[++r]={criteria:n(e,t,o),index:r,value:e}}),W(i,a)}function Ce(e,n){if("function"!=typeof e)throw new TypeError($e);return n=ot(void 0===n?e.length-1:+n||0,0),function(){for(var t=arguments,r=-1,o=ot(t.length-n,0),i=Array(o);++r<o;)i[r]=t[n+r];switch(n){case 0:return e.call(this,i);case 1:return e.call(this,t[0],i);case 2:return e.call(this,t[0],t[1],i)}var s=Array(n+1);for(r=-1;++r<n;)s[r]=t[r];return s[n]=i,e.apply(this,s)}}function De(e,n,t,r){return n&&"boolean"!=typeof n&&ae(e,n,t)?n=!1:"function"==typeof n&&(r=t,t=n,n=!1),t="function"==typeof t&&Q(t,r,1),j(e,n,t)}function be(e){return ue(d(e)?e.length:Qe)&&Bn.call(e)==Ze}function xe(e,n,t,r){if(!(t="function"==typeof t&&Q(t,r,3))&&de(e)&&de(n))return e===n;var o=t?t(e,n):Qe;return void 0===o?P(e,n,t):!!o}function _e(e){return d(e)&&"string"==typeof e.message&&Bn.call(e)==rn}function Me(e){var n=typeof e;return"function"==n||!!e&&"object"==n}function we(e){return Ue(e)&&e!=+e}function Pe(e){return null!=e&&(Bn.call(e)==on?qn.test(Gn.call(e)):d(e)&&(Pn(e)?qn:Sn).test(e))}function Le(e){return null===e}function Ue(e){return"number"==typeof e||d(e)&&Bn.call(e)==sn}function Ve(e){return"string"==typeof e||d(e)&&Bn.call(e)==un}function ke(e){return d(e)&&ue(e.length)&&!!Nn[Bn.call(e)]}function Ge(e){return void 0===e}function Fe(e){return N(e,He(e))}function He(e){if(null==e)return[];Me(e)||(e=Object(e));var n=e.length,t=l.support;n=n&&ue(n)&&(At(e)||t.nonEnumStrings&&Ve(e)||t.nonEnumArgs&&be(e))&&n||0;for(var r=e.constructor,o=-1,i=Tt(r)&&r.prototype||Vn,s=i===e,c=Array(n),a=n>0,u=t.enumErrorProps&&(e===Un||e instanceof Error),d=t.enumPrototypes&&Tt(e);++o<n;)c[o]=o+"";for(var f in e)d&&"prototype"==f||u&&("message"==f||"name"==f)||a&&ce(f,n)||"constructor"==f&&(s||!Fn.call(e,f))||c.push(f);if(t.nonEnumShadows&&e!==Vn){var p=e===kn?un:e===Un?rn:Bn.call(e),v=pt[p]||pt[cn];for(p==cn&&(i=Vn),n=Tn.length;n--;){f=Tn[n];var g=v[f];s&&g||(g?!Fn.call(e,f):e[f]===i[f])||c.push(f)}}return c}function Be(e){return X(e,jt(e))}function qe(e){return e=c(e),e&&An.test(e)?e.replace(In,"\\$&"):e}function Ye(e,n,t){return t&&ae(e,n,t)&&(n=null),d(e)?Xe(e):O(e,n)}function Ke(e){return function(){return e}}function We(e){return e}function Xe(e){return k(j(e,!0))}function Je(e,n,t){if(null==t){var r=Me(n),o=r&&jt(n),i=o&&o.length&&w(n,o);(i?i.length:r)||(i=!1,t=n,n=e,e=this)}i||(i=w(n,jt(n)));var s=!0,c=-1,a=Tt(e),u=i.length;!1===t?s=!1:Me(t)&&"chain"in t&&(s=t.chain);for(;++c<u;){var d=i[c],l=n[d];e[d]=l,a&&(e.prototype[d]=function(n){return function(){var t=this.__chain__;if(s||t){var r=e(this.__wrapped__);return(r.__actions__=m(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}var o=[this.value()];return Jn.apply(o,arguments),n.apply(e,o)}}(l))}return e}function ze(e){var n=++Hn;return c(e)+n}var Qe,$e="Expected a function",Ze="[object Arguments]",en="[object Array]",nn="[object Boolean]",tn="[object Date]",rn="[object Error]",on="[object Function]",sn="[object Number]",cn="[object Object]",an="[object RegExp]",un="[object String]",dn="[object ArrayBuffer]",ln="[object Float32Array]",fn="[object Float64Array]",pn="[object Int8Array]",vn="[object Int16Array]",gn="[object Int32Array]",En="[object Uint8Array]",hn="[object Uint8ClampedArray]",mn="[object Uint16Array]",yn="[object Uint32Array]",Rn=/\w*$/,Sn=/^\[object .+?Constructor\]$/,In=/[.*+?^${}()|[\]\/\\]/g,An=RegExp(In.source),Tn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Nn={};Nn[ln]=Nn[fn]=Nn[pn]=Nn[vn]=Nn[gn]=Nn[En]=Nn[hn]=Nn[mn]=Nn[yn]=!0,Nn[Ze]=Nn[en]=Nn[dn]=Nn[nn]=Nn[tn]=Nn[rn]=Nn[on]=Nn["[object Map]"]=Nn[sn]=Nn[cn]=Nn[an]=Nn["[object Set]"]=Nn[un]=Nn["[object WeakMap]"]=!1;var On={};On[Ze]=On[en]=On[dn]=On[nn]=On[tn]=On[ln]=On[fn]=On[pn]=On[vn]=On[gn]=On[sn]=On[cn]=On[an]=On[un]=On[En]=On[hn]=On[mn]=On[yn]=!0,On[rn]=On[on]=On["[object Map]"]=On["[object Set]"]=On["[object WeakMap]"]=!1;var jn={function:!0,object:!0},Cn=jn[typeof t]&&t&&!t.nodeType&&t,Dn=jn[typeof n]&&n&&!n.nodeType&&n,bn=Cn&&Dn&&"object"==typeof e&&e,xn=jn[typeof self]&&self&&self.Object&&self,_n=jn[typeof window]&&window&&window.Object&&window,Mn=Dn&&Dn.exports===Cn&&Cn,wn=bn||_n!==(this&&this.window)&&_n||xn||this,Pn=function(){try{Object({toString:0}+"")}catch(e){return function(){return!1}}return function(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}}(),Ln=Array.prototype,Un=Error.prototype,Vn=Object.prototype,kn=String.prototype,Gn=Function.prototype.toString,Fn=Vn.hasOwnProperty,Hn=0,Bn=Vn.toString,qn=RegExp("^"+qe(Bn).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Yn=Pe(Yn=wn.ArrayBuffer)&&Yn,Kn=Pe(Kn=Yn&&new Yn(0).slice)&&Kn,Wn=Math.floor,Xn=Pe(Xn=Object.getPrototypeOf)&&Xn,Jn=Ln.push,zn=Vn.propertyIsEnumerable,Qn=Pe(Qn=wn.Set)&&Qn,$n=Ln.splice,Zn=Pe(Zn=wn.Uint8Array)&&Zn,et=function(){try{var e=Pe(e=wn.Float64Array)&&e,n=new e(new Yn(10),0,1)&&e}catch(e){}return n}(),nt=Pe(nt=Array.isArray)&&nt,tt=Pe(tt=Object.create)&&tt,rt=Pe(rt=Object.keys)&&rt,ot=Math.max,it=Math.min,st=Number.POSITIVE_INFINITY,ct=Math.pow(2,32)-1,at=ct-1,ut=ct>>>1,dt=et?et.BYTES_PER_ELEMENT:0,lt=Math.pow(2,53)-1,ft={};ft[ln]=wn.Float32Array,ft[fn]=wn.Float64Array,ft[pn]=wn.Int8Array,ft[vn]=wn.Int16Array,ft[gn]=wn.Int32Array,ft[En]=wn.Uint8Array,ft[hn]=wn.Uint8ClampedArray,ft[mn]=wn.Uint16Array,ft[yn]=wn.Uint32Array;var pt={};pt[en]=pt[tn]=pt[sn]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},pt[nn]=pt[un]={constructor:!0,toString:!0,valueOf:!0},pt[rn]=pt[on]=pt[an]={constructor:!0,toString:!0},pt[cn]={constructor:!0},y(Tn,function(e){for(var n in pt)if(Fn.call(pt,n)){var t=pt[n];t[e]=Fn.call(t,e)}});var vt=l.support={};!function(e){var n=function(){this.x=1},t={0:1,length:1},r=[];n.prototype={valueOf:1,y:1};for(var o in new n)r.push(o);vt.argsTag=Bn.call(arguments)==Ze,vt.enumErrorProps=zn.call(Un,"message")||zn.call(Un,"name"),vt.enumPrototypes=zn.call(n,"prototype"),vt.funcDecomp=/\bthis\b/.test(function(){return this}),vt.funcNames="string"==typeof Function.name,vt.nonEnumStrings=!zn.call("x",0),vt.nonEnumShadows=!/valueOf/.test(r),vt.ownLast="x"!=r[0],vt.spliceObjects=($n.call(t,0,1),!t[0]),vt.unindexedChars="x"[0]+Object("x")[0]!="xx";try{vt.nonEnumArgs=!zn.call(arguments,1)}catch(e){vt.nonEnumArgs=!0}}(0,0);var gt=function(){function e(){}return function(n){if(Me(n)){e.prototype=n;var t=new e;e.prototype=null}return t||wn.Object()}}(),Et=function(e,n){return function(t,r){var o=t?t.length:0;if(!ue(o))return e(t,r);for(var i=n?o:-1,s=ge(t);(n?i--:++i<o)&&!1!==r(s[i],i,s););return t}}(M),ht=function(e){return function(n,t,r){for(var o=ge(n),i=r(n),s=i.length,c=e?s:-1;e?c--:++c<s;){var a=i[c];if(!1===t(o[a],a,o))break}return n}}();Kn||($=Yn&&Zn?function(e){var n=e.byteLength,t=et?Wn(n/dt):0,r=t*dt,o=new Yn(n);if(t){var i=new et(o,0,t);i.set(new et(e,0,t))}return n!=r&&(i=new Zn(o,r),i.set(new Zn(e,r))),o}:Ke(null));var mt=tt&&Qn?function(e){return new g(e)}:Ke(null),yt=Ce(function(e,n){e||(e=[]),n=x(n);var t=n.length,o=T(e,n);for(n.sort(r);t--;){var i=parseFloat(n[t]);if(i!=s&&ce(i)){var s=i;$n.call(e,i,1)}}return o}),Rt=function(e,n){return function(t,r,i){if(r=te(r,i,3),At(t)){var s=o(t,r,n);return s>-1?t[s]:Qe}return b(t,r,e)}}(Et),St=function(e,n){return function(t,r,o){return"function"==typeof r&&void 0===o&&At(t)?e(t,r):n(t,Q(r,o,3))}}(y,Et),It=function(e,n){return function(t,r,o,i){var s=arguments.length<3;return"function"==typeof r&&void 0===i&&At(t)?e(t,r,o,s):q(t,te(r,i,4),o,s,n)}}(I,Et);vt.argsTag||(be=function(e){return ue(d(e)?e.length:Qe)&&Fn.call(e,"callee")&&!zn.call(e,"callee")});var At=nt||function(e){return d(e)&&ue(e.length)&&Bn.call(e)==en},Tt=s(/x/)||Zn&&!s(Zn)?function(e){return Bn.call(e)==on}:s,Nt=Xn?function(e){if(!e||Bn.call(e)!=cn||!l.support.argsTag&&be(e))return!1;var n=e.valueOf,t=Pe(n)&&(t=Xn(n))&&Xn(t);return t?e==t||Xn(e)==t:pe(e)}:pe,Ot=function(e){return function(n,t,r){return t=te(t,r,3),b(n,t,e,!0)}}(M),jt=rt?function(e){if(e)var n=e.constructor,t=e.length;return"function"==typeof n&&n.prototype===e||("function"==typeof e?l.support.enumPrototypes:t&&ue(t))?ve(e):Me(e)?rt(e):[]}:ve,Ct=function(e){return function(){var n=arguments,t=n.length,r=n[0];if(t<2||null==r)return r;var o=n[t-2],i=n[t-1],s=n[3];t>3&&"function"==typeof o?(o=Q(o,i,5),t-=2):(o=t>2&&"function"==typeof i?i:null,t-=o?1:0),s&&ae(n[1],n[2],s)&&(o=3==t?null:o,t=2);for(var c=0;++c<t;){var a=n[c];a&&e(r,a,o)}return r}}(F),Dt=Ce(function(e,n){if(null==e)return{};if("function"!=typeof n[0]){var n=S(x(n),String);return le(e,C(He(e),n))}var t=Q(n[0],n[1],3);return fe(e,function(e,n,r){return!t(e,n,r)})});l.prototype=f.prototype,p.prototype=gt(f.prototype),p.prototype.constructor=p,v.prototype=gt(f.prototype),v.prototype.constructor=v,g.prototype.push=h,l.callback=Ye,l.constant=Ke,l.drop=he,l.filter=Ae,l.flatten=me,l.forEach=St,l.keys=jt,l.keysIn=He,l.map=Ne,l.matches=Xe,l.merge=Ct,l.mixin=Je,l.omit=Dt,l.pull=Re,l.pullAt=yt,l.restParam=Ce,l.sortBy=je,l.take=Se,l.toPlainObject=Fe,l.values=Be,l.zipObject=Ie,l.collect=Ne,l.each=St,l.iteratee=Ye,l.object=Ie,l.select=Ae,l.clone=De,l.escapeRegExp=qe,l.find=Rt,l.findKey=Ot,l.identity=We,l.includes=Te,l.indexOf=ye,l.isArguments=be,l.isArray=At,l.isEqual=xe,l.isError=_e,l.isFunction=Tt,l.isNaN=we,l.isNative=Pe,l.isNull=Le,l.isNumber=Ue,l.isObject=Me,l.isPlainObject=Nt,l.isString=Ve,l.isTypedArray=ke,l.isUndefined=Ge,l.reduce=It,l.some=Oe,l.uniqueId=ze,l.any=Oe,l.contains=Te,l.detect=Rt,l.foldl=It,l.include=Te,l.inject=It,l.VERSION="3.6.0",Cn&&Dn&&Mn&&((Dn.exports=l)._=l)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,n,t){function r(){d=!1,c.length?u=c.concat(u):l=-1,u.length&&o()}function o(){if(!d){var e=setTimeout(r);d=!0;for(var n=u.length;n;){for(c=u,u=[];++l<n;)c&&c[l].run();l=-1,n=u.length}c=null,d=!1,clearTimeout(e)}}function i(e,n){this.fun=e,this.array=n}function s(){}var c,a=n.exports={},u=[],d=!1,l=-1;a.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];u.push(new i(e,n)),1!==u.length||d||setTimeout(o,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],3:[function(e,n,t){function r(e,n,t){for(var r,o="",i=0,s=e.length,c=s-2;i<c;){if(!((r=(e[i++]<<16)+(e[i++]<<8)+e[i++])>=0&&r<=16777215))throw new Error("not bytes");o+=n[r>>>18]+n[r>>>12&63]+n[r>>>6&63]+n[63&r]}if(i==c){if(!((r=(e[i++]<<8)+e[i++])>=0&&r<=65535))throw new Error("not bytes");o+=n[r>>>10]+n[r>>>4&63]+n[r<<2&63]+t}else if(i==s-1){if(!((r=e[i++])>=0&&r<=255))throw new Error("not bytes");o+=n[r>>>2]+n[r<<4&63]+t+t}return o}function o(e){e=e.replace(f,"");var n,t=e.length;n=e.charAt(t-1),"="!==n&&"."!==n||t--,"="!==(n=e.charAt(t-1))&&"."!==n||t--;var r=3*(t>>2),o=0;switch(t%4){case 2:o=1;break;case 3:o=2;break;case 1:throw new Error("bad base64")}for(var i,s=new Uint8Array(r+o),c=0,p=0;p<r;){if(!((i=a[e[c++]]+u[e[c++]]+d[e[c++]]+l[e[c++]])>=0&&i<=16777215))throw new Error("bad base64");s[p++]=i>>>16,s[p++]=i>>>8&255,s[p++]=255&i}if(o>0&&(i=a[e[c++]]+u[e[c++]],s[p++]=i>>>16,o>1&&(i+=d[e[c++]],s[p++]=i>>>8&255),!(i>=0&&i<=16776960&&0==(i&(o>1?255:65535)))))throw new Error("bad base64");return s}var i=Array.prototype.slice,s=i.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),c=i.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),a={},u={},d={},l={},f=/\s+/g;[s,c].forEach(function(e){for(var n,t=e.length;t--;)n=e[t],a[n]=t<<18,u[n]=t<<12,d[n]=t<<6,l[n]=t}),n.exports={encode:function(e){return r(e,s,"=")},encodeUrlSafe:function(e){return r(e,c,"")},decode:o}},{}],4:[function(e,n,t){function r(e){for(var n,t=0,r=e.length,o="";t<r;){if(!((n=e[t++])>=0&&n<=255))throw new Error("bad utf8");if(128&n)if(192==(224&n))n=((31&n)<<6)+(63&e[t++]);else{if(224!=(240&n))throw new Error("unsupported utf8 character");n=((15&n)<<12)+((63&e[t++])<<6)+(63&e[t++])}o+=String.fromCharCode(n)}return o}function o(e){var n,t,r,o=e.length,i=0,s=0;if(!(o>=0))throw new Error("bad string");for(t=o;t--;)r=e.charCodeAt(t),r<128?i++:i+=r<2048?2:3;for(n=new Uint8Array(i),t=0;t<o;t++)r=e.charCodeAt(t),r<128?n[s++]=r:r<2048?(n[s++]=192|r>>>6,n[s++]=128|63&r):(n[s++]=224|r>>>12,n[s++]=128|r>>>6&63,n[s++]=128|63&r);return n}n.exports={encode:o,decode:r}},{}],5:[function(e,n,t){(function(e){!function(e){"use strict";if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof t&&"object"==typeof n)n.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var r="undefined"!=typeof window?window:self,o=r.Q;r.Q=e(),r.Q.noConflict=function(){return r.Q=o,this}}}(function(){"use strict";function n(e){return function(){return W.apply(e,arguments)}}function t(e){return e===Object(e)}function r(e){return"[object StopIteration]"===ne(e)||e instanceof B}function o(e,n){if(F&&n.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(te)){for(var t=[],r=n;r;r=r.source)r.stack&&t.unshift(r.stack);t.unshift(e.stack);var o=t.join("\n"+te+"\n");e.stack=i(o)}}function i(e){for(var n=e.split("\n"),t=[],r=0;r<n.length;++r){var o=n[r];a(o)||s(o)||!o||t.push(o)}return t.join("\n")}function s(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function c(e){var n=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(n)return[n[1],Number(n[2])];var t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function a(e){var n=c(e);if(!n)return!1;var t=n[0],r=n[1];return t===H&&r>=q&&r<=ce}function u(){if(F)try{throw new Error}catch(r){var e=r.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],t=c(n);if(!t)return;return H=t[0],t[1]}}function d(e){return e instanceof v?e:m(e)?j(e):O(e)}function l(){function e(e){n=e,i.source=e,J(t,function(n,t){d.nextTick(function(){e.promiseDispatch.apply(e,t)})},void 0),t=void 0,r=void 0}var n,t=[],r=[],o=$(l.prototype),i=$(v.prototype);if(i.promiseDispatch=function(e,o,i){var s=X(arguments);t?(t.push(s),"when"===o&&i[1]&&r.push(i[1])):d.nextTick(function(){n.promiseDispatch.apply(n,s)})},i.valueOf=function(){if(t)return i;var e=E(n);return h(e)&&(n=e),e},i.inspect=function(){return n?n.inspect():{state:"pending"}},d.longStackSupport&&F)try{throw new Error}catch(e){i.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(t){n||e(d(t))},o.fulfill=function(t){n||e(O(t))},o.reject=function(t){n||e(N(t))},o.notify=function(e){n||J(r,function(n,t){d.nextTick(function(){t(e)})},void 0)},o}function f(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var n=l();try{e(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}return n.promise}function p(e){return f(function(n,t){for(var r=0,o=e.length;r<o;r++)d(e[r]).then(n,t)})}function v(e,n,t){void 0===n&&(n=function(e){return N(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var r=$(v.prototype);if(r.promiseDispatch=function(t,o,i){var s;try{s=e[o]?e[o].apply(r,i):n.call(r,o,i)}catch(e){s=N(e)}t&&t(s)},r.inspect=t,t){var o=t();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function g(e,n,t,r){return d(e).then(n,t,r)}function E(e){if(h(e)){var n=e.inspect();if("fulfilled"===n.state)return n.value}return e}function h(e){return e instanceof v}function m(e){return t(e)&&"function"==typeof e.then}function y(e){return h(e)&&"pending"===e.inspect().state}function R(e){return!h(e)||"fulfilled"===e.inspect().state}function S(e){return h(e)&&"rejected"===e.inspect().state}function I(){re.length=0,oe.length=0,se||(se=!0)}function A(n,t){se&&("object"==typeof e&&"function"==typeof e.emit&&d.nextTick.runAfter(function(){-1!==z(oe,n)&&(e.emit("unhandledRejection",t,n),ie.push(n))}),oe.push(n),t&&void 0!==t.stack?re.push(t.stack):re.push("(no stack) "+t))}function T(n){if(se){var t=z(oe,n);-1!==t&&("object"==typeof e&&"function"==typeof e.emit&&d.nextTick.runAfter(function(){var r=z(ie,n);-1!==r&&(e.emit("rejectionHandled",re[t],n),ie.splice(r,1))}),oe.splice(t,1),re.splice(t,1))}}function N(e){var n=v({when:function(n){return n&&T(this),n?n(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return A(n,e),n}function O(e){return v({when:function(){return e},get:function(n){return e[n]},set:function(n,t){e[n]=t},delete:function(n){delete e[n]},post:function(n,t){return null===n||void 0===n?e.apply(void 0,t):e[n].apply(e,t)},apply:function(n,t){return e.apply(n,t)},keys:function(){return ee(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function j(e){var n=l();return d.nextTick(function(){try{e.then(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}}),n.promise}function C(e){return v({isDef:function(){}},function(n,t){return w(e,n,t)},function(){return d(e).inspect()})}function D(e,n,t){return d(e).spread(n,t)}function b(e){return function(){function n(e,n){var s;if("undefined"==typeof StopIteration){try{s=t[e](n)}catch(e){return N(e)}return s.done?d(s.value):g(s.value,o,i)}try{s=t[e](n)}catch(e){return r(e)?d(e.value):N(e)}return g(s,o,i)}var t=e.apply(this,arguments),o=n.bind(n,"next"),i=n.bind(n,"throw");return o()}}function x(e){d.done(d.async(e)())}function _(e){throw new B(e)}function M(e){return function(){return D([this,P(arguments)],function(n,t){return e.apply(n,t)})}}function w(e,n,t){return d(e).dispatch(n,t)}function P(e){return g(e,function(e){var n=0,t=l();return J(e,function(r,o,i){var s;h(o)&&"fulfilled"===(s=o.inspect()).state?e[i]=s.value:(++n,g(o,function(r){e[i]=r,0==--n&&t.resolve(e)},t.reject,function(e){t.notify({index:i,value:e})}))},void 0),0===n&&t.resolve(e),t.promise})}function L(e){if(0===e.length)return d.resolve();var n=d.defer(),t=0;return J(e,function(r,o,i){function s(e){n.resolve(e)}function c(){0===--t&&n.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function a(e){n.notify({index:i,value:e})}var u=e[i];t++,g(u,s,c,a)},void 0),n.promise}function U(e){return g(e,function(e){return e=Q(e,d),g(P(Q(e,function(e){return g(e,Y,Y)})),function(){return e})})}function V(e){return d(e).allSettled()}function k(e,n){return d(e).then(void 0,void 0,n)}function G(e,n){return d(e).nodeify(n)}var F=!1;try{throw new Error}catch(e){F=!!e.stack}var H,B,q=u(),Y=function(){},K=function(){function n(){for(var e,n;r.next;)r=r.next,e=r.task,r.task=void 0,n=r.domain,n&&(r.domain=void 0,n.enter()),t(e,n);for(;a.length;)e=a.pop(),t(e);i=!1}function t(e,t){try{e()}catch(e){if(c)throw t&&t.exit(),setTimeout(n,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}var r={task:void 0,next:null},o=r,i=!1,s=void 0,c=!1,a=[];if(K=function(n){o=o.next={task:n,domain:c&&e.domain,next:null},i||(i=!0,s())},"object"==typeof e&&"[object process]"===e.toString()&&e.nextTick)c=!0,s=function(){e.nextTick(n)};else if("function"==typeof setImmediate)s="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var u=new MessageChannel;u.port1.onmessage=function(){s=d,u.port1.onmessage=n,n()};var d=function(){u.port2.postMessage(0)};s=function(){setTimeout(n,0),d()}}else s=function(){setTimeout(n,0)};return K.runAfter=function(e){a.push(e),i||(i=!0,s())},K}(),W=Function.call,X=n(Array.prototype.slice),J=n(Array.prototype.reduce||function(e,n){var t=0,r=this.length;if(1===arguments.length)for(;;){if(t in this){n=this[t++];break}if(++t>=r)throw new TypeError}for(;t<r;t++)t in this&&(n=e(n,this[t],t));return n}),z=n(Array.prototype.indexOf||function(e){
for(var n=0;n<this.length;n++)if(this[n]===e)return n;return-1}),Q=n(Array.prototype.map||function(e,n){var t=this,r=[];return J(t,function(o,i,s){r.push(e.call(n,i,s,t))},void 0),r}),$=Object.create||function(e){function n(){}return n.prototype=e,new n},Z=n(Object.prototype.hasOwnProperty),ee=Object.keys||function(e){var n=[];for(var t in e)Z(e,t)&&n.push(t);return n},ne=n(Object.prototype.toString);B="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var te="From previous event:";d.resolve=d,d.nextTick=K,d.longStackSupport=!1,"object"==typeof e&&e&&e.env&&e.env.Q_DEBUG&&(d.longStackSupport=!0),d.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(n,t){n?e.reject(n):arguments.length>2?e.resolve(X(arguments,1)):e.resolve(t)}},d.Promise=f,d.promise=f,f.race=p,f.all=P,f.reject=N,f.resolve=d,d.passByCopy=function(e){return e},v.prototype.passByCopy=function(){return this},d.join=function(e,n){return d(e).join(n)},v.prototype.join=function(e){return d([this,e]).spread(function(e,n){if(e===n)return e;throw new Error("Can't join: not the same: "+e+" "+n)})},d.race=p,v.prototype.race=function(){return this.then(d.race)},d.makePromise=v,v.prototype.toString=function(){return"[object Promise]"},v.prototype.then=function(e,n,t){function r(n){try{return"function"==typeof e?e(n):n}catch(e){return N(e)}}function i(e){if("function"==typeof n){o(e,c);try{return n(e)}catch(e){return N(e)}}return N(e)}function s(e){return"function"==typeof t?t(e):e}var c=this,a=l(),u=!1;return d.nextTick(function(){c.promiseDispatch(function(e){u||(u=!0,a.resolve(r(e)))},"when",[function(e){u||(u=!0,a.resolve(i(e)))}])}),c.promiseDispatch(void 0,"when",[void 0,function(e){var n,t=!1;try{n=s(e)}catch(e){if(t=!0,!d.onerror)throw e;d.onerror(e)}t||a.notify(n)}]),a.promise},d.tap=function(e,n){return d(e).tap(n)},v.prototype.tap=function(e){return e=d(e),this.then(function(n){return e.fcall(n).thenResolve(n)})},d.when=g,v.prototype.thenResolve=function(e){return this.then(function(){return e})},d.thenResolve=function(e,n){return d(e).thenResolve(n)},v.prototype.thenReject=function(e){return this.then(function(){throw e})},d.thenReject=function(e,n){return d(e).thenReject(n)},d.nearer=E,d.isPromise=h,d.isPromiseAlike=m,d.isPending=y,v.prototype.isPending=function(){return"pending"===this.inspect().state},d.isFulfilled=R,v.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},d.isRejected=S,v.prototype.isRejected=function(){return"rejected"===this.inspect().state};var re=[],oe=[],ie=[],se=!0;d.resetUnhandledRejections=I,d.getUnhandledReasons=function(){return re.slice()},d.stopUnhandledRejectionTracking=function(){I(),se=!1},I(),d.reject=N,d.fulfill=O,d.master=C,d.spread=D,v.prototype.spread=function(e,n){return this.all().then(function(n){return e.apply(void 0,n)},n)},d.async=b,d.spawn=x,d.return=_,d.promised=M,d.dispatch=w,v.prototype.dispatch=function(e,n){var t=this,r=l();return d.nextTick(function(){t.promiseDispatch(r.resolve,e,n)}),r.promise},d.get=function(e,n){return d(e).dispatch("get",[n])},v.prototype.get=function(e){return this.dispatch("get",[e])},d.set=function(e,n,t){return d(e).dispatch("set",[n,t])},v.prototype.set=function(e,n){return this.dispatch("set",[e,n])},d.del=d.delete=function(e,n){return d(e).dispatch("delete",[n])},v.prototype.del=v.prototype.delete=function(e){return this.dispatch("delete",[e])},d.mapply=d.post=function(e,n,t){return d(e).dispatch("post",[n,t])},v.prototype.mapply=v.prototype.post=function(e,n){return this.dispatch("post",[e,n])},d.send=d.mcall=d.invoke=function(e,n){return d(e).dispatch("post",[n,X(arguments,2)])},v.prototype.send=v.prototype.mcall=v.prototype.invoke=function(e){return this.dispatch("post",[e,X(arguments,1)])},d.fapply=function(e,n){return d(e).dispatch("apply",[void 0,n])},v.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},d.try=d.fcall=function(e){return d(e).dispatch("apply",[void 0,X(arguments,1)])},v.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},d.fbind=function(e){var n=d(e),t=X(arguments,1);return function(){return n.dispatch("apply",[this,t.concat(X(arguments))])}},v.prototype.fbind=function(){var e=this,n=X(arguments);return function(){return e.dispatch("apply",[this,n.concat(X(arguments))])}},d.keys=function(e){return d(e).dispatch("keys",[])},v.prototype.keys=function(){return this.dispatch("keys",[])},d.all=P,v.prototype.all=function(){return P(this)},d.any=L,v.prototype.any=function(){return L(this)},d.allResolved=function(e,n,t){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(n+" is deprecated, use "+t+" instead.",new Error("").stack),e.apply(e,arguments)}}(U,"allResolved","allSettled"),v.prototype.allResolved=function(){return U(this)},d.allSettled=V,v.prototype.allSettled=function(){return this.then(function(e){return P(Q(e,function(e){function n(){return e.inspect()}return e=d(e),e.then(n,n)}))})},d.fail=d.catch=function(e,n){return d(e).then(void 0,n)},v.prototype.fail=v.prototype.catch=function(e){return this.then(void 0,e)},d.progress=k,v.prototype.progress=function(e){return this.then(void 0,void 0,e)},d.fin=d.finally=function(e,n){return d(e).finally(n)},v.prototype.fin=v.prototype.finally=function(e){return e=d(e),this.then(function(n){return e.fcall().then(function(){return n})},function(n){return e.fcall().then(function(){throw n})})},d.done=function(e,n,t,r){return d(e).done(n,t,r)},v.prototype.done=function(n,t,r){var i=function(e){d.nextTick(function(){if(o(e,s),!d.onerror)throw e;d.onerror(e)})},s=n||t||r?this.then(n,t,r):this;"object"==typeof e&&e&&e.domain&&(i=e.domain.bind(i)),s.then(void 0,i)},d.timeout=function(e,n,t){return d(e).timeout(n,t)},v.prototype.timeout=function(e,n){var t=l(),r=setTimeout(function(){n&&"string"!=typeof n||(n=new Error(n||"Timed out after "+e+" ms"),n.code="ETIMEDOUT"),t.reject(n)},e);return this.then(function(e){clearTimeout(r),t.resolve(e)},function(e){clearTimeout(r),t.reject(e)},t.notify),t.promise},d.delay=function(e,n){return void 0===n&&(n=e,e=void 0),d(e).delay(n)},v.prototype.delay=function(e){return this.then(function(n){var t=l();return setTimeout(function(){t.resolve(n)},e),t.promise})},d.nfapply=function(e,n){return d(e).nfapply(n)},v.prototype.nfapply=function(e){var n=l(),t=X(e);return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},d.nfcall=function(e){var n=X(arguments,1);return d(e).nfapply(n)},v.prototype.nfcall=function(){var e=X(arguments),n=l();return e.push(n.makeNodeResolver()),this.fapply(e).fail(n.reject),n.promise},d.nfbind=d.denodeify=function(e){var n=X(arguments,1);return function(){var t=n.concat(X(arguments)),r=l();return t.push(r.makeNodeResolver()),d(e).fapply(t).fail(r.reject),r.promise}},v.prototype.nfbind=v.prototype.denodeify=function(){var e=X(arguments);return e.unshift(this),d.denodeify.apply(void 0,e)},d.nbind=function(e,n){var t=X(arguments,2);return function(){function r(){return e.apply(n,arguments)}var o=t.concat(X(arguments)),i=l();return o.push(i.makeNodeResolver()),d(r).fapply(o).fail(i.reject),i.promise}},v.prototype.nbind=function(){var e=X(arguments,0);return e.unshift(this),d.nbind.apply(void 0,e)},d.nmapply=d.npost=function(e,n,t){return d(e).npost(n,t)},v.prototype.nmapply=v.prototype.npost=function(e,n){var t=X(n||[]),r=l();return t.push(r.makeNodeResolver()),this.dispatch("post",[e,t]).fail(r.reject),r.promise},d.nsend=d.nmcall=d.ninvoke=function(e,n){var t=X(arguments,2),r=l();return t.push(r.makeNodeResolver()),d(e).dispatch("post",[n,t]).fail(r.reject),r.promise},v.prototype.nsend=v.prototype.nmcall=v.prototype.ninvoke=function(e){var n=X(arguments,1),t=l();return n.push(t.makeNodeResolver()),this.dispatch("post",[e,n]).fail(t.reject),t.promise},d.nodeify=G,v.prototype.nodeify=function(e){if(!e)return this;this.then(function(n){d.nextTick(function(){e(null,n)})},function(n){d.nextTick(function(){e(n)})})},d.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ce=u();return d})}).call(this,e("_process"))},{_process:2}],6:[function(e,n,t){n.exports=Object.freeze({STARTED_STATE_CHANGED:"startedStateChanged",DEVICE_AVAILABLE:"deviceAvailable",AVAILABLE_DEVICE_COUNT_CHANGED:"availableDeviceCountChanged",SWITCH_CREDENTIALS:"switchCredentials",MDX_DEVICES_AVAILABLE:"mdxDevicesAvailable",START_CONNECTING:"startConnecting",START_DISCONNECTING:"startDisconnecting"})},{}],7:[function(e,n,o){(function(o){var i=e("../builds/ld.js"),s=e("./enums.js"),c=e("./logging/logger.js"),a=e("./profiling/mdxProfiler.js"),u=e("./schedulerFactory.js"),d=e("./storageFactory.js"),l=e("./session/securityFactory.js"),f=e("./discovery/discoveryUtils.js"),p=e("./mdxError.js"),v=e("./versionInfo.js"),g=null,E=function(e,n,t){c.logLevel=t,n.logLevel=c.logLevel},h=function(e,n,t){if(n.platform.role!==s.roles.TARGET)throw new p(p.ERRORS.INVALID_CONFIG,"Registration mode is not a valid config option for "+n.platform.role);if(!i.findKey(s.registrationModes,function(e){return e===t}))throw new p(p.ERRORS.INVALID_ARG,"Registration mode: "+t);n.registrationMode=t},m=function(e,n,t){a.mode=t,n.profiler.mode=a.mode},y=function(e,n,t){i.isUndefined(g.profileId)?g.storage.getProfileId().success(function(e){e!==t&&(n.profileId=t)}):n.profileId=t},R=function(e,n,t,r){n[r]=t},S=function(e,n,t,r){n[r]="boolean"==typeof t&&t},I={logLevel:E,registrationMode:h,profilerMode:m,mdxContractVersion:R,volumeControl:R,volumeStep:R,profileId:y,playerStateFn:R,castGuestModeEnabled:S,castSessionRequestTimeout:R,castAutoJoinPolicy:R,castDefaultActionPolicy:R,defaultFriendlyName:R},A=function(){var n,o,p,g,E,h,m=this,y=new v(t+"-"+r),R=null;return Object.defineProperty(this,"versionInfo",{enumerable:!1,get:function(){return y}}),Object.defineProperties(this,{version:{enumerable:!0,get:function(){return y.toString()}},nativeVersion:{enumerable:!0,get:function(){switch(n.id){case 3:return cast&&cast.receiver.VERSION||"";case 2:case 6:case 8:return nrdp.mdx&&nrdp.mdx.nativeVersion||"";default:return""}}},uiVersion:{enumerable:!0,get:function(){switch(n.id){case 3:case 2:case 6:case 8:return nrdp.device&&nrdp.device.UIVersion||"";default:return""}}},platform:{enumerable:!0,get:function(){return n},set:function(e){n=e,o=u.createScheduler(n),p=d.createStorageProvider(n),p&&p.getProfileId().success(function(e){m.profileId=e}),p&&p.getMdxId().success(function(e){m.currentMdxId=e})}},mdxUuid:{enumerable:!0,get:function(){if(!R)switch(n.id){case 2:case 6:case 8:R=nrdp.device.ESN;break;case 4:case 5:R=l.platformCrypto?l.platformCrypto.getEsn():"";break;default:R=""}return R},set:function(e){R=e}},profileId:{enumerable:!0,get:function(){return h},set:function(n){if(p&&h!==n){var t=!i.isUndefined(h);h=n,p.setProfileId(n),t&&e("./session/pairing.js").clearAllPairings()}}},isStarted:{enumerable:!0,writable:!0,value:!1},logLevel:{enumerable:!0,writable:!0,value:c.logLevel},registrationMode:{enumerable:!0,writable:!0,value:s.registrationModes.DISABLED},pairingPin:{enumerable:!0,writable:!0,value:"00000"},mdxContractVersion:{enumerable:!0,writable:!0,value:1},volumeControl:{enumerable:!0,writable:!0,value:!1},volumeStep:{enumerable:!0,writable:!0,value:""},currentMdxId:{enumerable:!0,get:function(){return E||p.getMdxId().success(function(e){E=e}),E},set:function(e){if(!p||E===e)return void c.error("currentMdxId setter: no storage!!!");p.setMdxId(e),E=e}},profiler:{enumerable:!0,writable:!0,value:{mode:a.mode,getData:function(){return a.getData.apply(null,arguments)}}},castGuestModeEnabled:{enumerable:!0,writable:!0,value:!1},castSessionRequestTimeout:{enumerable:!0,writable:!0,value:2e4},castAutoJoinPolicy:{enumerable:!0,writable:!0,value:null},castDefaultActionPolicy:{enumerable:!0,writable:!0,value:null},defaultFriendlyName:{enumerable:!0,writable:!0,value:"Netflix Device"},scheduler:{enumerable:!1,get:function(){return o}},dscMgr:{enumerable:!1,get:function(){return g},set:function(e){g=e}},storage:{enumerable:!1,get:function(){return p}},testConfig:{enumerable:!1,writable:!0,value:null},localMdxPort:{enumerable:!1,writable:!0,value:"9080"},playerStateFn:{enumerable:!1,writable:!0,value:null},responseHeaders:{enumerable:!1,get:function(){var e,t=f.headers,r={};return e=2===n.id?nrdjs&&nrdjs.profiles&&null!==nrdjs.profiles.current()?1:0:nrdp.registration.registered?1:0,r[t.regMode]=m.registrationMode,r[t.msl]=i.isUndefined(nrdp.ntba)?1:0,r[t.caps]="",r[t.id]=m.currentMdxId,r[t.registered]=e,r}}}),this};n.exports={get current(){return g||(g=new A)},reset:function(){g=null},process:function(e,n,t){i.forEach(t,function(t,r){var o=I[r];if(!o)return void c.error("Invalid configuration value specified: "+r);o(e,n,t,r)})}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../builds/ld.js":1,"./discovery/discoveryUtils.js":31,"./enums.js":33,"./logging/logger.js":38,"./mdxError.js":44,"./profiling/mdxProfiler.js":45,"./schedulerFactory.js":48,"./session/pairing.js":62,"./session/securityFactory.js":65,"./storageFactory.js":67,"./versionInfo.js":74}],8:[function(e,n,t){n.exports=Object.freeze({DISCOVERY_STATE_CHANGED:"discoveryStateChanged",LAUNCH_STATE_CHANGED:"launchStateChanged",PROPERTY_CHANGED:"propertyChanged",NEW_APP_MESSAGE:"newAppMessage",APP_CONNECTION_ENDED:"appConnectionEnded"})},{}],9:[function(e,n,t){var r=/[https?|wss?]:\/\/([0-2][0-9]{0,2}\.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}):?([0-9]{0,5})?/;n.exports={ipAddressFromLocation:function(e){var n=r.exec(e);return n?n[1]:""},ipAddressAndPortFromLocation:function(e){var n=r.exec(e);return n?n[1]+":"+n[2]:""}}},{}],10:[function(e,n,t){var r=e("./mdxController.js"),o=function(e,n,t){return r.call(this,e,n,t),Object.defineProperties(this,{wasLaunchingController:{enumerable:!0,value:e&&e.wasLaunchingController||!1}}),this};o.prototype=Object.create(r.prototype),o.prototype.persistentType="CastController",o.prototype.shouldShutDownOnUnavailable=function(){return this.wasExplicitLastDisconnect},n.exports=o},{"./mdxController.js":14}],11:[function(e,n,t){var r=(e("../logging/logger.js"),e("../enums.js")),o=e("../discovery/discoveryEvents.js"),i=e("../profiling/mdxProfiler.js"),s=e("../configuration.js"),c=e("./mdxTarget.js"),a=function(e,n,t){c.call(this,e,n);var i=this,s=n;Object.defineProperties(this,{registrationMode:{enumerable:!0,writable:!0,value:e&&e.registrationMode||r.registrationModes.DISABLED},isGuestMode:{enumerable:!1,writable:!0,value:e&&e.isGuestMode||!1},canJoinInGuestMode:{enumerable:!1,writable:!0,value:!1}});var a=[];if(a.push({name:o.DEVICE_REFOUND,handler:s.addEventListener(o.DEVICE_REFOUND,i.onDeviceRefound.bind(i))}),a.push({name:o.DEVICE_GONE,handler:s.addEventListener(o.DEVICE_GONE,i.onDeviceByeBye.bind(i))}),i.discoveryState=r.discoveryStates.AVAILABLE,!i.session){var u=new t;i.session=u}return this.disposeInternal=function(){for(;a.length;){var e=a.pop();n.removeEventListener(e.name,e.handler)}i.session&&i.session.dispose()},this};a.prototype=Object.create(c.prototype),a.prototype.onDeviceByeBye=function(e){var n=this;e.device===n&&(n.discoveryState=r.discoveryStates.UNAVAILABLE,i.newMarker(i.EVENTS.DEVICE_GONE,this.id))},a.prototype.updateDeviceInfo=function(e){var n=this;n.ipAddress=e.ipAddress,n.friendlyName=e.friendlyName,n.lastSeen=(new Date).valueOf(),n.isGuestMode=s.current.castGuestModeEnabled&&e.isGuestMode||!1},a.prototype.onDeviceRefound=function(e){var n=this;e.device===n&&(n.updateDeviceInfo.call(n,e.deviceInfo),n.discoveryState=r.discoveryStates.AVAILABLE,s.current.scheduler.async(n.refresh.bind(n)))},a.prototype.persistentType="CastTarget",a.prototype.dispose=function(){var e=this;return c.prototype.dispose.call(e).finally(e.disposeInternal)},a.prototype.disconnectFromApp=function(e){var n=this;return c.prototype.disconnectFromApp.call(n,e).finally(function(){n.session&&(n.session.cleanupCastConnection(),n.canJoinInGuestMode=!1)})},n.exports=a},{"../configuration.js":7,"../discovery/discoveryEvents.js":29,"../enums.js":33,"../logging/logger.js":38,"../profiling/mdxProfiler.js":45,"./mdxTarget.js":18}],12:[function(e,n,t){var r=e("../enums.js"),o=e("../session/castTargetSessionChrome.js"),i=e("./mdxTarget.js"),s=function(e,n,t){var s=this;return i.call(s,e,n),s.session=new o(t,n.config.mdxNamespace),s.discoveryState=r.discoveryStates.AVAILABLE,s.launchState=r.launchStates.LAUNCHED,s};s.prototype=Object.create(i.prototype),s.prototype.persistentType="CastTarget",s.prototype.stopApp=function(){return this.session.stop()},n.exports=s},{"../enums.js":33,"../session/castTargetSessionChrome.js":53,"./mdxTarget.js":18}],13:[function(e,n,t){var r=e("q"),o=e("../logging/logger.js"),i=e("../enums.js"),s=e("../configuration.js"),c=e("./mdxCastTargetBase.js"),a=e("../session/castTargetSessionV2.js"),u=e("../mdxError.js"),d=i.discoveryStates,l=i.launchStates,f=function(e,n){this.evtMgr.fireEvent.call(this,e,n)},p=function(e){if(e.code!==e.NoError){var n=this;n.discoveryState===d.AVAILABLE&&(n.discoveryState=d.PENDING);var t=n.session;t?t.cleanupCastConnection.call(n.session).then(t.end.bind(t,!1)).then(f.bind(n,n.CAST_EVENTS.DISCONNECT,{error:e})):f.call(n,n.CAST_EVENTS.DISCONNECT,{error:e})}},v=function(e){var n=this;n.launchState=l.NOT_LAUNCHED,f.call(n,n.CAST_EVENTS.APP_DISCONNECT,{error:e})},g=function(e){var n=this;n.discoveryState=d.PENDING,f.call(n,n.CAST_EVENTS.SUSPEND,{reason:e})},E=function(e){var n=this;e?(n.discoveryState=d.AVAILABLE,n.launchState=l.LAUNCHED):n.refresh(),f.call(n,n.CAST_EVENTS.RESUME,{rejoinedApp:e})},h=function(e){var n=this;void 0!==e.applicationID&&(n.discoveryState=d.AVAILABLE,e.applicationID===n.discoveryComponent.config.appId?n.launchState=l.LAUNCHED:n.launchState=l.NOT_LAUNCHED,f.call(n,n.CAST_EVENTS.APP_METADATA,{appMetadata:e}))},m=function(e,n,t,r){var o=this,u=null,d=t;return c.call(o,e,n,a),Object.defineProperties(o,{castDevice:{enumerable:!1,get:function(){return d},set:function(e){(d=e)&&o.session.mdxSessionId||(o.deviceMgr=null)}},deviceMgr:{enumerable:!1,get:function(){return u},set:function(e){null===e&&u&&(u.setDelegate(null),o.session.cleanupCastConnection()),u=e}}}),o.addEventListener(o.EVENTS.DISCOVERY_STATE_CHANGED,function(e){e.state===i.discoveryStates.UNAVAILABLE&&(o.session.cleanupCastConnection(),o.deviceMgr=null)}),o.initDeviceManager().then(function(){var e=s.current.scheduler;o.refresh.call(o).finally(e.async.bind(e,r.bind(o)))}),o};m.prototype=Object.create(c.prototype),m.prototype.initDeviceManager=function(){var e=this,n=r.defer();if(e.deviceMgr&&(e.deviceMgr=null),!e.castDevice)return r.reject();var t=NFGCKDeviceManager.jsInitWithDevice;return"function"!=typeof t&&(t=NFGCKDeviceManager.initWithDevice),t(e.castDevice,function(t){var r=NFGCKDeviceManagerDelegate.jsInit;"function"!=typeof r&&(r=NFGCKDeviceManagerDelegate.init);var i=r();if(!t||!i)return o.error("Failed to create cast device manager and delegate",e.id,e.friendlyName),void(e.discoveryState=d.ERROR);var s=e.CAST_EVENTS;i.didConnect=function(){f.call(e,s.CONNECT)},i.didFailToConnect=function(n,t){f.call(e,s.CONNECT_FAILED,{error:t})},i.didDisconnect=function(n,t){p.call(e,t)},i.didSuspendConnection=function(n,t){g.call(e,t)},i.didResumeConnection=function(n,t){E.call(e,t)},i.didConnectToCastApplication=function(n,t,r,o){f.call(e,s.APP_CONNECT,{appMetadata:t,sessionId:r,launched:o})},i.didFailToConnectToApplication=function(n,t){f.call(e,s.APP_CONNECT_FAILED,{error:t})},i.didDisconnectFromApplication=function(n,t){v.call(e,t)},i.didStopApplication=function(){f.call(e,s.APP_STOPPED)},i.didFailToStopApplication=function(n,t){f.call(e,s.APP_STOP_FAILED,{error:t})},i.didReceiveApplicationMetadata=function(n,t){h.call(e,t)},i.didReceiveApplicationStatusText=function(n,t){f.call(e,s.APP_STATUS,{statusText:t})},i.volumeDidChange=function(n,t,r){f.call(e,s.VOLUME_CHANGED,{level:t,isMuted:r})},i.didReceiveActiveInputStatus=function(n,t){f.call(e,s.ACTIVE_INPUT_STATUS,{status:t})},i.didReceiveStandbyStatus=function(n,t){f.call(e,s.STANDBY_STATUS,{status:t})},i.requestDidFail=function(n,t,r){f.call(e,s.REQUEST_FAILED,{requestId:t,error:r})},t.setDelegate(i),e.deviceMgr=t,n.resolve()}),n.promise},m.prototype.connectToApp=function(e,n){var t=this;return t.deviceMgr?c.prototype.connectToApp.call(t,e,n):t.initDeviceManager().then(c.prototype.connectToApp.bind(t,e,n),function(){return r.reject(new u(u.ERRORS.CONNECT_FAILED,"Failed to intialize cast device manager"))})},m.prototype.dispose=function(){var e=this;return c.prototype.dispose.call(e).finally(function(){e.deviceMgr&&(e.deviceMgr.disconnectWithLeave(),e.deviceMgr=null),e.castDevice=null})},m.prototype.stopApp=function(){var e=this,n=r.defer();return e.session&&e.deviceMgr?(e.deviceMgr.stopApplicationWithSessionID(e.session.sessionId,function(){n.resolve()}),n.promise):r.reject()},m.prototype.CAST_EVENTS={CONNECT:"connect",CONNECT_FAILED:"connectFailed",DISCONNECT:"disconnect",SUSPEND:"suspend",RESUME:"resume",APP_CONNECT:"appConnect",APP_CONNECT_FAILED:"appConnectFailed",APP_DISCONNECT:"appDisconnect",APP_STOPPED:"appStopped",APP_STOP_FAILED:"appStopFailed",APP_METADATA:"appMetadata",APP_STATUS:"appStatus",VOLUME_CHANGED:"volumeChanged",ACTIVE_INPUT_STATUS:"activeInputStatus",STANDBY_STATUS:"standbyStatus",REQUEST_FAILED:"requestFailed"},m.prototype.getConnectionState=function(){var e=this,n=r.defer(),t=function(){var t=e.deviceMgr;t.isReconnecting(function(e){e?n.resolve({isReconnecting:!0,isConnected:!1,isConnectedToApp:!1}):t.connectionState(function(e){t.applicationConnectionState(function(r){n.resolve({isReconnecting:!1,isConnected:e===t.ConnectionStateConnected,isConnectedToApp:r===t.ConnectionStateConnected})})})})};return e.deviceMgr?t():e.initDeviceManager().then(t),n.promise},m.prototype.refresh=function(e){var n=this,t=n.launchState===i.launchStates.PENDING,c=r.defer();if(!n.castDevice)return o.warn("MdxCastTargetV2.refresh was invoked but we don't have a cast device instance",n.castDevice),r.reject();var a=function r(o){n.deviceMgr.applicationMetadata.call(n.deviceMgr,function(a){if(o&&void 0===a.applicationID)return void s.current.scheduler.delay(r.bind(n,!1),500);a.applicationID===n.discoveryComponent.config.appId?e&&t?n.connectToApp(i.connectIntents.JOIN).then(function(){n.launchState=l.LAUNCHED,n.getPlayerState()},function(){n.launchState=l.NOT_LAUNCHED}).finally(c.resolve):(n.launchState=l.LAUNCHED,c.resolve()):(n.launchState=l.NOT_LAUNCHED,c.resolve())})};return n.getConnectionState.call(n).done(function(t){t.isReconnecting?s.current.scheduler.delay(n.refresh.bind(n,e),500):t.isConnected?(n.discoveryState=d.AVAILABLE,a(!0)):n.isGuestMode?(n.launchState=l.NOT_LAUNCHED,n.discoveryState===d.PENDING&&(n.discoveryState=d.AVAILABLE),c.reject()):n.session?n.session.createDeviceConnection().done(function(){n.discoveryState=d.AVAILABLE,a(!1)},function(){n.discoveryState=d.UNAVAILABLE,c.reject()}):c.reject()},c.reject),c.promise},n.exports=m},{"../configuration.js":7,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../session/castTargetSessionV2.js":54,"./mdxCastTargetBase.js":11,q:5}],14:[function(e,n,t){var r=(e("../logging/logger.js"),e("../enums.js")),o=e("../discovery/discoveryEvents.js"),i=e("./mdxDevice.js"),s=e("./deviceUtils.js"),c=function(e){e.device===this&&(this.discoveryState=r.discoveryStates.AVAILABLE)},a=function(e){e.device===this&&(this.discoveryState=r.discoveryStates.UNAVAILABLE)},u=function(e,n,t){i.call(this,e,n,t),Object.defineProperties(this,{controllerType:{enumerable:!0,value:e&&e.controllerType||r.controllerTypes.MDX},mdxInfo:{enumerable:!0,writable:!0,value:{location:e.location,isAvailable:!0,capabilities:[],ipAddressAndPort:s.ipAddressAndPortFromLocation(e.location)}},ipAddress:{enumerable:!1,writable:!0,value:""}});var u=[];return u.push({name:o.DEVICE_REFOUND,handler:n.addEventListener(o.DEVICE_REFOUND,c.bind(this))}),u.push({name:o.DEVICE_GONE,handler:n.addEventListener(o.DEVICE_GONE,a.bind(this))}),this.discoveryState=r.discoveryStates.AVAILABLE,this.disposeInternal=function(){for(;u.length;){var e=u.pop();n.removeEventListener(e.name,e.handler)}},this};u.prototype=Object.create(i.prototype),u.prototype.CONTROLLER_TYPES=r.controllerTypes,u.prototype.getPersistentData=function(){return this.controllerType!==r.controllerTypes.MDX?null:i.prototype.getPersistentData.call(this)},u.prototype.dispose=function(){return this.disposeInternal(),i.prototype.dispose.call(this)},n.exports=u},{"../discovery/discoveryEvents.js":29,"../enums.js":33,"../logging/logger.js":38,"./deviceUtils.js":9,"./mdxDevice.js":15}],15:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("../enums.js"),c=e("./deviceEvents.js"),a=e("../profiling/mdxProfiler.js"),u=e("../eventManager.js"),d=e("../mdxError.js"),l=e("./mdxMsgStreamBinding.js"),f=function(e,n,t){var r=this,a=s.discoveryStates.UNKNOWN,d=new u,l=new u,f=e&&e.mdxUuid,p=e&&e.currentMdxId,v=e&&e.sharedSecret,g=t;return g&&(g.device=this),Object.defineProperties(this,{id:{enumerable:!0,value:e&&e.id||parseInt(o.uniqueId((new Date).valueOf())).toString(16)},lastSeen:{enumerable:!0,writable:!0,value:(new Date).valueOf()},evtMgr:{enumerable:!1,get:function(){return d}},msgMgr:{enumerable:!1,get:function(){return l}},discoveryComponent:{enumerable:!1,value:n},discoveryState:{enumerable:!0,get:function(){return a},set:function(e){if(a!==e){a=e,r.onDiscoveryStateUpdated&&r.onDiscoveryStateUpdated.call(r,a);var n={device:r,state:a};a===s.discoveryStates.UNAVAILABLE&&r.shouldShutDownOnUnavailable()&&(n.shouldShutDown=!0);try{d.fireEvent(c.DISCOVERY_STATE_CHANGED,n)}catch(e){i.warn("Event handler exception",e)}}}},isAvailable:{enumerable:!0,get:function(){var e=s.discoveryStates;return a===e.AVAILABLE||a===e.PENDING}},mdxUuid:{enumerable:!0,get:function(){return f},set:function(e){f=e}},currentMdxId:{enumerable:!0,get:function(){return p},set:function(e){p=e}},sharedSecret:{enumerable:!0,get:function(){return v},set:function(e){v=e}},session:{enumerable:!1,get:function(){return g},set:function(e){(g=e)&&(g.device=this)}}}),this.addEventListener=d.addEventListener.bind(this),this.removeEventListener=d.removeEventListener.bind(this),this.addMessageListener=l.addEventListener.bind(this),this.removeMessageListener=l.removeEventListener.bind(this),this};f.prototype.EVENTS=c,f.prototype.DISCOVERY_STATES=s.discoveryStates,f.prototype.LAUNCH_STATES=s.launchStates,f.prototype.shouldShutDownOnUnavailable=function(){return!1},f.prototype.onAppMessage=function(e){try{var n=this;if(a.currentIntent&&("PLAYER_STATE_CHANGED"===e.type?a.currentIntent.processStateChange(e.payload):"AUDIO_SUBTITLES_CHANGED"===e.type&&a.currentIntent.processAudioSubtitlesChanged(e.payload)),n.launchState===s.launchStates.UNKNOWN||n.launchState===s.launchStates.NOT_LAUNCHED)return void i.warn("Dropping app message because the device is not launched. Launch State: "+n.launchState,e);var t=o.merge({device:n},e);n.msgMgr.fireEvent(e.type,t),t.name=t.type,n.evtMgr.fireEvent(c.NEW_APP_MESSAGE,t)}catch(e){i.warn("Msg handler exception",e)}},f.prototype.sendAppMessage=function(e,n){var t,o=this.session;return o?o.errMsgCount>2?(t="Dropping message to device due to session error message threshold exceeded",r.reject(new d(d.ERRORS.MESSAGING_ERROR),t)):o.sendAppMessage(e,n):(t="Device "+this.id+" has no active session. Dropping message",r.reject(new d(d.ERRORS.NOT_CONNECTED),t))},f.prototype.getPersistentData=function(){var e=this;return{type:e.persistentType,id:e.id,mdxUuid:e.mdxUuid,currentMdxId:e.currentMdxId,sharedSecret:e.sharedSecret,lastSeen:e.lastSeen}},f.prototype.clearPairing=function(){var e=this;e.session&&e.session.end(!!e.session.mdxSessionId,!0),e.sharedSecret=null,e.currentMdxId=null},f.prototype.blacklist=function(e){i.error("Device was blacklisted: "+e),this.discoveryState=s.discoveryStates.ERROR},f.prototype.disconnectFromApp=function(){var e=this,n=e.session;if(n){var t=e.launchState===s.launchStates.LAUNCHED&&null!==n.mdxSessionId;return n.end(t,!0)}return r.resolve()},f.prototype.dispose=function(){var e=this;return e.session&&(e.session.end(!1),e.session=null),r.resolve()},f.prototype.onAppConnectionEnded=function(){try{this.evtMgr.fireEvent(c.APP_CONNECTION_ENDED,{device:this})}catch(e){i.error("UI exception handling APP_CONNECTION_ENDED",e,e.stack)}},f.prototype.bindMsgStream=function(e,n,t,r){return new l(this,e,n,t,r)},n.exports=f},{"../../builds/ld.js":1,"../enums.js":33,"../eventManager.js":34,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./deviceEvents.js":8,"./mdxMsgStreamBinding.js":17,q:5}],16:[function(e,n,t){var r=e("../../builds/ld.js"),o=e("../logging/logger.js"),i=e("./deviceUtils.js"),s=e("../discovery/discoveryEvents.js"),c=e("../enums.js"),a=e("../configuration.js"),u=e("./serviceInfo.js"),d=e("../httpFactory.js"),l=e("../discovery/discoveryUtils.js"),f=e("../session/ping.js"),p=e("./mdxTarget.js"),v=e("../session/dialTargetSession.js"),g=e("../versionInfo.js"),E={},h=function(){r.forEach(E[this.id],function(e){a.current.scheduler.cancelDelay(e)})},m=function(e){var n=this;if(e.isMdx){var t=function(){n.launchState=c.launchStates.NOT_LAUNCHED,n.session&&n.session.end(!1,!0),n.dialInfo.isAvailable||(n.discoveryState=c.discoveryStates.UNAVAILABLE),n.mdxInfo.isAvailable=!1};n.session?f.pingTarget.call(n.session,n).done(function(){y.call(n,a.current.scheduler,e)},t):t()}else if(e.isDial){var r=d.createHttpClient(a.current.platform);r.get(n.dialInfo.dialAppUrl).done(function(){y.call(n,a.current.scheduler,e)},function(e){n.mdxInfo.isAvailable||(n.discoveryState=c.discoveryStates.UNAVAILABLE),n.dialInfo.isAvailable=!1})}},y=function(e,n){var t=this,r=E[t.id];r||(r=E[t.id]={});var o=n.toNonVersionedString();r[o]&&e.cancelDelay(r[o]),r[o]=e.delay(m.bind(t,n),35e3)},R=function(e,n){if(n.device===this){var t=n.serviceType;y.call(this,e,t)}},S=function(e,n){var t=this;if(n.device===t)if(t.targetRestartDeferred){t.discoveryState=c.discoveryStates.PENDING;var r=function e(n){t.removeEventListener(t.EVENTS.LAUNCH_STATE_CHANGED,e),n.launchState===c.launchStates.LAUNCHED?t.targetRestartDeferred.resolve():t.targetRestartDeferred.reject()};t.addEventListener(t.EVENTS.LAUNCH_STATE_CHANGED,r)}else m.call(t,n.deviceInfo.serviceType)},I=function(e,n){n.isStarted||h.call(this)},A=function(e,n){p.call(this,e,n);var t=this,r=n,o=e.dialInfo||new u.DialInfo(e.dialUsn,e.dialAppUrl),d=new u.MdxInfo(e.mdxUsn,e.headers[l.headers.regMode]);Object.defineProperties(this,{dialInfo:{enumerable:!1,get:function(){return o}},mdxInfo:{enumerable:!1,get:function(){return d}},ipAddress:{enumerable:!1,writable:!0,value:""},registrationMode:{enumerable:!0,get:function(){return d.isAvailable&&d.registrationMode}}}),this.isDeviceMatch=function(e){var n=e.usn,r=e.location||"";return n===o.usn||n===d.usn||t.ipAddress===i.ipAddressFromLocation(r)},t.updateDeviceInfo.call(t,e),t.discoveryState=c.discoveryStates.AVAILABLE;var f=[];f.push({name:s.DEVICE_REFOUND,handler:r.addEventListener(s.DEVICE_REFOUND,R.bind(t,a.current.scheduler))}),f.push({name:s.DEVICE_GONE,handler:r.addEventListener(s.DEVICE_GONE,S.bind(t,a.current.scheduler))}),f.push({name:s.STARTED_STATE_CHANGED,handler:r.addEventListener(s.STARTED_STATE_CHANGED,I.bind(t,a.current.scheduler))});var m=new g(e.headers[l.headers.mdxVersion]);return t.session=new v(m),this.disposeInternal=function(){for(;f.length;){var e=f.pop();n.removeEventListener(e.name,e.handler);E[t.id]&&h.call(t)}},this};A.prototype=Object.create(p.prototype),A.prototype.persistentType="DialTarget",A.prototype.updateDeviceInfo=function(e){var n,t=e.serviceType,s=this;if(t.isDial)n=this.dialInfo,s.launchState===c.launchStates.UNKNOWN&&(s.launchState=c.launchStates.NOT_LAUNCHED),!n.dialAppUrl&&e.dialAppUrl&&(n.dialAppUrl=e.dialAppUrl),n.dialAppUrl&&n.updateDialInfo();else if(t.isMdx){if(n=this.mdxInfo,n.isAvailable=!0,s.mdxUuid=e.usn.substr(5),e.headers){
var u=e.headers,d=u[l.headers.caps]||u[l.headers.caps.toLowerCase()],f=u[l.headers.regMode]||u[l.headers.regMode.toLowerCase()],p=f?r.find(c.registrationModes,function(e){return e===f}):c.registrationModes.DISABLED;n.capabilities=d?d.split(","):[],n.registrationMode=p,s.isRegistered="1"===(u[l.headers.registered]||u[l.headers.registered.toLowerCase()]),s.isMsl="1"===(u[l.headers.msl]||u[l.headers.msl.toLowerCase()]);var v=u[l.headers.mdxVersion];v&&(s.session.mdxVersion=new g(v))}}else o.warn("MdxDialTarget cannot update device information",e);n.serviceType=e.serviceType,n.location=e.location,n.usn=e.usn,s.discoveryState=c.discoveryStates.AVAILABLE,s.ipAddress=i.ipAddressFromLocation(n.location),t.isMdx&&(s.launchState=c.launchStates.LAUNCHED);var h=E[s.id];if(h){h[t.toNonVersionedString()]||y.call(s,a.current.scheduler,t)}else y.call(s,a.current.scheduler,t)},A.prototype.getPersistentData=function(){var e=p.prototype.getPersistentData.call(this);return e?r.merge(e,{mdxUsn:this.mdxInfo.usn,dialUsn:this.dialInfo.usn,ipAddress:this.ipAddress}):null},A.prototype.dispose=function(){return this.disposeInternal(),p.prototype.dispose.call(this)},A.prototype.refresh=function(e){var n=this,t=n.launchState===c.launchStates.PENDING,r=function(){n.launchState=c.launchStates.LAUNCHED,y.call(n,a.current.scheduler,n.mdxInfo.serviceType),e&&t&&n.getPlayerState()};n.dialInfo&&n.dialInfo.isAvailable&&m.call(n,n.dialInfo.serviceType),n.mdxInfo&&n.mdxInfo.isAvailable&&n.session&&n.session.verifyTargetLaunched(n,!1).timeout(3e3).done(r,m.bind(n,n.mdxInfo.serviceType))},A.prototype.suspendDiscovery=function(e){p.prototype.suspendDiscovery.call(this,e),h.call(this)},n.exports=A},{"../../builds/ld.js":1,"../configuration.js":7,"../discovery/discoveryEvents.js":29,"../discovery/discoveryUtils.js":31,"../enums.js":33,"../httpFactory.js":35,"../logging/logger.js":38,"../session/dialTargetSession.js":55,"../session/ping.js":63,"../versionInfo.js":74,"./deviceUtils.js":9,"./mdxTarget.js":18,"./serviceInfo.js":19}],17:[function(e,n,t){var r=e("../../builds/ld.js"),o=e("../configuration.js"),i=e("../mdxError.js"),s=function(e){var n=this;n.listener&&n.listener.call(n,e.type,e.payload,n)},c=function(e){var n=this;n.delayId&&o.current.scheduler.cancelDelay(n.delayId),r.forEach(n.msgNames,function(e){n.device.removeMessageListener(e,n.onStreamMessage)}),n.onStopped&&n.onStopped(e),n.onStopped=null,n.listener=null,n.msgNames=null},a=function(e,n,t,a,u){var d=this,l="function"==typeof u?u:null;return Object.defineProperties(d,{device:{enumerable:!1,writable:!1,value:e},msgNames:{enumerable:!1,writable:!1,value:n},listener:{enumerable:!0,writable:!0,value:a},onStopped:{enumerable:!0,get:function(){return l},set:function(e){if(null!=e&&"function"!=typeof e)throw new i(i.ERRORS.INVALID_ARG,"MdxMsgStreamBinding.onStopped must be a function");l=e}},onStreamMessage:{enumerable:!1,writable:!1,value:s.bind(d)},delayId:{enumerable:!1,writable:!0,value:null}}),r.forEach(n,function(n){e.addMessageListener(n,d.onStreamMessage)}),parseInt(t)>0&&(d.delayId=o.current.scheduler.delay(c.bind(d,!0),t)),this};a.prototype.stop=function(){c.call(this,!1)},n.exports=a},{"../../builds/ld.js":1,"../configuration.js":7,"../mdxError.js":44}],18:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("./deviceEvents.js"),c=e("../enums.js"),a=e("../configuration.js"),u=e("../profiling/mdxProfiler.js"),d=e("../discovery/discoveryUtils.js"),l=e("./mdxDevice.js"),f=e("../mdxError.js"),p=[f.ERRORS.USER_MISMATCH.code,f.ERRORS.REGISTRATION_NOT_SUPPORTED.code,f.ERRORS.APP_NOT_RUNNING.code,f.ERRORS.CANCELLED.code],v=function(e,n){l.call(this,e,n);var t=this,r=e&&e.friendlyName||"Device "+this.id,o=c.launchStates.UNKNOWN;return Object.defineProperties(this,{friendlyName:{enumerable:!0,get:function(){return r},set:function(e){if(r!==e){var n={device:t,property:"friendlyName",oldValue:r,newValue:e};r=e;try{t.evtMgr.fireEvent(s.PROPERTY_CHANGED,n)}catch(e){i.warn("Event handler exception",e)}}}},launchState:{enumerable:!0,get:function(){return o},set:function(e){o!==e&&(o=e,o===c.launchStates.NOT_LAUNCHED&&t.session&&t.session.end(!1,!0),t.evtMgr.fireEvent(s.LAUNCH_STATE_CHANGED,{device:t,launchState:o}))}},isRegistered:{enumerable:!1,writable:!0,value:!(!e||!e.headers||"1"!==(e.headers[d.headers.registered]||e.headers[d.headers.registered.toLowerCase()]))},isMsl:{enumerable:!1,writable:!0,value:!(!e||!e.headers||"1"!==(e.headers[d.headers.msl]||e.headers[d.headers.msl.toLowerCase()]))}}),this};v.prototype=Object.create(l.prototype),v.prototype.onDiscoveryStateUpdated=function(e){switch(e){case c.discoveryStates.UNAVAILABLE:case c.discoveryStates.ERROR:this.launchState=c.launchStates.NOT_LAUNCHED;break;case c.discoveryStates.PENDING:this.launchState=c.launchStates.PENDING}},v.prototype.getPersistentData=function(){var e=l.prototype.getPersistentData.call(this);return o.merge(e,{friendlyName:this.friendlyName})},v.prototype.CONNECT_INTENTS=c.connectIntents,v.prototype.connectToApp=function(e,n){var t=this,o=t.id,s=t.session,a=u.newEvent(u.EVENTS.CONNECT,t.id),d=c.connectIntents;if(e!==d.JOIN&&e!==d.LAUNCH&&e!==d.LAUNCH_AND_CONTROL)return r.reject(new f(f.ERRORS.INVALID_ARG,"Invalid connect intent specified"));if(n=n||s.device.discoveryComponent.config.defaultLaunchArgs,i.info("Attempting to connect to target "+o+" with intent "+e+" and payload "+n),!t.isAvailable)return r.reject(new f(f.ERRORS.CONNECT_FAILED,"Cannot connect to a device that isn't available"));var l=r.defer();return s.connectToTarget(e,n,a).timeout(12e4,"Timed out waiting for the target connection to complete").then(function(){i.info("Connection successfully established to "+o),l.resolve()},function(e){e&&-1===p.indexOf(e.code)&&(i.error("Failed to connect to "+o,e),s.end(!1)),t.launchState===c.launchStates.PENDING&&(t.launchState=c.launchStates.NOT_LAUNCHED),l.reject(e||new f(f.ERRORS.CONNECT_FAILED,e&&e.message))}).finally(function(){a.complete()}),l.promise},v.prototype.cancelPendingConnections=function(){this.session&&this.session.cancelPendingConnections()},v.prototype.disconnectFromApp=function(e){var n,t=this,r=t.session;return r&&(r.cancelPendingConnections(),r.disconnectDeferred&&(n=r.disconnectDeferred.promise)),n=n||l.prototype.disconnectFromApp.call(t),e&&"function"==typeof t.stopApp&&(n=n.then(t.stopApp.bind(t)).timeout(2e3,"Timed out trying to stop the target application")),n};var g=function(e){e.failed("Failed ack")},E=function(e,n){return e.ack(),n.toString()};v.prototype.play=function(e,n,t){var r=this,i=u.registerUserIntent("PLAY",r),s={catalogId:e,trackId:n,esn:a.current.mdxUuid},c=o.merge(s,t||{});return r.sendAppMessage("PLAYER_PLAY",c).then(E.bind(r,i),g.bind(r,i))},v.prototype.pause=function(e,n){var t=this,r=u.registerUserIntent("PAUSE",t,e),i=o.merge({xid:e},n||{});return t.sendAppMessage("PLAYER_PAUSE",i).then(E.bind(t,r),g.bind(t,r))},v.prototype.resume=function(e,n){var t=this,r=u.registerUserIntent("RESUME",t,e),i=o.merge({xid:e},n||{});return t.sendAppMessage("PLAYER_RESUME",i).then(E.bind(t,r),g.bind(t,r))},v.prototype.stop=function(e,n){var t=this,r=u.registerUserIntent("STOP",t,e),i=o.merge({xid:e},n||{});return t.sendAppMessage("PLAYER_STOP",i).then(E.bind(t,r),g.bind(t,r))},v.prototype.skip=function(e,n,t){var r=this,i=u.registerUserIntent("SKIP",r,e),s=o.merge({xid:e,seconds:n},t||{});return r.sendAppMessage("PLAYER_SKIP",s).then(E.bind(r,i),g.bind(r,i))},v.prototype.setTime=function(e,n,t){var r=this,i=u.registerUserIntent("SET_TIME",r,e),s=o.merge({xid:e,time:n},t||{});return r.sendAppMessage("PLAYER_SET_CURRENT_TIME",s).then(E.bind(r,i),g.bind(r,i))},v.prototype.autoAdvance=function(e,n,t){var r=this,i=u.registerUserIntent("AUTO_ADVANCE",r,e),s=o.merge({xid:e,autoAdvanceMaxIncrement:n},t||{});return r.sendAppMessage("PLAYER_SET_AUTO_ADVANCE",s).then(E.bind(r,i),g.bind(r,i))},v.prototype.setVolume=function(e,n,t){var r=this,i=u.registerUserIntent("SET_VOLUME",r,e),s=o.merge({xid:e,volume:n},t||{});return r.sendAppMessage("PLAYER_SET_VOLUME",s).then(E.bind(r,i),g.bind(r,i))},v.prototype.getPlayerState=function(e){return this.sendAppMessage("PLAYER_GET_CURRENT_STATE",e||{})},v.prototype.getCapabilities=function(e){return this.sendAppMessage("PLAYER_GET_CAPABILITIES",e||{})},v.prototype.getAudioSubtitles=function(e,n){var t=o.merge({xid:e},n||{});return this.sendAppMessage("GET_AUDIO_SUBTITLES",t)},v.prototype.setAudioSubtitles=function(e,n,t){var r=this,i="SET_AUDIO_SUBTITLES",s=u.registerUserIntent(i,r,t&&t.xid),c=o.merge({audio_track_id:e,timed_text_track_id:n},t||{});return r.sendAppMessage(i,c).then(E.bind(r,s),g.bind(r,s))},v.prototype.dismissPostPlay=function(e,n){var t=this,r=u.registerUserIntent("DISMISS_POSTPLAY",t,e),i=o.merge({xid:e},n||{});return t.sendAppMessage("POSTPLAY_STOP",i).then(E.bind(t,r),g.bind(t,r))},v.prototype.trackRestart=function(e){var n=r.defer();return this.targetRestartDeferred=n,n.promise.timeout(e,"Timed out waiting for a target to successfully restart")},v.prototype.suspendDiscovery=function(e){this.isAvailable&&(this.discoveryState=e?c.discoveryStates.PENDING:c.discoveryStates.UNAVAILABLE)},n.exports=v},{"../../builds/ld.js":1,"../configuration.js":7,"../discovery/discoveryUtils.js":31,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./deviceEvents.js":8,"./mdxDevice.js":15,q:5}],19:[function(e,n,t){var r=e("q"),o=e("../enums.js"),i=e("./deviceUtils.js"),s=e("../configuration.js"),c=e("../httpFactory.js"),a=/<state>(.*)<\/state>/,u=/<port>(.*)<\/port>/,d=/<capabilities>(.*)<\/capabilities>/,l=/<options.*allowStop="(.*)".*\/>/,f=/<service.*dialVer="(.*?)".*>/,p=function(e){var n=e||null;return Object.defineProperties(this,{isAvailable:{enumerable:!0,writable:!0,value:!1},location:{enumerable:!0,writable:!0,value:null},usn:{enumerable:!0,get:function(){return n},set:function(e){n!==e&&(n=e,s.current.storage.storeDeviceMap(s.current.dscMgr.devices))}},serviceType:{enumerable:!0,writable:!0,value:null}}),this},v=function(e,n){p.call(this,e,n);var t;return Object.defineProperties(this,{dialAppUrl:{enumerable:!0,get:function(){return t},set:function(e){e&&(e.lastIndexOf("/Netflix")!==e.length-("Netflix".length+1)&&("/"!==e[e.length-1]&&(e+="/"),e+="Netflix"),t=e)}},state:{enumerable:!0,writable:!0,value:""},port:{enumerable:!0,writable:!0,value:""},caps:{enumerable:!0,writable:!0,value:[]},allowStop:{enumerable:!0,writable:!0,value:!1},dialVer:{enumerable:!0,writable:!0,value:""}}),n&&(this.dialAppUrl=n),this};v.prototype=Object.create(p.prototype),v.prototype.updateDialInfo=function(){var e=r.defer(),n=this;return n.dialAppUrl?(c.createHttpClient(s.current.platform).get(n.dialAppUrl).done(function(t){var r,o,i,s,c;t&&(r=a.exec(t),o=u.exec(t),i=d.exec(t),s=l.exec(t),c=f.exec(t),r&&(n.state=r[1]),o&&(n.port=o[1]),i&&(n.caps=i[1]?i[1].split(/\s/g):[]),s&&(n.allowStop="true"===(s[1]+"").toLowerCase()),c&&(n.dialVer=c[1])),n.isAvailable=!0,e.resolve(n)},e.reject),e.promise.timeout(3e3)):r.reject()};var g=function(e,n){return p.call(this,e),Object.defineProperties(this,{registrationMode:{enumerable:!0,writable:!0,value:n||o.registrationModes.DISABLED},capabilities:{enumerable:!0,writable:!0,value:[]},ipAddressAndPort:{enumerable:!0,get:function(){return i.ipAddressAndPortFromLocation(this.location)}}}),this};g.prototype=Object.create(p.prototype),n.exports={DialInfo:v,MdxInfo:g}},{"../configuration.js":7,"../enums.js":33,"../httpFactory.js":35,"./deviceUtils.js":9,q:5}],20:[function(e,n,t){var r=e("q"),o=e("../logging/logger.js"),i=e("../configuration.js"),s=e("../../builds/ld.js"),c=e("../mdxError.js"),a=e("./discoveryComponent.js"),u=e("../devices/mdxController.js"),d=e("../devices/deviceUtils.js"),l=e("../session/mdxControllerSession.js"),f=e("../versionInfo.js"),p=e("./discoveryEvents.js"),v=e("../enums.js"),g=e("../session/validation.js"),E=e("../session/msgBusFactory.js"),h=function(e){o.error("MDXLIB encountered an error: ",e)},m={mdxMessageBus:null,sessions:{},pendingConnections:{}},y=function(e,n){var t=m.sessions,r=t[e.session.senderId];if(!r)return void o.error("DialDiscoveryComponentNrdp.processRefoundController session does not exist");n!==r.senderId&&(t[n]=r,delete t[r.senderId],r.senderId=n),e.lastSeen=(new Date).valueOf(),this.evtMgr.fireEvent(p.DEVICE_REFOUND,{device:e})},R=function(e){if(!e.body)return void o.trace("onMdxLibIncomingMessage empty event body, dropping msg...");var n=g.parseAndValidateMsg(e.body);if(null===n)return void o.error("onMdxLibIncomingMessage.parseAndValidateMsg null message");var t,r=n.fromuuid,c=this,a=n.controlleruuid||r,h=s.find(i.current.dscMgr.devices,function(e){return e instanceof u&&e.mdxUuid===a}),R=n.fromurl||n.controllerurl,S=new f(n.version),I=n.opts||{};h?(R&&(h.mdxInfo={location:R,isAvailable:!0,ipAddressAndPort:d.ipAddressAndPortFromLocation(R)}),y.call(c,h,a,new Date),o.trace("onMdxLibIncomingMessage.controller",h),h.session?(o.trace("onMdxLibIncomingMessage.controller  session found",a),h.session.processMdxMessage(e,new Date)):E.createMsgBus(h).fail(function(e){o.error("onMdxLibIncomingMessage. msgBus creation failed:",e)}).then(function(n){h.session=new l(S,a,n,I),m.sessions[a]=h.session,h.session.processMdxMessage(e,new Date)})):(t={id:a,mdxUuid:a,wasLaunchingController:!1,controllerType:v.controllerTypes.MDX,location:R},o.trace("DialDiscoveryComponentNrdp.retrieveDeviceMapData"),i.current.storage.retrieveDeviceMapData().fail(function(e){o.error("onMdxLibIncomingMessage. retrieveDeviceMapData failed:",e)}).success(function(n){var r=u.prototype.persistentType,i=s.find(n,function(e){return e.type===r&&e.mdxUuid===a});i&&(o.trace("DialDiscoveryComponentNrdp. found persisted device for:",a),t=s.merge(i,t)),o.trace("DialDiscoveryComponentNrdp.retrieveDeviceMapData - new controller"),h=new u(t,c),E.createMsgBus(h).fail(function(e){o.error("onMdxLibIncomingMessage. MsgBus creation failed:",e)}).then(function(n){o.trace("DialDiscoveryComponentNrdp.retrieveDeviceMapData - new controller session"),h.session=new l(S,a,n,I),m.sessions[a]=h.session,h.session.processMdxMessage(e,new Date),c.evtMgr.fireEvent.call(c,p.DEVICE_FOUND,{device:h})})}))},S=[{name:"error",handler:h},{name:"incomingmessage",handler:R}],I=function(){var e=r.defer(),n=this,t=n.config,s=nrdp.device.ESN,a=nrdp.mdx.localIPAddress,u=t&&t.mdxPort;i.current.localMdxPort=u,o.trace("initializeMdxLib componentConfig:",n.config);var d=function n(t){nrdp.mdx.removeEventListener("statechanged",n),t.state===nrdp.mdx.NOT_INITIALIZED?(o.error("MDXLIB initialization failed unexpectedly",t),e.reject(new c(c.ERRORS.START_ERROR,"MDXLIB_NOT_READY"))):e.resolve()};nrdp.mdx.addEventListener("statechanged",d);var l=function(t){o.trace("handleInitResult: ",t),t.errorcode&&0!==t.errorcode&&(400!==t.errorcode||n.networkId?(o.error("MDXLIB Initialization failure",t),e.reject(t)):(o.warn("MDXLIB returned MdxError_NoConnection but we don't have one so initialization is complete"),e.resolve()))},f=function(){var e,n=[],t=i.current.responseHeaders;o.trace("applyDeviceReplyHeaders headers=",t);for(e in t)t.hasOwnProperty(e)&&n.push(e+": "+t[e]);nrdp.mdx.SetDeviceReplyHeaders&&nrdp.mdx.SetDeviceReplyHeaders(n)};return o.trace("Initializing MDXLIB host: "+a+", port: "+u+", serviceType: undefined, esn: "+s+", asyncHttpRequests: true, isWebsocketServer: false"),nrdp.mdx.MdxInit(a,void 0,"urn:mdx-netflix-com:service:target:3",s,!0,!1,l),e.promise.timeout(3e3).finally(function(){var e=!1,n=function(){o.trace("mdx : RevealTargetPresence callback"),e||(e=!0,o.trace("mdx : RevealTargetPresence cb applying"),f())};nrdp.mdx.removeEventListener("statechanged",d),o.trace("mdx : RevealTargetPresence "),nrdp.mdx.RevealTargetPresence(n),setTimeout(n,350)})},A=function(){var e=r.defer(),n=function n(t){nrdp.mdx.removeEventListener("statechanged",n),e.resolve()};return nrdp.mdx.addEventListener("statechanged",n),nrdp.mdx.MdxDeinit(),e.promise},T=function(e){if(!e)return this;a.call(this,e,"MDX-NRDP","mdx");var n=this;return this.targetInstanceType=u,this.start=function(){return s.forEach(S,function(e){var t=e.handler.bind(n);e.boundhandler=t,nrdp.mdx.addEventListener(e.name,e.boundhandler)}),I.call(n).then(function(){n.isStarted=!0})},this.stop=function(){return s.forEach(S,function(e){nrdp.mdx.removeEventListener(e.name,e.boundhandler),e.boundhandler=void 0}),m.mdxMessageBus=null,A.call(this).then(function(){n.isStarted=!1})},this};T.prototype=Object.create(a.prototype),n.exports=T},{"../../builds/ld.js":1,"../configuration.js":7,"../devices/deviceUtils.js":9,"../devices/mdxController.js":14,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../session/mdxControllerSession.js":57,"../session/msgBusFactory.js":60,"../session/validation.js":66,"../versionInfo.js":74,"./discoveryComponent.js":27,"./discoveryEvents.js":29,q:5}],21:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("../configuration.js"),c=e("./discoveryEvents.js"),a=e("../profiling/mdxProfiler.js"),u=e("./discoveryUtils.js"),d=e("../enums.js"),l=e("./discoveryComponent.js"),f=e("../devices/mdxCastTargetChrome.js"),p=e("../mdxError.js"),v=function(e){this.evtMgr.fireEvent(c.MDX_DEVICES_AVAILABLE,{available:e===chrome.cast.ReceiverAvailability.AVAILABLE})},g={mdxUuid:u.nonEmptyString,friendlyName:u.nonEmptyString,ipAddress:u.nonEmptyString},E=function(e,n){var t=this,r=e.receiver,i=r.label?r.label.substr(5):"",l={mdxUuid:i,friendlyName:r.friendlyName,ipAddress:r.ipAddress||"0.0.0.0"};if(u.isValidDeviceInfo(l,g)){var p=s.current.dscMgr.getDeviceByMdxUuid(i);if(p)return p.discoveryState=d.discoveryStates.AVAILABLE,p.launchState=d.launchStates.LAUNCHED,p.session.castSession=e,t.evtMgr.fireEvent(c.DEVICE_REFOUND,{device:p,deviceInfo:l}),void(n&&n.resolve(p));s.current.storage.retrieveDeviceMapData().success(function(r){var i=f.prototype.persistentType;o.find(r,function(e){return e.type===i&&e.mdxUuid===l.mdxUuid&&(l.id=e.id,!0)}),p=new f(l,t,e),a.addDevice(p.id,{name:p.id}),a.newMarker(a.EVENTS.DEVICE_FOUND,p.id),t.evtMgr.fireEvent(c.DEVICE_FOUND,{device:p}),n&&n.resolve(p)})}},h=function(e){E.call(this,e)},m=function(e,n){try{"cast"===n?this.evtMgr.fireEvent(c.START_CONNECTING,{}):"stop"===n&&this.evtMgr.fireEvent(c.START_DISCONNECTING,{})}catch(e){i.warn("castReceiverConnectionListener exception",e)}},y=function(e){var n=this;return l.call(n,e,"CAST-CHROME","cast"),n.targetInstanceType=f,n.start=function(){if(!chrome||!chrome.cast||!chrome.cast.isAvailable)return r.reject(new p(p.ERRORS.START_ERROR,"CAST SDK is not available"));var e=n.config.appId;i.info.always("Initializing Cast SDK - Version: "+chrome.cast.VERSION.join(".")+" - AppId: "+e);var t=r.defer(),o=s.current;chrome.cast.timeout.requestSession=o.castSessionRequestTimeout;var c=new chrome.cast.SessionRequest(e),a=new chrome.cast.ApiConfig(c,h.bind(this),v.bind(this),o.castAutoJoinPolicy||chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,o.castDefaultActionPolicy||chrome.cast.DefaultActionPolicy.CREATE_SESSION);return chrome.cast.initialize(a,function(){n.isStarted=!0,chrome.cast.addReceiverActionListener(m.bind(n)),t.resolve()},function(e){i.error("CAST SDK initialization failure!",e),t.reject(new p(p.ERRORS.START_ERROR,"CAST SDK Initialization failed. Code: "+e&&e.code+" - Description: "+e&&e.description))}),t.promise},n.stop=function(){return r.reject(new p(p.ERRORS.PLATFORM_SUPPORT_ERROR))},n.requestMdxDevice=function(){var e=r.defer(),t=function(n){try{var t=n&&n.friendlyName||"";e.notify({friendlyName:t})}catch(e){}};return chrome.cast.addReceiverActionListener(t),chrome.cast.requestSession(function(r){chrome.cast.removeReceiverActionListener(t),E.call(n,r,e)},function(n){var t;switch(n.code){case chrome.cast.ErrorCode.CANCEL:t=new p(p.ERRORS.CANCELLED);break;default:var r="CAST SDK session request failed. Code: "+n&&n.code+" - Description: "+n&&n.description;i.error(r),t=new p(p.ERRORS.CONNECT_FAILED,r)}e.reject(t)}),e.promise},this};y.prototype=Object.create(l.prototype),n.exports=y},{"../../builds/ld.js":1,"../configuration.js":7,"../devices/mdxCastTargetChrome.js":12,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./discoveryComponent.js":27,"./discoveryEvents.js":29,"./discoveryUtils.js":31,q:5}],22:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("../profiling/mdxProfiler.js"),c=e("./discoveryUtils.js"),a=e("./discoveryEvents.js"),u=e("../configuration.js"),d=e("./discoveryComponent.js"),l=e("../devices//mdxCastTargetV2.js"),f=e("../mdxError.js"),p=null,v=null,g={mdxUuid:c.nonEmptyString,friendlyName:c.nonEmptyString,ipAddress:c.nonEmptyString,isGuestMode:function(e){return"boolean"==typeof e}},E=function(e){if(e.isOnLocalNetwork||u.current.castGuestModeEnabled){var n=this,t=e.deviceID,r={mdxUuid:t,friendlyName:e.friendlyName,ipAddress:e.ipAddress,isGuestMode:!e.isOnLocalNetwork};if(c.isValidDeviceInfo(r,g)){var i=u.current.dscMgr.getDeviceByMdxUuid(t);if(i)return i.castDevice=e,void n.evtMgr.fireEvent(a.DEVICE_REFOUND,{device:i,deviceInfo:r});u.current.storage.retrieveDeviceMapData().success(function(t){var c=l.prototype.persistentType;o.find(t,function(e){return e.type===c&&e.mdxUuid===r.mdxUuid&&(r.id=e.id,!0)}),i=new l(r,n,e,function(){s.addDevice(i.id,{name:i.id}),s.newMarker(s.EVENTS.DEVICE_FOUND,i.id),n.evtMgr.fireEvent(a.DEVICE_FOUND,{device:i})})})}}},h=function(e){var n=u.current.dscMgr.getDeviceByMdxUuid(e.deviceID);n&&(n.castDevice=e,this.evtMgr.fireEvent(a.DEVICE_GONE,{device:n}))},m=function(e){var n=this,t=e.deviceID,r={mdxUuid:t,friendlyName:e.friendlyName,ipAddress:e.ipAddress,isGuestMode:!e.isOnLocalNetwork};if(c.isValidDeviceInfo(r,g)){var o=u.current.dscMgr.getDeviceByMdxUuid(t);o&&n.evtMgr.fireEvent(a.DEVICE_REFOUND,{device:o,deviceInfo:r})}},y=[{name:"enterBackground",handler:function(){this.suspendDiscovery()}},{name:"enterForeground",handler:function(){this.resumeDiscovery()}}],R=function(){var e=r.defer(),n=this,t=n.config.appId;i.info.always("Initializing Cast SDK - Version: "+NFGCKFrameworkVersion+" - AppId: "+t);var s=c.processIflist(nrdp.device.iflist);n.networkId=c.networkIdFromInterface(s),o.forEach(y,function(e){e.handler=e.handler.bind(n),nrdp.device.addEventListener(e.name,e.handler)});var a=NFGCKFilterCriteria.criteriaForAvailableApplicationWithID(t),u=NFGCKDeviceScanner.jsInitWithFilterCriteria;return"function"!=typeof u&&(u=NFGCKDeviceScanner.initWithFilterCriteria),u(a,function(t){if(!t)return void e.reject(new f(f.ERRORS.START_ERROR,"No cast scanner instance"));p=t;var r=NFGCKDeviceScannerListener.jsInit;"function"!=typeof r&&(r=NFGCKDeviceScannerListener.init),v=r(),v.didComeOnline=E.bind(n),v.didGoOffline=h.bind(n),v.didChange=m.bind(n),p.addListener(v),p.startScan(),e.resolve()}),e.promise},S=function(){return i.info.always("Uninitializing Cast SDK"),o.forEach(y,function(e){nrdp.device.removeEventListener(e.name,e.handler)}),p.stopScan(),p.removeListener(v),delete v.didComeOnline,delete v.didGoOffline,delete v.didChange,v=null,p=null,r.resolve()},I=function(e){d.call(this,e,"CAST-IOS","cast");var n=this;return Object.defineProperties(this,{targetInstanceType:{enumerable:!1,writable:!1,value:l}}),this.start=function(e,t){var o=r.defer(),i=t.newSubEvent(s.EVENTS.START_CAST_DISC);return R.call(n).done(function(){n.isStarted=!0,i.complete(),o.resolve()},function(e){o.reject(e)}),o.promise},this.stop=function(e){var t=r.defer(),o=e.newSubEvent(s.EVENTS.STOP_CAST_DISC);return S.call(n).done(function(){n.isStarted=!1,o.complete(),t.resolve()},function(e){t.reject(e)}),t.promise},this};I.prototype=Object.create(d.prototype),I.prototype.suspendDiscovery=function(){d.prototype.suspendDiscovery.call(this,!0)},I.prototype.resumeDiscovery=function(){d.prototype.resumeDiscovery.call(this)},n.exports=I},{"../../builds/ld.js":1,"../configuration.js":7,"../devices//mdxCastTargetV2.js":13,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./discoveryComponent.js":27,"./discoveryEvents.js":29,"./discoveryUtils.js":31,q:5}],23:[function(e,n,t){var r,o,i,s=e("q"),c=e("../../builds/ld.js"),a=e("../logging/logger.js"),u=e("../profiling/mdxProfiler.js"),d=e("../enums.js"),l=e("./discoveryEvents.js"),f=e("../configuration.js"),p=e("./discoveryComponent.js"),v=e("../session/castControllerSession.js"),g=e("../devices/mdxCastController.js"),E=e("../versionInfo.js"),h=e("../eventManager.js"),m={mediaManager:null,mdxMessageBus:null,mediaMessageBus:null,sessions:{},pendingConnections:{}},y=function(e,n,t){var r=m.sessions,o=r[e.session.senderId];n!==o.senderId&&(r[n]=o,delete r[o.senderId],o.senderId=n),e.lastSeen=(new Date).valueOf(),this.evtMgr.fireEvent(l.DEVICE_REFOUND,{device:e}),u.newMarker(u.EVENTS.DEVICE_REFOUND,e.id,t)},R=function(e,n,t,i){var s=this,a=n.controlleruuid,p=c.find(f.current.dscMgr.devices,function(e){return e instanceof g&&e.mdxUuid===a}),h=new E(n.controllerMdxVersion);f.current.mdxUuid=n.uuid;var R=n.opts||{};if(p)y.call(s,p,e,t),p.session.processMdxMessage(n,new Date),u.newEvent(u.EVENTS.CAST_HANDSHAKE,p.id,i,new Date);else{var S={mdxUuid:a,wasLaunchingController:e===o,controllerType:d.controllerTypes.MDX},I=new v(h,e,m.mdxMessageBus,R);m.sessions[e]=I,f.current.storage.retrieveDeviceMapData().success(function(e){var o=g.prototype.persistentType,i=c.find(e,function(e){return e.type===o&&e.mdxUuid===a});if(i&&(S=c.merge(i,S)),p=new g(S,s,I),I.sendHandshakeResponse.call(I),r){var d=r,v=n.payload||s.config.defaultLaunchArgs;s.isStarted=!0,d.profilerEvent.complete(),f.current.scheduler.cancelDelay(d.defaultLaunchArgsTimeout),d.resolve(v)}s.evtMgr.fireEvent.call(s,l.DEVICE_FOUND,{device:p});var E=u.EVENTS.DEVICE_FOUND;u.addDevice(p.id,{name:p.id}),u.newMarker(E,p.id,t)})}},S=function(e){a.warn("New sender connected but did not receive the cast handshake, so requesting it");try{m.mdxMessageBus.send(e,{type:"castHandShakeRequest"})}catch(e){a.error("Unexpected failure to send cast handshake request to the controller",e)}},I=function(e){var n=new Date,t=e.senderId,r=t.substr(t.indexOf(":")+1);if(r){var o=c.find(f.current.dscMgr.devices,function(e){return e instanceof g&&e.session.senderGuid===r});if(o)return void y.call(this,o,t,n)}var i={delayId:f.current.scheduler.delay(S.bind(this,t),2e3),foundTime:n};m.pendingConnections[e.senderId]=i},A=function(e){var n=c.find(f.current.dscMgr.devices,function(n){return n instanceof g&&n.session.senderId===e.senderId});if(n){var t=c.isString(e.reason)&&"requested_by_sender"===e.reason.toLowerCase()||!1;n.wasExplicitLastDisconnect=t,u.newMarker(u.EVENTS.DEVICE_GONE,n.id),this.evtMgr.fireEvent(l.DEVICE_GONE,{device:n})}},T=function(e){var n=new Date,t=e.senderId,r=m.sessions[t],o=m.pendingConnections[t];if(r)r.processMdxMessage(e.data,n);else if(o){f.current.scheduler.cancelDelay(o.delayId);var i=e.data;if("castHandShake"!==i.type)return void a.error("Initial message for pending connection was not a handshake",e);R.call(this,t,i,o.foundTime,n),delete m.pendingConnections[t]}else a.warn("Received an unexpected message on the cast message bus",e)},N=function(e){var n=e,t=new h,r={READY:"ready",SENDER_CONNECTED:"senderConnected",SENDER_DISCONNECTED:"senderDisconnected",SHUTDOWN:"shutdown",STANDBY_CHANGED:"standbyChanged",VISIBILITY_CHANGED:"visibilityChanged"};Object.defineProperties(this,{systemVolume:{enumerable:!1,writable:!0,value:{level:1,muted:!1}}});var o=function(e,n){try{t.fireEvent(e,n)}catch(e){a.error("Exception when handling CAST receiver event",e,e.stack)}};return n.onReady=o.bind(null,r.READY),n.onSenderConnected=o.bind(null,r.SENDER_CONNECTED),n.onSenderDisconnected=o.bind(null,r.SENDER_DISCONNECTED),n.onShutdown=o.bind(null,r.SHUTDOWN),n.onStandbyChanged=o.bind(null,r.STANDBY_CHANGED),n.onVisibilityChanged=o.bind(null,r.VISIBILITY_CHANGED),this.EVENTS=r,this.addEventListener=t.addEventListener,this.removeEventListener=t.removeEventListener,this.dispose=function(){n.onReady=null,n.onSenderConnected=null,n.onSenderDisconnected=null,n.onShutdown=null,n.onStandbyChanged=null,n.onVisibilityChanged=null,n=null},this},O=function(e){p.call(this,e,"CAST-TARGET","cast");var n=this;return this.targetInstanceType=g,this.start=function(e,t){var c=t.newSubEvent(u.EVENTS.START_CAST_DISC);r=s.defer(),r.profilerEvent=c;var d=cast.receiver.CastReceiverManager.getInstance(),l=new N(d),p=l.EVENTS;l.addEventListener(p.SENDER_CONNECTED,I.bind(n)),l.addEventListener(p.SENDER_DISCONNECTED,A.bind(n)),f.current.castReceiver=l;var v=d.getCastMessageBus(n.config.mdxNamespace,cast.receiver.CastMessageBus.MessageType.JSON);v.onMessage=T.bind(n),m.mdxMessageBus=v;var g=d.getCastMessageBus(cast.receiver.media.MEDIA_NAMESPACE,cast.receiver.CastMessageBus.MessageType.JSON);m.mediaMessageBus=g;var E=function e(n){a.trace("Cast Receiver Manager: onReady",n),l.removeEventListener(l.EVENTS.READY,e),o=n.data.launchingSenderId,i=n.data.sessionId};l.addEventListener(l.EVENTS.READY,E);var h;return r.defaultLaunchArgsTimeout=f.current.scheduler.delay(function(){n.isStarted=!0,r.resolve(n.config.defaultLaunchArgs)},2e3),d.start(h),r.promise},this.stop=function(e){var t=e.newSubEvent(u.EVENTS.STOP_CAST_DISC);return f.current.castReceiver.dispose(),f.current.castReceiver=null,m.mdxMessageBus.onMessage=null,m.mdxMessageBus=null,m.mediaMessageBus=null,m.mediaManager=null,n.isStarted=!1,t.complete(),s.resolve()},this};O.prototype=Object.create(p.prototype),O.prototype.dispose=function(){return this.disposeInternal(),p.prototype.dispose.call(this)},n.exports=O},{"../../builds/ld.js":1,"../configuration.js":7,"../devices/mdxCastController.js":10,"../enums.js":33,"../eventManager.js":34,"../logging/logger.js":38,"../profiling/mdxProfiler.js":45,"../session/castControllerSession.js":51,"../versionInfo.js":74,"./discoveryComponent.js":27,"./discoveryEvents.js":29,q:5}],24:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("../profiling/mdxProfiler.js"),c=e("../enums.js"),a=e("../configuration.js"),u=e("./discoveryEvents.js"),d=e("./discoveryUtils.js"),l=e("../devices/serviceInfo.js"),f=e("./discoveryComponent.js"),p=e("../devices/mdxDialTarget.js"),v={MDX:{interval:15e3},DIAL:{interval:15e3}},g={MDX:{interval:2e3,autoAdjust:{config:v,count:Math.ceil(2.5)}},DIAL:{interval:2e3,autoAdjust:{config:v,count:Math.ceil(2.5)}}},E={MDX:{interval:2e3,autoAdjust:{config:v,count:Math.ceil(60)}},DIAL:{interval:15e3}},h={serviceType:function(e){return e&&o.isString(e.urn)&&e.urn.length&&o.isString(e.service)&&e.service.length&&e.version>=0},usn:d.nonEmptyString,location:d.nonEmptyString,friendlyName:d.nonEmptyString,headers:function(e){return o.isPlainObject(e)}},m={},y={},R=function(){o.forEach(y,function(e){a.current.scheduler.cancelRepeat(e)})},S=[],I=function(e,n){var t=this;if(!t.isStarted)return void R();if(n.autoAdjust&&--n.autoAdjust.count<=0){var r=n.autoAdjust.config[e];return void A.call(t,e,r)}var o=c.serviceTypes[e];void 0!==t.config.searchVersions[e]&&(o=o+":"+t.config.searchVersions[e]);if(S.length>=10)return void i.error("The SSDP search queue is backed up! Dropping search request",o);S.push(o),1===S.length&&function e(){if(S.length){var n=S[0];n&&t.performSearch(n).timeout(t.config.mx*t.config.searchCount*1e3+500).finally(function(){S.shift(),e()})}}()},A=function(e,n){var t=y[e];t&&a.current.scheduler.cancelRepeat(t);var r=o.clone(n,!0);y[e]=a.current.scheduler.repeat(I.bind(this),r.interval,!0,e,r)},T=function(e,n){if(!n||!e)return this;f.call(this,e,n,"dial");var t=this;return this.targetInstanceType=p,this.start=function(e,n){var o=n.newSubEvent(s.EVENTS.START_DIAL_DISC),i=r.defer();return t.initSearchProvider.call(t,e).finally(function(){o.complete()}).done(function(){t.isStarted=!0,t.enableAggressiveSearch(),i.resolve()},i.reject),i.promise},this.stop=function(e){var n=e.newSubEvent(s.EVENTS.STOP_DIAL_DISC),o=r.defer();return t.isStarted=!1,t.uninitSearchProvider.call(t).finally(function(){R(),n.complete()
}).done(o.resolve,o.reject),o.promise},this};T.prototype=Object.create(f.prototype),T.prototype.processFoundDevice=function(e){if(d.isValidDeviceInfo(e,h)){var n=function(n){var t=e.serviceType.isDial?c.serviceTypes.DIAL:c.serviceTypes.MDX,r=e.manufacturer||"Netflix";i.info.always("New device found: "+n.friendlyName,n.mdxUuid,t,n.ipAddress,n.launchState,n.registrationMode,r,e.modelName)},t=this,s=o.find(a.current.dscMgr.availableDevices,function(n){return n instanceof p&&n.isDeviceMatch(e)});if(s)return(e.serviceType.isDial&&!s.dialInfo.isAvailable||e.serviceType.isMdx&&!s.mdxInfo.isAvailable)&&n(s),void s.updateDeviceInfo(e);var f=o.find(a.current.dscMgr.devices,function(n){return n instanceof p&&n.isDeviceMatch(e)});if(f)f.updateDeviceInfo(e),!e.serviceType.isDial||f.dialInfo.isAvailable?t.evtMgr.fireEvent(u.DEVICE_FOUND,{device:f}):f.dialInfo.updateDialInfo().success(function(){t.evtMgr.fireEvent(u.DEVICE_FOUND,{device:f})});else{var v,g;e.serviceType.isDial?(g=new l.DialInfo(e.usn,e.dialAppUrl),v=g.updateDialInfo().then(function(){e.dialInfo=g})):v=r.resolve(),v.done(function(){a.current.storage.retrieveDeviceMapData().success(function(r){var i=p.prototype.persistentType,s=o.find(r,function(n){return n.type===i&&(n.dialUsn===e.usn||n.mdxUsn===e.usn)});s&&(e=o.merge(s,e)),f=new p(e,t,void 0),t.evtMgr.fireEvent(u.DEVICE_FOUND,{device:f}),n(f)})},function(){})}}},T.prototype.checkIfDeviceTrackedAndProcessRefound=function(e){var n=o.find(a.current.dscMgr.availableDevices,function(n){return n instanceof p&&n.isDeviceMatch(e)});return!!n&&(m[n.id]&&(a.current.scheduler.cancelDelay(m[n.id]),delete m[n.id]),this.evtMgr.fireEvent(u.DEVICE_REFOUND,{device:n,serviceType:e.serviceType}),n.lastSeen=(new Date).valueOf(),!(e.serviceType.isDial&&!n.dialInfo.dialAppUrl)&&(n.updateDeviceInfo(e),!0))},T.prototype.processDeviceByeBye=function(e){var n=this.evtMgr,t=o.find(a.current.dscMgr.availableDevices,function(n){return n instanceof p&&n.isDeviceMatch(e)});t&&(t.launchState===c.launchStates.PENDING?m[t.id]=a.current.scheduler.delay(function(){n.fireEvent(u.DEVICE_GONE,{device:t,deviceInfo:e})},6e3):n.fireEvent(u.DEVICE_GONE,{device:t,deviceInfo:e}))},T.prototype.enablePostLaunchSearch=function(){var e=this;o.forEach(E,function(n,t){A.call(e,t,n)})},T.prototype.enableAggressiveSearch=function(){var e=this;o.forEach(g,function(n,t){A.call(e,t,n)})},T.prototype.refreshDevices=function(){this.enableAggressiveSearch()},T.prototype.suspendDiscovery=function(e){f.prototype.suspendDiscovery.call(this,e),R()},T.prototype.resumeDiscovery=function(){f.prototype.resumeDiscovery.call(this),this.enableAggressiveSearch()},n.exports=T},{"../../builds/ld.js":1,"../configuration.js":7,"../devices/mdxDialTarget.js":16,"../devices/serviceInfo.js":19,"../enums.js":33,"../logging/logger.js":38,"../profiling/mdxProfiler.js":45,"./discoveryComponent.js":27,"./discoveryEvents.js":29,"./discoveryUtils.js":31,q:5}],25:[function(e,n,t){var r=e("q"),o=e("nf-utf8"),i=e("nf-base64"),s=e("../../builds/ld.js"),c=e("../logging/logger.js"),a=e("./discoveryUtils.js"),u=e("../configuration.js"),d=e("./dialDiscoveryComponent.js"),l=e("./serviceTypeInfo.js"),f=e("../mdxError.js"),p=function(e){var n=e.desc,t=n?n.root:null;if(t){var r,o,i=e.USN,s=!1;try{var d=t.device;r=d.manufacturer._value,o=d.modelName._value,s=a.isDeviceBlacklisted(r,o)}catch(e){c.warn("Error attempting to process the device blacklisting",e.message,e.stack)}if(s)return void(u.current.dscMgr.blacklistedUsns[i]=!0);var f=t?t.device:null,p=f?f.friendlyName._value:null;if(p){var v={serviceType:new l(e.serviceType),usn:i,location:e.url,friendlyName:p,headers:e.responseHeaders,dialAppUrl:e.responseHeaders&&e.responseHeaders["Application-URL"],manufacturer:r,modelName:o};this.processFoundDevice(v)}}},v=function(e){var n=e.USN,t=u.current.dscMgr.blacklistedUsns;if(!n||!t[n]){var r=new l(e.serviceType),s=e.friendlyName||"";if(s)try{s=o.decode(i.decode(s))}catch(n){c.error("Exception while decoding friendly name",n,e.friendlyName),s=u.current.defaultFriendlyName}var a={serviceType:r,usn:n,location:e.location,friendlyName:s,headers:e.responseHeaders};if(!this.checkIfDeviceTrackedAndProcessRefound(a))switch(r.service){case"dial":nrdp.mdx.DialGetDeviceInfo(e.location,e.USN,r.toNonVersionedString(),5);break;case"target":this.processFoundDevice(a)}}},g=function(e){var n={serviceType:new l(e.serviceType),usn:e.USN};this.processDeviceByeBye(n)},E=function(e){c.error("MDXLIB encountered an error: ",e)},h=function(e){var n=this.config,t=r.defer();return nrdp.mdx.INITIALIZED!==nrdp.mdx.state?r.reject():(nrdp.mdx.SearchForMdxDevices(e,n.headerPatterns,n.mx,n.searchCount,t.resolve),t.promise)},m=function(e){var n=this;e.eventSource===nrdp.mdx.INFO_RESIGNED_ACTIVE?n.suspendDiscovery(!!n.networkId):n.processNetworkStatus({iflist:nrdp.device.iflist})},y=[{name:"error",handler:E},{name:"devicefound",handler:v},{name:"DialDeviceInfoResponse",handler:p},{name:"devicebyebye",handler:g},{name:"interfacechanged",handler:m}],R=function(){var e=r.defer(),n=this,t=n.config,o=nrdp.device.ESN,i=nrdp.mdx.localIPAddress,s=t&&t.mdxPort;u.current.localMdxPort=s;var a=function(n){n.state===nrdp.mdx.NOT_INITIALIZED?(c.error("MDXLIB initialization failed unexpectedly",n),e.reject(new f(f.ERRORS.START_ERROR,"MDXLIB_NOT_READY"))):e.resolve()};nrdp.mdx.addEventListener("statechanged",a);var d=function(t){t.errorcode&&0!==t.errorcode&&(400!==t.errorcode||n.networkId?(c.error("MDXLIB Initialization failure",t),e.reject(t)):(c.warn("MDXLIB returned MdxError_NoConnection but we don't have one so initialization is complete"),e.resolve()))};return nrdp.mdx.MdxInit(i,void 0,o,!0,!1,d),e.promise.timeout(3e3).finally(function(){nrdp.mdx.removeEventListener("statechanged",a)})},S=function(){var e=r.defer(),n=function n(t){nrdp.mdx.removeEventListener("statechanged",n),e.resolve()};return nrdp.mdx.addEventListener("statechanged",n),nrdp.mdx.MdxDeinit(),e.promise},I=function(e){var n=this;return d.call(n,e,"DIAL-NRDP"),n.config&&(n.config.headerPatterns=["X-"]),n.initSearchProvider=function(){var e=a.processIflist(nrdp.device.iflist);return n.networkId=a.networkIdFromInterface(e),s.forEach(y,function(e){var t=e.handler.bind(n);e.boundhandler=t,nrdp.mdx.addEventListener(e.name,t)}),R.call(n).then(function(){n.isStarted=!0})},n.uninitSearchProvider=function(){return s.forEach(y,function(e){nrdp.mdx.removeEventListener(e.name,e.boundhandler)}),S.call(n).then(function(){n.isStarted=!1})},n.performSearch=h,this};I.prototype=Object.create(d.prototype),n.exports=I},{"../../builds/ld.js":1,"../configuration.js":7,"../logging/logger.js":38,"../mdxError.js":44,"./dialDiscoveryComponent.js":24,"./discoveryUtils.js":31,"./serviceTypeInfo.js":32,"nf-base64":3,"nf-utf8":4,q:5}],26:[function(e,n,t){var r,o=e("q"),i=e("../../builds/ld.js"),s=e("../logging/logger.js"),c=e("./discoveryUtils.js"),a=e("nf-utf8"),u=e("nf-base64"),d=e("../configuration.js"),l=e("./dialDiscoveryComponent.js"),f=e("./serviceTypeInfo.js"),p=e("../mdxError.js"),v=function(e,n){try{var t=e.usn,r=!1,o=n.getElementsByTagName("root")[0],i=o.getElementsByTagName("device")[0];try{var a=i.getElementsByTagName("manufacturer")[0].textContent,u=i.getElementsByTagName("modelName")[0].textContent;r=c.isDeviceBlacklisted(a,u)}catch(e){s.warn("Error attempting to process the device blacklisting",e.message,e.stack)}if(r)return void(d.current.dscMgr.blacklistedUsns[t]=!0);var l=i.getElementsByTagName("friendlyName")[0].textContent;if(!l)return;e.friendlyName=l,this.processFoundDevice(e)}catch(e){}},g=function(e){var n=this,t=e.usn;t&&(t=t.split("::")[0]);var r=d.current.dscMgr.blacklistedUsns;if(!t||!r[t]){var o=new f(e.st),c=e.friendlyName||e["x-friendly-name"]||"";if(c)try{c=a.decode(u.decode(c))}catch(n){s.error("Exception while decoding friendly name",n,e.friendlyName),c=d.current.defaultFriendlyName}var l={serviceType:o,usn:t,location:e.location,friendlyName:c,headers:i.zipObject(i.map(e,function(e,n){return-1!==n.lastIndexOf("x-",0)?[n,e]:null}).filter(function(e){return null!==e}))};if(!this.checkIfDeviceTrackedAndProcessRefound(l))switch(o.service){case"dial":var p={url:l.location,type:"GET"};WinJS.xhr(p).done(function(e){v.call(n,l,e.responseXML)},function(e){});break;case"target":this.processFoundDevice(l)}}},E=function(e){var n=e.usn;n&&(n=n.split("::")[0]);var t={serviceType:new f(e.nt),usn:n};this.processDeviceByeBye(t)},h=function(e){var n=this.config;return r.searchForDevices(n.mx,n.searchCount,[e]),o.delay(n.mx*n.searchCount*1e3+500)},m=[{name:"devicefound",handler:g},{name:"devicelost",handler:E}],y=function(e){var n=this,t=o.defer(),s=e&&e.platformDiscoveryLib;return s?(r=i.isFunction(s)?new s:s,r.start(r.startAsController).done(function(){i.forEach(m,function(e){var t=e.handler.bind(n);e.boundhandler=t,r.addEventListener(e.name,t)}),t.resolve.apply(t,arguments)},t.reject),t.promise):o.reject(new p(p.ERRORS.START_ERROR,"MdxDiscovery.MdxSspDiscoveryManager does not exist"))},R=function(){var e=o.defer();return r.stop().done(function(){i.forEach(m,function(e){r.removeEventListener(e.name,e.boundhandler)}),e.resolve.apply(e,arguments)},e.reject),e.promise},S=function(e){return l.call(this,e,"DIAL-WINJS"),this.initSearchProvider=y,this.uninitSearchProvider=R,this.performSearch=h,this};S.prototype=Object.create(l.prototype),n.exports=S},{"../../builds/ld.js":1,"../configuration.js":7,"../logging/logger.js":38,"../mdxError.js":44,"./dialDiscoveryComponent.js":24,"./discoveryUtils.js":31,"./serviceTypeInfo.js":32,"nf-base64":3,"nf-utf8":4,q:5}],27:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("./discoveryConfig.js"),s=e("./discoveryEvents.js"),c=e("./discoveryUtils.js"),a=(e("../logging/logger.js"),e("../configuration.js")),u=e("../enums.js"),d=e("../eventManager.js"),l=function(e,n){var t=i.defaults[n];return o.merge(o.merge({},t[e.role]),t.both)},f=function(e,n,t){var r=this,o=n,i=l(e,t),c=!1,a=new d;return Object.defineProperties(this,{evtMgr:{enumerable:!0,get:function(){return a}},isStarted:{enumerable:!0,get:function(){return c},set:function(e){c!==e&&(c=e,a.fireEvent(s.STARTED_STATE_CHANGED,{component:r,isStarted:c}))}},name:{enumerable:!0,get:function(){return o}},config:{enumerable:!0,get:function(){return i}},isSuspended:{enumerable:!1,writable:!0,value:!1},networkId:{enumerable:!1,writable:!0,value:null}}),this.addEventListener=a.addEventListener,this.removeEventListener=a.removeEventListener,this};f.prototype.dispose=function(){return r.resolve()},f.prototype.suspendDiscovery=function(e){var n=this;n.isSuspended=!0,o.forEach(a.current.dscMgr.devices,function(t){t instanceof n.targetInstanceType&&(t.suspendDiscovery(e),t.cancelPendingConnections())})},f.prototype.resumeDiscovery=function(){var e=this;e.isSuspended=!1,e.networkId&&a.current.scheduler.delay(function(){o.forEach(a.current.dscMgr.devices,function(n){n instanceof e.targetInstanceType&&n.discoveryState===u.discoveryStates.PENDING&&n.refresh(n.session&&n.session.mdxSessionId)})},500)},f.prototype.processNetworkStatus=function(e){var n=this,t=c.processIflist(e.iflist),r=c.networkIdFromInterface(t);r&&n.networkId&&r!==n.networkId?(n.suspendDiscovery(!1),n.resumeDiscovery()):r?n.resumeDiscovery():n.suspendDiscovery(!1),n.networkId=r},f.EVENTS=s,n.exports=f},{"../../builds/ld.js":1,"../configuration.js":7,"../enums.js":33,"../eventManager.js":34,"../logging/logger.js":38,"./discoveryConfig.js":28,"./discoveryEvents.js":29,"./discoveryUtils.js":31,q:5}],28:[function(e,n,t){var r=e("../enums.js"),o={defaults:{dial:{controller:{searchVersions:{MDX:0,DIAL:1},mx:1,searchCount:1},target:{registrationMode:r.registrationModes.DISABLED,mdxServiceType:"mdx-netflix-com:service:target:2",dialAdditionalDataUrl:""},both:{mdxPort:9080,ssdpPort:1900,defaultLaunchArgs:"intent=sync"}},mdx:{controller:{searchVersions:{MDX:0,DIAL:1},mx:1,searchCount:1},target:{registrationMode:r.registrationModes.DARWIN_XPROFILE_V1,mdxServiceType:"mdx-netflix-com:service:target:2",dialAdditionalDataUrl:""},both:{mdxPort:9080,ssdpPort:1900,defaultLaunchArgs:"intent=sync"}},cast:{controller:{appId:"CA5E8412"},target:{},both:{mdxNamespace:"urn:x-cast:mdx-netflix-com:service:target:2",defaultLaunchArgs:"intent=sync"}}},config:{}};n.exports=o},{"../enums.js":33}],29:[function(e,n,t){n.exports=Object.freeze({STARTED_STATE_CHANGED:"startedStateChanged",DEVICE_FOUND:"deviceFound",DEVICE_REFOUND:"deviceRefound",DEVICE_GONE:"deviceGone",MDX_DEVICES_AVAILABLE:"mdxDevicesAvailable",START_CONNECTING:"startConnecting",START_DISCONNECTING:"startDisconnecting"})},{}],30:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("./discoveryEvents.js"),c=e("./discoveryConfig.js"),a=e("../configuration.js"),u=e("../enums.js"),d=e("../mdxError.js"),l=e("../eventManager.js"),f=e("./discoveryComponent.js"),p=e("./dialDiscoveryComponentNrdp.js"),v=e("./dialDiscoveryComponentWinJS.js"),g=e("./castDiscoveryComponentIOSv2.js"),E=e("./castTargetDiscoveryComponent.js"),h=e("./castDiscoveryComponentChrome.js"),m=e("./NrdpTargetDiscoveryComponent.js"),y={2:[m],3:[E],4:[h],5:[v],6:[p],8:[p,g]},R=function(e,n){var t=o.zipObject(o.map(this.discoveryComponents,function(n){return[n.name,n[e]]})),r={};r[e]=t,this.evtMgr.fireEvent(s[n],r)},S=function(e){R.call(this,"isStarted","STARTED_STATE_CHANGED")},I=function(e){var n=this,t=e.device;n.devices[t.id]=t,n.evtMgr.fireEvent(s.DEVICE_FOUND,{device:t}),a.current.storage.storeDeviceMap(a.current.dscMgr.devices)},A=function(e){this.evtMgr.fireEvent(e.type,e)},T={STARTED_STATE_CHANGED:S,DEVICE_FOUND:I,MDX_DEVICES_AVAILABLE:A,START_CONNECTING:A,START_DISCONNECTING:A},N=function(e){var n=this,t=[],s={},a={},p=new l;Object.defineProperties(this,{config:{enumerable:!0,get:function(){return c.config}},evtMgr:{enumerable:!0,get:function(){return p}},discoveryComponents:{enumerable:!0,get:function(){return t}},devices:{enumerable:!0,get:function(){return s}},availableDevices:{enumerable:!0,get:function(){return o.filter(s,function(e){return e.isAvailable})}},blacklistedUsns:{enumerable:!0,get:function(){return a}}}),this.start=function(e,n){var s=r.defer(),c=[];return o.forEach(t,function(t){i.info("Starting "+t.name+" discovery component"),c.push(t.start.call(t,e,n).then(function(e){return i.info.always("Discovery component "+t.name+" reported a successful start"),e},function(e){i.error.always("Discovery component "+t.name+" failed start",e)}))}),r.allSettled(c).done(function(e){var n=e&&1===e.length?e[0].value:e.map(function(e){return e.value});s.resolve(n)},s.reject),s.promise},this.stop=function(e){var s=[];return t&&t.length?(o.forEach(t,function(n){i.info("Stopping "+n.name+" discovery component"),s.push(n.stop.call(n,e).finally(n.dispose))}),s.push(n.clearDevices()),r.allSettled(s)):r.resolve()},this.clearDevices=function(){var e=[];return o.forEach(s,function(n){n.discoveryState=u.discoveryStates.UNAVAILABLE,e.push(n.dispose())}),s={},r.allSettled(e)},this.refreshDevices=function(){t&&t.length&&(o.forEach(t,function(e){e.refreshDevices&&e.refreshDevices.call(e)}),o.forEach(s,function(e){e.refresh&&e.refresh()}))},this.addEventListener=p.addEventListener,this.removeEventListener=p.removeEventListener,this.requestMdxDevice=function(){if(!t||!t.length)return r.reject();var e=o.find(t,function(e){return"function"==typeof e.requestMdxDevice});return e?e.requestMdxDevice():r.reject(new d(d.ERRORS.NOT_SUPPORTED))};var v=y[e.id];if(o.isUndefined(v))throw new d(d.ERRORS.START_ERROR,"Cannot start discovery manager for platform "+e.name);v.length?(t=[],o.forEach(v,function(r){var i=new r(e);c.config[i.name]=i.config;var s=f.EVENTS;o.forEach(T,function(e,t){e=e.bind(n),T[t]=e,i.addEventListener(s[t],e)}),t.push(i)})):i.warn(e.name+" does not support discovery")};N.prototype.EVENTS=s,N.prototype.getDeviceByMdxUuid=function(e){return o.find(a.current.dscMgr.devices,function(n){return n.mdxUuid===e})},n.exports=N},{"../../builds/ld.js":1,"../configuration.js":7,"../enums.js":33,"../eventManager.js":34,"../logging/logger.js":38,"../mdxError.js":44,"../test/mockDiscoveryComponent.js":69,"./NrdpTargetDiscoveryComponent.js":20,"./castDiscoveryComponentChrome.js":21,"./castDiscoveryComponentIOSv2.js":22,"./castTargetDiscoveryComponent.js":23,"./dialDiscoveryComponentNrdp.js":25,"./dialDiscoveryComponentWinJS.js":26,"./discoveryComponent.js":27,"./discoveryConfig.js":28,"./discoveryEvents.js":29,q:5}],31:[function(e,n,t){var r,o=e("../../builds/ld.js"),i=e("./discoveryConfig.js"),s=e("../logging/logger.js"),c="0.0.0.0";n.exports={isDeviceBlacklisted:function(e,n){return!o.isUndefined(o.find(i.config.blacklist,{manufacturer:e,model:n}))},isValidDeviceInfo:function(e,n){var t=[];return o.forEach(n,function(n,r){var o=e[r];n(o)||t.push([r,o])}),!t.length||(s.warn("Discovered device has invalid properties and will be ignored.","Device Info:",e,"Invalid Properties:",t),!1)},nonEmptyString:function(e){return o.isString(e)&&e.length},headers:{regMode:"X-Accepts-Registration",caps:"X-MDX-Caps",msl:"X-MSL",id:"X-MDX-ID",registered:"X-MDX-Registered",mdxVersion:"X-MDX-Version"},processIflist:function(e){return e?o.find(e,function(e){return"wifi"===e.physicalLayerType&&e.isDefault&&e.ipAddress}):null},get unknownIpAddress(){return c},getLocalIpAddress:function(){switch(r||(r=e("../configuration.js")),r.current.platform.id){case 2:case 6:case 8:return nrdp.mdx.localIPAddress||c;case 5:var n=o.find(Windows.Networking.Connectivity.NetworkInformation.getHostNames(),function(e){return!o.isNull(e.ipInformation)&&!o.isNull(e.ipInformation.networkAdapter)&&e.type===Windows.Networking.HostNameType.ipv4});return n?n.rawName:c;default:return c}},networkIdFromInterface:function(e){return e?(e.ssid||"")+(e.ipAddress||""):""}}},{"../../builds/ld.js":1,"../configuration.js":7,"../logging/logger.js":38,"./discoveryConfig.js":28}],32:[function(e,n,t){var r=e("../../builds/ld.js"),o=/^urn:([\w-]+?):service:([\w-]+):?(?:(\d+))?$/,i=function(e){var n="",t="",i=1;if(r.isString(e)){var s=o.exec(e);s&&(n=s[1]||n,t=s[2]||t,i=s[3]||i)}Object.defineProperties(this,{urn:{enumerable:!0,value:n},service:{enumerable:!0,value:t},version:{enumerable:!0,value:i}})};i.prototype.toString=function(){return"urn:"+this.urn+":service:"+this.service+":"+this.version},i.prototype.toNonVersionedString=function(){return"urn:"+this.urn+":service:"+this.service},Object.defineProperties(i.prototype,{isMdx:{enumerable:!0,get:function(){return"mdx-netflix-com"===this.urn&&"target"===this.service}},isDial:{enumerable:!0,get:function(){return"dial-multiscreen-org"===this.urn&&"dial"===this.service}}}),n.exports=i},{"../../builds/ld.js":1}],33:[function(e,n,t){var r=e("../builds/ld.js"),o=Object.freeze({CONTROLLER:"controller",TARGET:"target"}),i=Object.freeze({NRDP_TARGET:{id:2,name:"NRDP_TARGET",role:o.TARGET},CAST_TARGET:{id:3,name:"CAST_TARGET",role:o.TARGET},CADMIUM_CONTROLLER:{id:4,name:"CADMIUM_CONTROLLER",role:o.CONTROLLER},WINJS_CONTROLLER:{id:5,name:"WINJS_CONTROLLER",role:o.CONTROLLER},NRDP_CONTROLLER:{id:6,name:"NRDP_CONTROLLER",role:o.CONTROLLER},ARGO_CONTROLLER:{id:8,name:"ARGO_CONTROLLER",role:o.CONTROLLER}});n.exports=Object.freeze({logLevels:Object.freeze({NONE:0,ERROR:1,WARN:2,INFO:3,TRACE:4}),roles:o,platforms:i,registrationModes:Object.freeze({DISABLED:"0",ENABLED:"1",DEFAULT_PIN:"2",DARWIN_XPROFILE_V1:"3"}),serviceTypes:Object.freeze({MDX:"urn:mdx-netflix-com:service:target",DIAL:"urn:dial-multiscreen-org:service:dial",CAST:"urn:cast-multiscreen-org:service:cast"}),discoveryStates:Object.freeze({UNKNOWN:0,PENDING:1,AVAILABLE:2,UNAVAILABLE:3,ERROR:4}),launchStates:Object.freeze({UNKNOWN:0,NOT_LAUNCHED:1,PENDING:2,LAUNCHED:3}),controllerTypes:Object.freeze({UNKNOWN:0,MDX:1,REMOTE:2}),profilerModes:Object.freeze({OFF:0,KEY_EVENTS:1,FULL:2}),errors:{PAIRING_UNKNOWN_VERSION:{code:1,desc:"UNSUPPORTED PAIRING VERSION"},PAIRING_INVALID_CONTROLLER_REQUEST:{code:10,desc:"INVALID CONTROLLER REQUEST"},PAIRING_SERVER_ERROR:{code:11,desc:"SERVER ERROR"},PAIRING_TARGET_ERROR:{code:12,desc:"TARGET INTERNAL ERROR"},PAIRING_SERVER_NOT_REACHABLE:{code:13,desc:"SERVER UNAVAILABLE OR TIMEOUT"},PAIRING_CONTROLLER_HMAC_FAILURE:{code:20,desc:"CONTROLLER REQUEST HMAC_FAILURE"},PAIRING_CONTROLLER_CTICKET_EXPIRED:{code:21,desc:"CONTROLLER CTICKET EXPIRED"},PAIRING_CONTROLLER_CTICKET_CORRUPTED:{code:22,desc:"CONTROLLER CTICKET CORRUPTED"},PAIRING_NO_CTICKET:{code:23,desc:"NO CTICKET"},PAIRING_NOT_PAIRING:{code:30,desc:"TARGET NOT IN PAIRING MODE"},PAIRING_ALREADY_PAIRED:{code:31,desc:"TARGET ALREADY PAIRED"},PAIRING_ABORTED:{code:32,desc:"PAIRING ABORTED"},PAIRING_USER_MISMATCH:{code:33,desc:"USER MISMATCH"},REGISTRATION_NOT_REGISTERING:{code:40,desc:"TARGET NOT IN REGISTERING MODE"},REGISTRATION_ALREADY_REGISTERED:{code:41,desc:"TARGET ALREADY REGISTERED"},REGISTRATION_PAIRING_IN_PROGRESS:{code:42,desc:"REG PAIRING IN PROGRESS"},REGISTRATION_PIN_MISMATCH:{code:43,desc:"PIN MISMATCH"},REGISTRATION_PROFILE_MISMATCH:{code:97,desc:"Regpair is only allowed between profiles of the same account"},PAIRING_UNKNOWN_ERROR:{code:98,desc:"UNKNOWN ERROR"},PAIRING_NETWORK_ERROR:{code:99,desc:"NETWORK ERROR"},SESSION_UNKNOWN_VERSION:{code:1,desc:"UNSUPPORTED SESSION VERSION"},SESSION_UNKNOWN_SENDER:{code:2,desc:"UNKNOWN SESSION SENDER"},SESSION_UNKNOWN_RECEIVER:{code:3,desc:"UNKNOWN SESSION RECEIVER"},SESSION_INVALID_NONCE:{code:4,desc:""},SESSION_INVALID_HMAC:{code:5,desc:"MDX SESSION INVALID HMAC"},SESSION_DECRYPTION_FAILED:{code:6,desc:"MDX SESSION DECRYPTION FAILED"},SESSION_MALFORMED_MESSAGE:{code:7,desc:""},SESSION_UNKNOWN_SENDER_USERID:{code:8,desc:"MDX SESSION UNKNOWN SENDER USERID"},SESSION_UNKNOWN_RECEIVER_USERID:{code:9,desc:"MDX SESSION UNKNOWN RECEIVER USERID"},SESSION_NETWORK_ERROR:{code:10,desc:"NETWORK ERROR"},SESSION_INVALID_SID:{code:11,desc:"MDX SESSION INVALID SID"},SESSION_NOT_READY:{code:12,desc:"SESSION NOT READY"},SESSION_START_SESSION_TIMEOUT:{code:13,desc:"START SESSION TIMEOUT"}},connectIntents:Object.freeze({INVALID:0,JOIN:1,LAUNCH:2,LAUNCH_AND_CONTROL:3}),isValidPlatform:function(e){return r.find(i,r.isEqual.bind(void 0,e))}})},{"../builds/ld.js":1}],34:[function(e,n,t){var r=e("../builds/ld.js"),o=e("./logging/logger.js"),i=function(e,n,t){return e&&r.isFunction(n)?(t[e]||(t[e]=[]),r.includes(t[e],n)?o.warn("Duplicate event listener registered for event '"+e+"' was ignored"):t[e].push(n),n):null},s=function(e,n,t){if(t[e]){var o=t[e];r.pull(o,n),o.length||delete t[e]}},c=function(e,n,t){n=r.merge(n||{},{type:e});var o=t[e];o&&o.length&&(o=o.slice(),r.forEach(o,function(e){e(n)}))},a=function(){var e={};this.addEventListener=function(n,t){return i(n,t,e)},this.removeEventListener=function(n,t){s(n,t,e)},this.fireEvent=function(n,t){c(n,t,e)}};n.exports=a},{"../builds/ld.js":1,"./logging/logger.js":38}],35:[function(e,n,t){var r,o,i=e("q"),s=e("../builds/ld.js"),c=e("./logging/logger.js"),a=e("./mdxError.js"),u=function(){var e={},n=0,t={POST:0,GET:1},r=function(n){var t=e[n.xid];if(t){var r=parseInt(n.code);if(n.code&&200!==r&&201!==r||!s.isUndefined(n.body)&&-1!==n.body.indexOf("error")){var o=new a(a.ERRORS.MESSAGING_ERROR,"HTTP request failed - code: "+n.code+" - body: "+n.body);o.httpCode=r,t.reject(o)}else t.resolve(n.body)}else c.warn("MDXLIB http response received without a handler",n)},o=function(t,r,o){var s=i.defer(),c=++n,a=function(){var n=i.defer();return e[c]=n,nrdp.mdx.SendMdxHttpRequest(t,o,c,5,"",r),n.promise};a().done(s.resolve,function(e){0===e.httpCode&&i.delay(1500).then(function(){a().done(s.resolve,s.reject)})});return s.promise.timeout(5200,"Timed out waiting for http response ack from NRDP for "+t)};return this.get=function(e,n){return o(e,n,t.GET)},this.post=function(e,n){return o(e,n,t.POST)},nrdp.mdx.addEventListener("httpresponse",r),this},d=function(){var e=new Windows.Web.Http.HttpClient;return this.get=function(n){var t=i.defer();try{var r=new Windows.Foundation.Uri(n);e.getAsync(r).done(t.resolve,t.reject)}catch(e){return i.reject(e)}return t.promise},this.post=function(n,t){var r=i.defer();try{var o=new Windows.Foundation.Uri(n),s=new Windows.Web.Http.HttpStringContent(t);e.postAsync(o,s).done(r.resolve,r.reject)}catch(e){return i.reject(e)}return r.promise},this},l=function(){return r||(r=new u)},f=function(){return o||(o=new d)},p={2:l,3:null,4:null,5:f,6:l,8:l};n.exports={createHttpClient:function(e){var n=p[e.id];if(n)return n();throw new a(a.ERRORS.PLATFORM_SUPPORT_ERROR,"Cannot create http client for platform: "+e.name)}}},{"../builds/ld.js":1,"./logging/logger.js":38,"./mdxError.js":44,q:5}],36:[function(e,n,t){var r=function(e,n,t,r){var o=e+n;if(t&&1===t.readyState)try{t.send(o)}catch(e){}else r&&r.push(o)},o=function(){var e,n=!0,t=[];Object.defineProperties(this,{shouldBuffer:{enumerable:!0,get:function(){return n},set:function(e){n=e}},ws:{enumerable:!0,get:function(){return e},set:function(n){e=n}}}),this.flush=function(){if(e&&1===e.readyState)for(;t.length;)e.send(t.shift());t=[]},this.trace=function(o){r("TRACE: ",o,e,n?t:void 0)},this.info=function(o){r("INFO: ",o,e,n?t:void 0)},this.warn=function(o){r("WARN: ",o,e,n?t:void 0)},this.error=function(o){r("ERROR: ",o,e,n?t:void 0)},this.mdxIntent=function(o){r("MDX_INTENT: ",o,e,n?t:void 0)}};n.exports=o},{}],37:[function(e,n,t){var r=function(){this.trace=function(e){return console.log("[MDXJS] "+e)},this.info=function(e){return console.info("[MDXJS] "+e)},this.warn=function(e){return console.warn("[MDXJS] "+e)},this.error=function(e){return console.error("[MDXJS] "+e)},this.mdxIntent=function(e){return console.info("[MDXJS] [INTENT] "+e)}};n.exports=r},{}],38:[function(e,n,t){var r=e("../../builds/ld.js"),o=e("../enums.js"),i=e("../mdxError.js"),s=e("./nrdpLogSink.js"),c=e("./nrdpNccpLogSink.js"),a=e("./netflixPlayerLogSink.js"),u=e("./consoleLogSink.js"),d=function(e){return"object"==typeof e&&r.isFunction(e.trace)&&r.isFunction(e.info)&&r.isFunction(e.warn)&&r.isFunction(e.error)},l=function(e,n,t,o,i,s){if(t||n>=e){var c=r.reduce(s,function(e,n){if(r.isString(n)||r.isFunction(n)||r.isError(n))n=n.toString();else try{n=JSON.stringify(n)}catch(e){n=n.toString()}return e=e.length?e+", "+n:n},"");r.forEach(i,function(e){try{e[o](c)}catch(e){}})}},f={2:[s],3:[c,u],4:[a],5:[],6:[s],8:[s,u]},p=function(){var e=this,n=o.logLevels.WARN,t=[];Object.defineProperties(this,{logLevel:{enumerable:!0,get:function(){return n},set:function(e){if(!r.findKey(o.logLevels,function(n){return n===e}))throw new i(i.ERRORS.INVALID_ARG,"log level: "+e);n=e}}}),this.addLogSink=function(e){if(!d(e))throw new i(i.ERRORS.INVALID_ARG,"log sink");r.includes(t,e)||t.push(e)},this.removeLogSink=function(e){r.pull(t,e)},this.removeAllLogSinks=function(){t=[]},this.trace=function(){l(o.logLevels.TRACE,n,!1,"trace",t,arguments)},this.trace.always=function(){l(o.logLevels.TRACE,n,!0,"trace",t,arguments)},this.info=function(){l(o.logLevels.INFO,n,!1,"info",t,arguments)},this.info.always=function(){l(o.logLevels.INFO,n,!0,"info",t,arguments)},this.warn=function(){l(o.logLevels.WARN,n,!1,"warn",t,arguments)},this.warn.always=function(){l(o.logLevels.WARN,n,!0,"warn",t,arguments)},this.error=function(){l(o.logLevels.ERROR,n,!1,"error",t,arguments)},this.error.always=function(){l(o.logLevels.ERROR,n,!0,"error",t,arguments)},this.mdxIntent=function(){l(o.logLevels.INFO,n,!0,"mdxIntent",t,arguments)},this.addDefaultPlatformLogSinks=function(n){var t=f[n.id];if(r.isUndefined(t))throw new i(i.ERRORS.PLATFORM_SUPPORT_ERROR,"Cannot add default log sinks for platform "+n.name);r.forEach(t,function(n){e.addLogSink(new n)})}};n.exports=new p},{"../../builds/ld.js":1,"../enums.js":33,"../mdxError.js":44,"./consoleLogSink.js":37,"./netflixPlayerLogSink.js":39,"./nrdpLogSink.js":40,"./nrdpNccpLogSink.js":41}],39:[function(e,n,t){var r=function(){this.trace=function(e){netflix.player.log.trace(e)},this.info=function(e){netflix.player.log.info(e)},this.warn=function(e){netflix.player.log.warn(e)},this.error=function(e){netflix.player.log.error(e)}};n.exports=r},{}],40:[function(e,n,t){var r=function(e,n,t){return e.call(this,n,"MDX",t||"mdx",{xid:-1})},o=function(){this.trace=function(e){return r.call(nrdp.log,nrdp.log.trace,e)},this.info=function(e){return r.call(nrdp.log,nrdp.log.info,e)},this.warn=function(e){return r.call(nrdp.log,nrdp.log.warn,e)},this.error=function(e){return r.call(nrdp.log,nrdp.log.error,e)},this.mdxIntent=function(e){return r.call(nrdp.log,nrdp.log.info,e,"mdxintent")}};n.exports=o},{}],41:[function(e,n,t){var r=function(){this.trace=function(e){return nrdp.log.toNCCP("mdx","trace",{msg:e})},this.info=function(e){return nrdp.log.toNCCP("mdx","info",{msg:e})},this.warn=function(e){return nrdp.log.toNCCP("mdx","warn",{msg:e})},this.error=function(e){return nrdp.log.toNCCP("mdx","error",{msg:e})},this.mdxIntent=function(e){return nrdp.log.toNCCP("mdxintent","info",{msg:e})}};n.exports=r},{}],42:[function(e,t,r){n=e("./mdxApi.js")},{"./mdxApi.js":43}],43:[function(e,n,t){var r=e("q"),o=e("../builds/ld.js"),i=e("./enums.js"),s=e("./configuration.js"),c=e("./logging/logger.js"),a=e("./profiling/mdxProfiler.js"),u=e("./apiEvents.js"),d=e("./session/msgBusFactory.js"),l=e("./session/securityFactory.js"),f=e("./mdxError.js"),p=e("./discovery/discoveryManager.js"),v=e("./eventManager.js"),g=(e("./versionInfo.js"),0),E=function(e,n,t){try{e.fireEvent(n,t)}catch(e){c.warn("Event handler exception for "+n,e)}},h=function(e){if(s.current.isStarted){var n=this.availableDevices.length;n!==g&&(g=n,E(e,u.AVAILABLE_DEVICE_COUNT_CHANGED,{count:n}))}},m=function(e,n,t){c.info.always("Discovery manager started state changed",t)},y=function(e,n){E(e,u.MDX_DEVICES_AVAILABLE,{available:n.available})},R=function(e,n){h.call(this,e),n.state===i.discoveryStates.AVAILABLE&&E(e,u.DEVICE_AVAILABLE,{device:n.device})},S=function(e,n){E(e,u.SWITCH_CREDENTIALS,n)},I={},A=function(e,n){var t=n.device,r=this;s.current.isStarted&&(I[t.id]||(I[t.id]=!0,t.addEventListener(t.EVENTS.DISCOVERY_STATE_CHANGED,R.bind(r,e)),t.addEventListener(u.SWITCH_CREDENTIALS,S.bind(r,e))),h.call(r,e),E(e,u.DEVICE_AVAILABLE,{device:t}))},T=function(e){E(e,u.START_CONNECTING)},N=function(e){E(e,u.START_DISCONNECTING)},O=function(e){if(e){var n=e.platformMdxLib;l.platformCrypto=n}},j=function(e,n){var t=this,l={initStart:new Date};if(!o.find(j.PLATFORMS,function(n){return o.isEqual(n,e)}))throw new f(f.ERRORS.INVALID_ARG,"Invalid platform specified when constructing the MdxApi instance: "+(e?e.name:"undefined"));s.reset(),s.current.platform=e,e.id===i.platforms.ARGO_CONTROLLER.id&&(r.onerror=function(e){e instanceof Error||e instanceof f?c.error("MDX unhandled error caught",e,e.message,e.stack):c.error("MDX unhandled promise rejection caught",e)});var g=new v,h=new p(e);s.current.dscMgr=h,s.current.discovery=h.config;var R=h.EVENTS;h.addEventListener(R.STARTED_STATE_CHANGED,m.bind(t,s.current,g)),h.addEventListener(R.DEVICE_FOUND,A.bind(t,g)),h.addEventListener(R.MDX_DEVICES_AVAILABLE,y.bind(t,g)),h.addEventListener(R.START_CONNECTING,T.bind(t,g)),h.addEventListener(R.START_DISCONNECTING,N.bind(t,g)),d.configureProtocolsForPlatform(e),Object.defineProperties(this,{config:{enumerable:!0,get:function(){return o.clone(s.current,!0)}},availableDevices:{enumerable:!0,get:function(){return h.availableDevices}}}),this.start=function(e){if(s.current.isStarted)return r.reject(new f(f.ERRORS.ALREADY_STARTED));if(l&&l.initStart){var n=l.initStart;a.setBaseTime(n),a.newEvent(a.EVENTS.INIT,void 0,n,l.initComplete),l=null}var d=a.newEvent(a.EVENTS.START),p=r.defer();return h.start.call(h,e,d).timeout(6e3).tap(function(){if(h.discoveryComponents.length){if(!o.find(h.discoveryComponents,function(e){return e.isStarted}))return c.error.always("MDX failed to start as there wasn't a single discovery component that reported a successful start!"),void p.reject(new f(f.ERRORS.START_ERROR,"No discovery components could start"))}O.call(t,e),d.complete(),s.current.isStarted=!0,E(g,u.STARTED_STATE_CHANGED,{isStarted:!0}),
c.info("MDX Started. Launch args: ",arguments[0]),s.current.platform.role===i.roles.CONTROLLER?p.resolve():p.resolve.apply(null,arguments),s.current.scheduler.async(function(){o.forEach(h.devices,function(e){I[e.id]||A.call(t,g,{device:e})})})}).done(),p.promise},this.stop=function(){if(!s.current.isStarted)return r.reject(new f(f.ERRORS.ALREADY_STOPPED));c.trace("Stopping MDX");var e=a.newEvent(a.EVENTS.STOP),n=r.defer();return s.current.storage.storeDeviceMap(s.current.dscMgr.devices).finally(function(){h.stop.call(h,e).timeout(1e3).finally(function(){e.complete()}).done(function(){s.current.isStarted=!1,E(g,u.STARTED_STATE_CHANGED,{isStarted:!1}),n.resolve()},function(e){var t=e?e.toString():"";n.reject(new f(f.ERRORS.STOP_ERROR,t))})}),n.promise},this.reset=function(){return c.info.always("Resetting all MDX state"),s.current.storage.reset().then(h.clearDevices)},this.refreshDevices=function(){if(s.current.platform.role!==i.roles.CONTROLLER)throw new f(f.ERRORS.NOT_SUPPORTED,"MdxApi.refreshDevices is only supported on controller platforms");h.refreshDevices.call(h)},this.addEventListener=g.addEventListener,this.removeEventListener=g.removeEventListener,this.requestMdxDevice=h.requestMdxDevice,c.removeAllLogSinks(),c.addDefaultPlatformLogSinks(e);return c.info.always("MDX Initialized - version: "+j.version+", flavor: RELEASE, platform: "+e.name+", role: "+e.role),l.initComplete=new Date,this};Object.defineProperties(j,{version:{get:function(){return s.current.version}},PLATFORMS:{get:function(){return i.platforms}},ROLES:{get:function(){return i.roles}},EVENTS:{get:function(){return u}},LOG_LEVELS:{get:function(){return i.logLevels}},REGISTRATION_MODES:{get:function(){return i.registrationModes}},PROFILER_MODES:{get:function(){return i.profilerModes}},ERRORS:{get:function(){return f.ERRORS}}}),j.prototype.configure=function(e){o.isUndefined(e)||(c.info("MDX configuration options",e),s.process(this,s.current,e))},j.prototype.broadcastAppMessage=function(e,n){if(s.current.platform.role!==i.roles.TARGET)throw new f(f.ERRORS.NOT_SUPPORTED,"MdxApi.broadcastAppMessage is only supported on target platforms");c.trace("MdxApi.broadcastAppMessage",e,n);var t,a=[];return o.forEach(this.availableDevices,function(r){t=r.sendAppMessage(e,n).fail(function(){c.error("broadcastAppMessage promise FAILED")}),a.push(t)}),c.trace("broadcastAppMessage returning promisesArray"),r.all(a)},r.stopUnhandledRejectionTracking(),r.makePromise.prototype.success=function(e){return this.done(e,function(){})},n.exports=j},{"../builds/ld.js":1,"./apiEvents.js":6,"./configuration.js":7,"./discovery/discoveryManager.js":30,"./enums.js":33,"./eventManager.js":34,"./logging/logger.js":38,"./mdxError.js":44,"./profiling/mdxProfiler.js":45,"./session/msgBusFactory.js":60,"./session/securityFactory.js":65,"./test/mockDeviceHelper.js":68,"./test/testConfiguration.js":72,"./versionInfo.js":74,q:5}],44:[function(e,n,t){var r={code:0,message:"There was an unknown error encountered"},o={},i=function(e,n){e=e||r,n=n?": "+n:"",this.name="MdxError",this.code=e.code,this.message=e.message+n,this.stack=(new Error).stack};i.prototype=Object.create(Error),i.prototype.toString=function(){return this.code+" : "+this.message},Object.defineProperty(i,"ERRORS",{enumerable:!0,value:o}),i.prototype.ERRORS=o,i.prototype.isEqual=function(e){return e instanceof i&&this.code===e.code},o.UNKNOWN=new i(r),o.INVALID_ARG=new i({code:1,message:"Invalid argument value"}),o.PLATFORM_SUPPORT_ERROR=new i({code:2,message:"Platform does not support operation"}),o.NOT_SUPPORTED=new i({code:3,message:"Operation not supported"}),o.CANCELLED=new i({code:4,message:"Operation cancelled"}),o.NOT_IMPLEMENTED=new i({code:9999,message:"NOT IMPLEMENTED"}),o.INVALID_CONFIG=new i({code:100,message:"Invalid configuration value specified"}),o.START_ERROR=new i({code:101,message:"MDX Start failure"}),o.STOP_ERROR=new i({code:102,message:"MDX Stop failure"}),o.ALREADY_STARTED=new i({code:103,message:"MDX already started"}),o.ALREADY_STOPPED=new i({code:104,message:"MDX already stopped"}),o.PROTOCOL_ERROR=new i({code:200,message:"Protocol error"}),o.USER_MISMATCH=new i({code:201,message:"Pairing user mismatch"}),o.REGISTRATION_NOT_SUPPORTED=new i({code:202,message:"Registration not supported"}),o.CONNECT_FAILED=new i({code:203,message:"Failed to connect with the device"}),o.INVALID_CTICKET=new i({code:204,message:"Invalid CTICKET"}),o.NOT_CONNECTED=new i({code:205,message:"Not connected to the Netflix app on the device"}),o.APP_NOT_RUNNING=new i({code:206,message:"Netflix app not running"}),o.CRYPTO_ERROR=new i({code:300,message:"There was a crypto error encountered"}),o.MESSAGING_ERROR=new i({code:301,message:"Message sending failed"}),Object.freeze(o),n.exports=i},{}],45:[function(e,n,t){var r,o=e("../../builds/ld.js"),i=e("../enums.js"),s=e("./profilerEvents.js"),c=e("./profileFormats.js"),a=e("../logging/logger.js"),u=e("../mdxError.js"),d=null,l={name:"local",events:[],markers:[]},f={newSubEvent:function(){return f},complete:function(){}},p=function(e,n,t,r,o){this.id=e,this.deviceId=n||"",this.start=r,this.end=null,this.events=[],this.parent=o||null,this.newSubEvent=t?function(e,n,t){var r=v(e,this.deviceId,!0,n,this);return t&&r.complete(t),r}:function(){return f}};p.prototype.complete=function(e){if(null===this.end&&(this.end=e||new Date,!this.parent)){var n=d.devices[this.deviceId];if(n){var t=n.events,r=[],i=function(e){r.push(e),e.complete(),o.forEach(e.events,i)};i(this),o.forEach(r,function(e){t.push(e.id),t.push(e.start);var n=e.end.valueOf()-d.baseTime.valueOf();t.push(n)})}}};var v=function(e,n,t,r){var o=(r?r.valueOf():(new Date).valueOf())-d.baseTime.valueOf();return new p(e,n,t,o)},g=0,E=function(n,t,o,i){var s=this,c=o.session;s.index=g++,s.profiler=n,s.intent=t,s.result=s.RESULTS.FAILED,s.error="",s.preemptedBy="",s.targetVersion=c.mdxVersion.toString(),s.xid=i||null,s.targetUi=c.uiVersion||null,s.targetPlatform=c.platformVersion||null,s.targetFw=c.fwVersion||null,s.targetPlayer=c.playerVersion||null,s.targetShell=c.shellVersion||null,s.startTime=new Date,s.ackTime=s.firstImpTime=s.completedTime=null,r||(r=e("../configuration.js")),s.failTimer=r.current.scheduler.delay(function(){s.failed("Timed out")},45e3)};E.prototype.RESULTS={FAILED:"FAILED",SUCCESS:"SUCCESS",PREEMPTED:"PRE-EMPTED"},E.prototype.send=function(){var e=this;e.failTimer&&r.current.scheduler.cancelDelay(e.failTimer);var n=r.current,t=e.startTime;a.mdxIntent(JSON.stringify({index:e.index,controllerMdx:n.version,targetMdx:e.targetVersion,controllerUi:n.uiVersion,targetUi:e.targetUi,controllerNative:n.platformVersion,targetNative:e.targetPlatform,targetFirmware:e.targetFw,targetPlayer:e.targetPlayer,targetShell:e.targetShell,intent:e.intent,xid:e.xid,result:e.result,ackTime:e.ackTime?e.ackTime-t:null,firstImpressionTime:e.firstImpTime?e.firstImpTime-t:null,completedTime:e.completedTime?e.completedTime-t:null,preemptedBy:e.preemptedBy,errorText:e.error})),e.profiler.currentIntent=null},E.prototype.success=function(){var e=this;e.result=e.RESULTS.SUCCESS,e.send.call(this)},E.prototype.failed=function(e){var n=this;n.error=e||"",n.result=n.RESULTS.FAILED,n.send.call(this)},E.prototype.preEmpted=function(e){var n=this;n.preemptedBy=e,n.result=n.RESULTS.PREEMPTED,n.send.call(this)},E.prototype.ack=function(){var e=this;e.ackTime=new Date,"SET_VOLUME"!==e.intent&&"DISMISS_POSTPLAY"!==e.intent||e.success()},E.prototype.processStateChange=function(e){var n=this,t=e.currentState,r=new Date;if(t){var o=function(){n.firstImpTime=n.firstImpTime||r,"PLAYING"===t&&(n.completedTime=r,n.success())};switch(n.intent){case"PLAY":if("END_PLAYBACK"===t)return;o();break;case"SKIP":case"SET_TIME":o();break;case"PAUSE":case"RESUME":case"STOP":case"AUTO_ADVANCE":!function(){n.firstImpTime=n.completedTime=new Date,n.success()}()}n.xid=n.xid||e.xid||null}},E.prototype.processAudioSubtitlesChanged=function(){var e=this;if("SET_AUDIO_SUBTITLES"===e.intent){var n=new Date;e.firstImpTime=e.completedTime=n,e.success()}};var h=function(){var e=i.profilerModes.OFF;Object.defineProperties(this,{mode:{enumerable:!0,get:function(){return e},set:function(n){var t=i.profilerModes;if(!o.findKey(t,function(e){return e===n}))throw new u(u.ERRORS.INVALID_CONFIG,"profiler mode:"+n);switch(e=n){case t.OFF:d=null;break;case t.KEY_EVENTS:case t.FULL:d||(d={baseTime:new Date,devices:{"":l}})}}},currentIntent:{enumerable:!0,writable:!0,value:null}}),this.setBaseTime=function(e){d&&(d.baseTime=e)},this.addDevice=function(e,n){if(d){var t=d.devices;if(t[e])throw new u(u.ERRORS.INVALID_ARG,"Device already added to the mdx profile: "+e+" - "+JSON.stringify(n));t[e]=o.merge({events:[],markers:[]},n)}},this.newEvent=function(n,t,r,o){if(!d)return f;var s=v(n,t,e===i.profilerModes.FULL,r);return o&&s.complete(o),s},this.newMarker=function(e,n,t){if(d&&e){var r=(t?t.valueOf():(new Date).valueOf())-d.baseTime.valueOf(),o=n&&d.devices[n]||l,i=o.markers;i.push(e),i.push(r)}},this.getData=function(e){switch(e){case"csv":return c.asCsv(d);default:return o.clone(d,!0)}},this.registerUserIntent=function(e,n,t){var r=this,o=r.currentIntent;if(o&&o.intent===e){if(!(new Date-o.startTime>100))return o;r.currentIntent.preEmpted(e)}return r.currentIntent=new E(r,e,n,t),r.currentIntent}};h.prototype.EVENTS=s,n.exports=new h},{"../../builds/ld.js":1,"../configuration.js":7,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"./profileFormats.js":46,"./profilerEvents.js":47}],46:[function(e,n,t){var r=e("../../builds/ld.js"),o=function(e){var n=[];return r.forEach(e.devices,function(e,t){for(var r=e.events,o=t||"local";r.length;)n.push([o,r.shift(),r.shift(),r.shift()].join(","));for(r=e.markers;r.length;)n.push([o,r.shift(),r.shift()].join(",")+",");return n}),["device,event,start,end"].concat(n)};n.exports={asCsv:o}},{"../../builds/ld.js":1}],47:[function(e,n,t){n.exports={INVALID:0,INIT:1,START:2,START_CAST_DISC:3,START_DIAL_DISC:4,DEVICE_FOUND:5,DEVICE_GONE:6,DEVICE_REFOUND:7,STOP:8,STOP_CAST_DISC:9,STOP_DIAL_DISC:10,CONNECT:11,DROPPED:100,VALIDATE_MSG:101,DISPATCH_FAILED:102,PAIRIFY:103,DISPATCH_MSG:104,QUEUED:105,CREATE_CTX:106,HMAC:107,DECRYPT:108,ENCRYPT:109,CANONICAL:110,UNKNOWN_MSG:120,PAIRINGREQUEST:121,ERROR:122,PAIRINGREJECTED:123,PAIRINGRESPONSE:124,START_SESSION:125,END_SESSION:126,SESSION_ERR_MSG:127,REGPAIRREQUEST:128,PINGREQUEST:129,PINGRESPONSE:130,PAIRING_ERROR_RESPONSE:131,REGPAIRRESPONSE:132,REGPAIR_ERROR_RESPONSE:133,HANDSHAKE:150,PLAYER_PLAY:151,PLAYER_PAUSE:152,PLAYER_RESUME:153,PLAYER_STOP:154,PLAYER_SKIP:155,PLAYER_SET_CURRENT_TIME:156,PLAYER_SET_AUTO_ADVANCE:157,PLAYER_SET_VOLUME:158,PLAYER_GET_CURRENT_STATE:159,PLAYER_GET_CAPABILITIES:160,MESSAGE_IGNORED:161,HANDSHAKE_ACCEPTED:162,PLAYER_CURRENT_STATE:163,PLAYER_STATE_CHANGED:164,PLAYER_CAPABILITIES:165,DIALOG_SHOW:166,DIALOG_CANCEL:167,DIALOG_RESPONSE:168,GET_AUDIO_SUBTITLES:169,SET_AUDIO_SUBTITLES:170,AUDIO_SUBTITLES_SETTINGS:171,AUDIO_SUBTITLES_CHANGED:172,PIN_VERIFICATION_SHOW:173,PIN_VERIFICATION_NOT_REQUIRED:174,PIN_VERIFICATION_CANCEL:175,PIN_VERIFICATION_RESPONSE:176,META_DATA_CHANGED:177,CAST_HANDSHAKE:200,CAST_RESUME:201,CAST_PAUSE:202,CAST_DEVICE_CONNECT:203,CAST_APP_CONNECT:204,CAST_STOP:205,SERVER_PAIR:300,DIAL_LAUNCH:400}},{}],48:[function(e,n,t){var r,o,i,s=e("q"),c=e("../builds/ld.js"),a=e("./mdxError.js"),u=function(){},d=function(){var e=arguments[0],n=arguments[1];if(n){var t=c.drop(arguments,2);e(function(){n.apply(this,t)},0)}},l=function(){var e=arguments[0],n=arguments[1];if(!n)return s.reject(new a(a.ERRORS.INVALID_ARG,"Invalid fn value for asyncResolve"));var t=s.defer(),r={resolve:t.resolve,reject:t.reject,notify:t.notify},o=[r].concat(c.drop(arguments,2));return e(function(){n.apply(this,o)},0),t.promise},f=function(){var e=arguments[0],n=arguments[1];if(n){var t=arguments[2],r=c.drop(arguments,3);return e(function(){n.apply(this,r)},t)}},p=function(e,n){e.call(this,n)},v=function(){var e=arguments[0],n=arguments[1],t=arguments[2];if(t){var r=arguments[3],o=arguments[4],i=c.drop(arguments,5),s=n(function(){t.apply(this,i)},r);if(o){var a=new u;return a.intervalId=s,a.timeoutId=e(function(){t.apply(this,i)},0),a}return s}},g=function(e,n,t){t instanceof u?(e.call(this,t.timeoutId),n.call(this,t.intervalId)):n.call(this,t)},E=function(e,n,t,r,o){if(!n)return s.reject(new a(a.ERRORS.INVALID_ARG,"Invalid fn value for retry"));r=parseInt(r)||1;var i=s.defer(),c=function(n){n>=r?i.reject(o||"Operation failed after "+r+" attempts"):e(function(){u(++n)},t)},u=function(e){var t=s(n());if(t.isPending())t.done(i.resolve,function(){c(e)});else{var r=t.inspect().value;if(r){if(1===e)return s.resolve(r);i.resolve(r)}else c(e)}return null};return u(1)||i.promise},h=function(){};h.prototype.async=function(){var e=[nrdp.gibbon.setTimeout].concat(Array.prototype.slice.call(arguments));return d.apply(void 0,e)},h.prototype.asyncResolve=function(){var e=[nrdp.gibbon.setTimeout].concat(Array.prototype.slice.call(arguments));return l.apply(void 0,e)},h.prototype.delay=function(){var e=[nrdp.gibbon.setTimeout].concat(Array.prototype.slice.call(arguments));return f.apply(nrdp.gibbon,e)},h.prototype.cancelDelay=function(){var e=[nrdp.gibbon.clearTimeout].concat(Array.prototype.slice.call(arguments));return p.apply(nrdp.gibbon,e)},h.prototype.repeat=function(){var e=[nrdp.gibbon.setTimeout,function(){var e=Array.prototype.slice.call(arguments);return e.splice(2,0,!1),nrdp.gibbon.setTimeout.apply(nrdp.gibbon,e)}].concat(Array.prototype.slice.call(arguments));return v.apply(nrdp.gibbon,e)},h.prototype.cancelRepeat=function(){var e=[nrdp.gibbon.clearTimeout,nrdp.gibbon.clearTimeout].concat(Array.prototype.slice.call(arguments));return g.apply(void 0,e)},h.prototype.retry=function(){var e=[nrdp.gibbon.setTimeout].concat(Array.prototype.slice.call(arguments));return E.apply(void 0,e)};var m=function(){};m.prototype.async=function(){var e=[window.setTimeout].concat(Array.prototype.slice.call(arguments));return d.apply(void 0,e)},m.prototype.asyncResolve=function(){var e=[window.setTimeout].concat(Array.prototype.slice.call(arguments));return l.apply(void 0,e)},m.prototype.delay=function(){var e=[window.setTimeout].concat(Array.prototype.slice.call(arguments));return f.apply(window,e)},m.prototype.cancelDelay=function(){var e=[window.clearTimeout].concat(Array.prototype.slice.call(arguments));return p.apply(window,e)},m.prototype.repeat=function(){var e=[window.setTimeout,window.setInterval].concat(Array.prototype.slice.call(arguments));return v.apply(window,e)},m.prototype.cancelRepeat=function(){var e=[window.clearTimeout,window.clearInterval].concat(Array.prototype.slice.call(arguments));return g.apply(void 0,e)},m.prototype.retry=function(){var e=[window.setTimeout].concat(Array.prototype.slice.call(arguments));return E.apply(void 0,e)};var y=function(){};y.prototype.async=function(){var e=[setTimeout].concat(Array.prototype.slice.call(arguments));return d.apply(null,e)},y.prototype.asyncResolve=function(){var e=[setTimeout].concat(Array.prototype.slice.call(arguments));return l.apply(null,e)},y.prototype.delay=function(){var e=[setTimeout].concat(Array.prototype.slice.call(arguments));return f.apply(null,e)},y.prototype.cancelDelay=function(){var e=[clearTimeout].concat(Array.prototype.slice.call(arguments));return p.apply(null,e)},y.prototype.repeat=function(){var e=[setTimeout,setInterval].concat(Array.prototype.slice.call(arguments));return v.apply(null,e)},y.prototype.cancelRepeat=function(){var e=[clearTimeout,clearInterval].concat(Array.prototype.slice.call(arguments));return g.apply(null,e)},y.prototype.retry=function(){var e=[setTimeout].concat(Array.prototype.slice.call(arguments));return E.apply(null,e)};var R=function(){return o||(o=new m)},S=function(){return r||(r=new h)},I=function(){return i||(i=new y)},A={2:S,3:R,4:R,5:R,6:S,8:I};n.exports={createScheduler:function(e){var n=A[e.id];if(n)return n();throw new a(a.ERRORS.PLATFORM_SUPPORT_ERROR,"Cannot create scheduler for platform: "+e.name)}}},{"../builds/ld.js":1,"./mdxError.js":44,q:5}],49:[function(e,n,t){var r=e("q"),o=e("../logging/logger.js"),i=e("./validation.js"),s=e("./msgFactory.js"),c=e("../profiling/mdxProfiler.js"),a=e("../enums.js"),u=e("../configuration.js"),d=e("./error.js"),l=e("../mdxError.js"),f=e("../eventManager.js"),p=0,v={},g=new f,E={endSessionAck:"endSessionAck"},h=function(e,n,t){t.id=c.EVENTS.START_SESSION;var o=++p,i=n.session;return i.sendSessionMessage(s.startSessionResponse(o)).finally(function(){i.mdxSessionId=o}),r.resolve()},m=function(e,n,t){return t.id=c.EVENTS.END_SESSION,this.end(!1,!0,"true"===e.ack)},y=function(e){return g.fireEvent(E.endSessionAck,{session:this,msg:e}),r.resolve()},R=function(e,n,t){t.id=c.EVENTS.START_SESSION,n.session.mdxSessionId=e.sessionId,n.session.supportsEndAck="true"===e.supportsEndAck;var i=v[n.id],s=i&&i.deferred;return s?s.resolve():o.warn("Start session response was unexpected or too late",e),r.resolve()},S=function(e,n,t,o){var i=n.session,u=e.appAction,d=e.appBody,l=c.EVENTS[u];if(l&&t&&(t.id=l),parseInt(e.sessionId)!==parseInt(i.mdxSessionId))return i.sendMdxMessage(s.error(o,n,a.errors.SESSION_INVALID_SID),"session"),r.resolve();if("HANDSHAKE"===u)return i.sendSessionMessage(s.handshakeAccepted(i.mdxSessionId,d.contractVersion)),r.resolve();var f={type:u,payload:d,transactionId:o};return r.resolve(f)},I={createSession:h,endSession:m,endSessionAck:y,startSessionResponse:R,appMessage:S},A=function(e,n,t){return o.warn("Processing session error message from device",n.id,e),t.id=c.EVENTS.SESSION_ERR_MSG,n.session.errMsgCount++,u.current.platform.role,a.roles.CONTROLLER,r.resolve()},T=function(e){return"session"===e.action},N=function(e,n,t){var c=this;if("error"===e.action)return A.call(c,e);c.errMsgCount=0;var d=r.defer();return c.processEncryptedMessage(e,t).done(function(r){var s=i.parsePairedPayload(r),a=s.sessionAction,u=I[a];if(u)u.call(c,s,n,t,e.nonce).done(d.resolve,d.reject);else{var l="Unknown Session Message Action: "+a;o.error(l),d.reject(l)}},function(t){c.mdxSessionId||t.code===l.ERRORS.CRYPTO_ERROR.code?(u.current.scheduler.async(function(){c.sendMdxMessage(s.error(e.nonce,n,a.errors.SESSION_INVALID_HMAC),"session").finally(function(){l.ERRORS.CRYPTO_ERROR.isEqual(t)?n.clearPairing():(c.mdxSessionId=null,n.disconnectFromApp())})}),d.reject(new l(l.ERRORS.MESSAGING_ERROR,"Application session message failed to decrypt: "+JSON.stringify(t)))):d.resolve()}),d.promise},O=function(e){var n=this,t=e.id,o=u.current.scheduler,i=r.defer();return e.mdxSessionId=0,n.sendSessionMessage(s.startSessionRequest()).success(function(c){var a=function r(c){c&&"ETIMEDOUT"===c.code&&0===e.mdxSessionId&&o.async(function(){n.sendSessionMessage(s.startSessionRequest()).then(function(){var e=v[t];e&&(e.retryTimeout&&o.cancelDelay(e.retryTimeout),o.delay(r,8e3))})}),i.reject(c)},u=r.defer();v[t]={deferred:u},u.promise.timeout(8e3).then(i.resolve,a).finally(function(){var e=function e(){d.clearErrorHandler(c),t.removeEventListener(t.EVENTS.LAUNCH_STATE_CHANGED,e)},t=n.device;t.addEventListener(t.EVENTS.LAUNCH_STATE_CHANGED,e)}),d.registerErrorHandler(c,function(e){return u.reject(e),r.resolve()})}),i.promise.timeout(13e3,"Timed out trying to start session with target "+e.id).finally(function(){var e=v[t];e&&e.retryTimeout&&o.cancelDelay(e.retryTimeout),delete v[t]})};n.exports={canHandle:T,handleMsg:N,startSession:O,addMessageListener:g.addEventListener.bind(g),removeMessageListener:g.removeEventListener.bind(g),events:E}},{"../configuration.js":7,"../enums.js":33,"../eventManager.js":34,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./error.js":56,"./msgFactory.js":61,"./validation.js":66,q:5}],50:[function(e,n,t){var r=e("q"),o=(e("../logging/logger.js"),e("../eventManager.js")),i=new o,s=function(e){return"broadcast"===e.action},c=function(e,n){var t={device:n,payload:e.payload};return i.fireEvent(e.messageType,t),r.resolve()};n.exports={canHandle:s,handleMsg:c,addMessageListener:i.addEventListener.bind(i),removeMessageListener:i.removeEventListener.bind(i)}},{"../eventManager.js":34,"../logging/logger.js":38,q:5}],51:[function(e,n,t){var r,o=e("q"),i=e("../../builds/ld.js"),s=e("../logging/logger.js"),c=e("../profiling/mdxProfiler.js"),a=e("../enums.js"),u=e("./regPairFactory.js"),d=e("../configuration.js"),l=e("./mdxSession.js"),f=e("../mdxError.js"),p=e("../versionInfo.js"),v=function(e,n,t,o){l.call(this,e,o);var i=n;return Object.defineProperties(this,{protocol:{enumerable:!1,value:"cast://"},senderId:{enumerable:!0,get:function(){return i},set:function(e){i=e}},senderGuid:{enumerable:!1,get:function(){return i.substr(i.indexOf(":")+1)}},opts:{enumerable:!1,value:o||{}}}),t&&(r=t),this};v.prototype=Object.create(l.prototype),v.prototype.sendHandshakeResponse=function(){var e=this,n=u.createProvider(d.current.platform),t={type:"castHandShakeAck",registered:n.isRegistered,msl:!0};if(e.mdxVersion.matches(0,0,0))i.merge(t,{registrationAcceptance:a.registrationModes.DEFAULT_PIN});else{if(!e.mdxVersion.isGreaterThanOrEqual(4,0,0))return void s.error("Cannot send cast handshake response for unexpected controller version",e.mdxVersion.toString());var o=navigator.appVersion||"",c=/CrKey\/(\d+.\d+.\d+)/.exec(o),l=new p(c?c[1]:""),f=(nrdp.device.softwareVersion||"").split("|"),v=f[0],g=f.length&&f[1],E=e.opts.handshake&&e.opts.handshake.mdxContractVersion||d.current.mdxContractVersion;i.merge(t,{registrationAcceptance:d.current.registrationMode,version:d.current.version,handshake:{accepted:d.current.mdxContractVersion===E,contractVersion:d.current.mdxContractVersion,volumeControl:!0===d.current.volumeControl,volumeStep:d.current.volumeStep},uiVersion:d.current.uiVersion,platformVersion:d.current.nativeVersion,fwVersion:l,playerVersion:g,shellVersion:v})}r.send(e.senderId,t)},v.prototype.processMdxMessage=function(e,n){try{var t=this;e.type&&"castHandShake"===e.type?t.sendHandshakeResponse.call(t):l.prototype.processMdxMessage.call(t,e,n)}catch(e){s.error("CastControllerSession.processMdxMessage - Message  handling failed",e,e.stack)}},v.prototype.processMediaMessage=function(e,n){try{var t=this.device,r="CAST_"+e;c.newMarker(c.EVENTS[r],t.id,n);var o={device:t,payload:{},xid:0,type:"PLAYER_"+e};t.onAppMessage(o)}catch(e){s.error("CastControllerSession.processMediaMessage - Message handling failed",e,e.stack)}},v.prototype.dispatchMessage=function(e){e.url="cast://"+nrdp.device.ESN+e.url;try{return r.send(this.senderId,e),o.resolve()}catch(e){return o.reject(e)}},v.fromExisting=function(e,n){return new v(e.mdxVersion,n,e.mdxUuid,null,e.controllerOps)},v.prototype.sendAppMessage=function(e,n){return this.opts.incomingOnly?o.reject(new f(f.ERRORS.MESSAGING_ERROR),"Dropping message to device - this session only supports incoming messages"):l.prototype.sendAppMessage.call(this,e,n)},n.exports=v},{"../../builds/ld.js":1,"../configuration.js":7,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"../versionInfo.js":74,"./mdxSession.js":58,"./regPairFactory.js":64,q:5}],52:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("../profiling/mdxProfiler.js"),c=e("../configuration.js"),a=e("../enums.js"),u=e("./mdxTargetSession.js"),d=e("../versionInfo.js"),l=e("../mdxError.js"),f={},p=function(){u.call(this);var e;return Object.defineProperties(this,{sessionId:{enumerable:!0,get:function(){return e},set:function(n){e=n}},protocol:{enumerable:!1,value:"cast://"}}),this};p.prototype=Object.create(u.prototype),p.prototype.appConnectionTimeout=2e4,p.prototype.deviceConnectionTimeout=1e4,p.prototype.guestModeDeviceConnectionTimeout=9e4,p.prototype.sendCastHandshake=function(e,n){var t=this,o=t.device,i=o.mdxUuid,a=n&&n.newSubEvent(s.EVENTS.CAST_HANDSHAKE),u={type:"castHandShake",uuid:i,friendlyName:o.friendlyName,controlleruuid:c.current.mdxUuid,payload:e,controllerMdxVersion:c.current.version,opts:{handshake:{mdxContractVersion:c.current.mdxContractVersion}}};return c.current.scheduler.retry(function(){var e=r.defer();return t.sendCastMessage.call(t,u).done(function(){a&&a.complete(),e.resolve()},function(){return t.cleanupCastConnection(!0).then(t.createDeviceConnection.bind(t)).then(t.createAppConnection.bind(t)).finally(e.reject)}),e.promise},500,2,"Failed to send the cast handshake to the target after max retries").then(function(){var e=r.defer();return f[t.sessionId]=e,e.promise},function(){return r.reject(new l(l.ERRORS.CONNECT_FAILED,"Failed to send the cast handshake"))}).timeout(3e4,"Timed out waiting for a cast handshake response from the target")},p.prototype.processCastHandshakeAck=function(e){var n=this,t=f[n.sessionId];if(!t)return void i.warn("Received an unexpected cast handshake ack",e);var r=n.device;r.isRegistered=e.registered,r.isMsl=!0;var s=o.find(a.registrationModes,function(n){return n===e.registrationAcceptance})||a.registrationModes.DISABLED;r.registrationMode=s,n.mdxVersion=new d(e.version?e.version:"4.0.0"),n.uiVersion=e.uiVersion||null,n.platformVersion=e.platformVersion,n.fwVersion=e.fwVersion||null,n.playerVersion=e.playerVersion||null,n.shellVersion=e.shellVersion||null,t.resolve()},p.prototype.processMdxMessage=function(e,n){var t=this;try{var r=e.type;r?"castHandShakeAck"===r?t.processCastHandshakeAck.call(t,e):"castHandShakeRequest"===r&&t.sendCastHandshake.call(t,t.device.discoveryComponent.config.defaultLaunchArgs):u.prototype.processMdxMessage.call(t,e,n)}catch(e){i.error("CastTargetSessionBase.processMdxMessage - Message  handling failed",e,e.stack)}},p.prototype.dispatchMessage=function(e){return this.sendCastMessage.call(this,e)},p.prototype.handleTargetConnection=function(e,n,t,o,i){var s=this,u=s.device,d=r.defer(),f=a.connectIntents,p=e===f.LAUNCH||e===f.LAUNCH_AND_CONTROL,v=e===f.LAUNCH_AND_CONTROL;if(u.launchState===a.launchStates.LAUNCHED||i||(u.launchState=a.launchStates.PENDING),u.isGuestMode&&e===f.JOIN&&!u.canJoinInGuestMode)c.current.scheduler.async(d.reject.bind(d,new l(l.ERRORS.CANCELLED,"Cast target is in guest mode - join not permitted")));else{var g;g=s.createDeviceConnection?s.createDeviceConnection.call(s,t).then(s.createAppConnection.bind(s,p,t)):r.resolve({launched:!0}),g.done(function(e){e.launched?s.sendCastHandshake.call(s,n,t).then(s.startSession.bind(s,v,o)).then(function(){u.isGuestMode&&(u.canJoinInGuestMode=!0)}).done(d.resolve,d.reject):(u.launchState=a.launchStates.NOT_LAUNCHED,d.reject(new l(l.ERRORS.APP_NOT_RUNNING)))},function(e){e&&"ETIMEDOUT"===e.code&&(e=new l(l.ERRORS.CONNECT_FAILED,e.message)),d.reject(e)})}return d},p.prototype.dispose=function(){var e=this;return e.sessionId&&(e.sessionId=null),r.resolve()},n.exports=p},{"../../builds/ld.js":1,"../configuration.js":7,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"../versionInfo.js":74,"./mdxTargetSession.js":59,q:5}],53:[function(e,n,t){var r=e("q"),o=(e("../logging/logger.js"),e("../enums.js")),i=e("./castTargetSessionBase.js"),s=e("../mdxError.js"),c=function(e){var n=this,t=n.device,r=o.discoveryStates.UNAVAILABLE,i=o.launchStates.NOT_LAUNCHED;n.castSession.status===chrome.cast.SessionStatus.CONNECTED?(r=o.discoveryStates.AVAILABLE,i=o.launchStates.LAUNCHED):(n.end(!1,!0),n.castSession=null),t.discoveryState=r,t.launchState=i},a=function(e,n){if(e===this.namespace)try{var t=new Date,r=JSON.parse(n);this.processMdxMessage(r,t)}catch(e){}},u=function(e,n){var t=this;i.call(t);var r,o=c.bind(t),s=a.bind(t);return Object.defineProperties(t,{namespace:{enumerable:!1,writable:!1,value:n},castSession:{enumerable:!1,get:function(){return r},set:function(e){e!==r&&(r&&(r.removeUpdateListener(o),r.removeMessageListener(t.namespace,s)),(r=e)&&(r.addUpdateListener(o),r.addMessageListener(t.namespace,s)))}}}),t.castSession=e,t};u.prototype=Object.create(i.prototype),u.prototype.sendCastMessage=function(e){var n=r.defer(),t=this;return t.castSession.sendMessage(t.namespace,e,function(){n.resolve()},function(e){n.reject(new s(s.ERRORS.MESSAGING_ERROR,"Failed to send payload on cast channel. Error: "+e))}),n.promise},u.prototype.stop=function(){var e=r.defer();return this.castSession?(this.castSession.stop(e.resolve,e.reject),e.promise):r.reject()},n.exports=u},{"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"./castTargetSessionBase.js":52,q:5}],54:[function(e,n,t){var r=e("q"),o=e("../logging/logger.js"),i=e("../profiling/mdxProfiler.js"),s=e("../enums.js"),c=e("../configuration.js"),a=e("./castTargetSessionBase.js"),u=e("../mdxError.js"),d=function(e){var n=this;return n.channel&&n.channel.sendTextMessage.call(n.channel,JSON.stringify(e))?r.resolve():r.reject(new u(u.ERRORS.MESSAGING_ERROR,"Failed to send payload on cast channel: "+e))},l=function(){return a.call(this),Object.defineProperties(this,{channel:{enumerable:!1,writable:!0,value:null}}),this};l.prototype=Object.create(a.prototype),l.prototype.createDeviceConnection=function(e,n){var t,a=this,d=a.device,l=d.CAST_EVENTS,f=e&&e.newSubEvent(i.EVENTS.CAST_DEVICE_CONNECT),p=c.current.scheduler,v=s.discoveryStates,g=d.isGuestMode?a.guestModeDeviceConnectionTimeout:a.deviceConnectionTimeout,E=r.defer(),h=function(){d.discoveryState=v.AVAILABLE,E.resolve()},m=function(t){var r=t.error;o.error("CastTargetSessionV2.deviceFailedToConnect",t);var i=r instanceof NFGCKError&&r.code===r.Cancelled&&d.isGuestMode;a.end.call(a,!1,!1).then(a.cleanupCastConnection.bind(a)).finally(function(){i?(a.device.deviceMgr.disconnectWithLeave(),a.device.deviceMgr=null,E.reject(new u(u.ERRORS.CANCELLED,"Cancelled by user from guest mode connection dialog"))):n?E.reject(r):c.current.scheduler.delay(function(){a.createDeviceConnection.call(a,e,!0).done(E.resolve,E.reject)},1e3)})},y=function(e){d.deviceMgr&&(d.addEventListener(l.CONNECT,h),d.addEventListener(l.CONNECT_FAILED,m),e&&d.deviceMgr.connect(),t=p.repeat(function(){d.getConnectionState().success(function(e){!E.promise.isFulfilled()&&e.isConnected&&h()})},500,!1))},R=function(){var e=r.defer();return function n(){d.deviceMgr.connectionState(function(t){t===d.deviceMgr.ConnectionStateDisconnecting&&e.promise.isPending()?c.current.scheduler.delay(n,500):e.promise.isPending()?e.resolve():e.reject()})}(),e.promise.timeout(5e3)};return d.deviceMgr.connectionState(function(e){if(!d.deviceMgr)return void E.reject(new u(u.ERRORS.CONNECT_FAILED));switch(e){case d.deviceMgr.ConnectionStateConnected:d.discoveryState=v.AVAILABLE,E.resolve();break;case d.deviceMgr.ConnectionStateDisconnected:y(!0);break;case d.deviceMgr.ConnectionStateConnecting:y(!1);break;case d.deviceMgr.ConnectionStateDisconnecting:R().then(y(!0),function(){o.warn("CastTargetSessionV2.createDeviceConnection - Timed out waiting for a disconnection when state was CONNECTION_STATE_DISCONNECTING"),d.discoveryState=v.UNAVAILABLE,E.reject()})}}),E.promise.timeout(g,"Timed out attempting to create a device connection").finally(function(){t&&p.cancelRepeat(t),d.removeEventListener(l.CONNECT,h),d.removeEventListener(l.CONNECT_FAILED,m),f&&f.complete()})},l.prototype.createAppConnection=function(e,n,t){var a,d=this,l=d.device,f=l.CAST_EVENTS,p=n&&n.newSubEvent(i.EVENTS.CAST_DEVICE_CONNECT),v=s.launchStates,g=c.current.scheduler,E=r.defer(),h=function(e){l.launchState=v.LAUNCHED,d.sessionId=e.sessionId,E.resolve({launched:!0})},m=function r(i){var s=i.error,a=s instanceof NFGCKError;if(!a||s.code!==s.Cancelled)if(e&&o.error("CastTargetSessionV2.appSessionFailedToStart",s.code,s.getDescription()),l.launchState=v.NOT_LAUNCHED,a)switch(s.code){case s.ApplicationNotRunning:E.resolve({launched:!1});break;case s.Timeout:!t&&E.promise.isPending()?(l.removeEventListener(f.APP_CONNECT,h),l.removeEventListener(f.APP_CONNECT_FAILED,r),c.current.scheduler.delay(function(){d.createAppConnection.call(d,e,n,!0).done(E.resolve,E.reject)},1e3)):E.reject(new u(u.ERRORS.CONNECT_FAILED,s.toString()))}else E.reject(new u(u.ERRORS.CONNECT_FAILED,s.toString()))
},y=function(n){if(l.deviceMgr){var t=function(){if(l.addEventListener(f.APP_CONNECT,h),l.addEventListener(f.APP_CONNECT_FAILED,m),n){var t=l.discoveryComponent.config;l.deviceMgr||E.reject(new u(u.ERRORS.CONNECT_FAILED)),e?l.deviceMgr.launchApplication(t.appId):l.deviceMgr.joinApplication(t.appId)}a=g.repeat(function(){l.getConnectionState().success(function(e){e.isConnectedToApp&&l.deviceMgr.applicationSessionID(function(e){E.promise.isFulfilled()||h({sessionId:e})})})},500,!1)};e?t():c.current.scheduler.retry(function(){var e=r.defer();return l.deviceMgr.applicationMetadata(function(n){void 0===n.applicationID?e.reject():e.resolve(n)}),e.promise},500,4).tap(function(e){e&&e.applicationID===l.discoveryComponent.config.appId||!e&&!l.isGuestMode?t():(l.launchState=s.launchStates.NOT_LAUNCHED,E.reject(new u(u.ERRORS.APP_NOT_RUNNING)))}).done()}},R=function(){var e=r.defer();return function n(){l.deviceMgr.applicationConnectionState.call(l.deviceMgr,function(t){t===l.deviceMgr.ConnectionStateDisconnecting&&e.promise.isPending()?c.current.scheduler.delay(n,500):e.promise.isPending()?e.resolve():e.reject()})}(),e.promise.timeout(5e3)};return l.deviceMgr.applicationConnectionState.call(l.deviceMgr,function(e){switch(l.deviceMgr||E.reject(new u(u.ERRORS.CONNECT_FAILED)),e){case l.deviceMgr.ConnectionStateConnected:l.launchState=v.LAUNCHED,l.deviceMgr.applicationSessionID(function(e){d.sessionId=e,E.resolve({launched:!0})});break;case l.deviceMgr.ConnectionStateDisconnected:y(!0);break;case l.deviceMgr.ConnectionStateConnecting:y(!1);break;case l.deviceMgr.ConnectionStateDisconnecting:R().then(y(!0),function(){l.launchState=v.NOT_LAUNCHED,o.warn("CastTargetSessionV2.createAppConnection - Timed out waiting for a disconnection when state was CONNECTION_STATE_DISCONNECTING"),E.reject()})}}),E.promise.timeout(d.appConnectionTimeout,"Timed out attempting to create an app connection").finally(function(){a&&g.cancelRepeat(a),l.removeEventListener(f.APP_CONNECT,h),l.removeEventListener(f.APP_CONNECT_FAILED,m),p&&p.complete()})},l.prototype.sendCastMessage=function(e){var n=this,t=n.device;if(!t.deviceMgr)return r.reject(new u(u.ERRORS.NOT_CONNECTED));if(n.channel&&n.channel.isConnected)return d.call(n,e);n.channel&&(n.channel.expectedDisconnect=!0,t.deviceMgr&&t.deviceMgr.removeChannel(n.channel),n.channel=null);var o=r.defer(),i=!1,s=NFGCKCastChannel.jsInitWithNamespace;"function"!=typeof s&&(s=NFGCKCastChannel.initWithNamespace);var a=s(t.discoveryComponent.config.mdxNamespace,function(e){try{var t=new Date,r=JSON.parse(e);n.processMdxMessage.call(n,r,t)}catch(e){}},function(){i=!0,c.current.scheduler.async(function(){d.call(n,e).done(o.resolve,o.reject)})},function(){t.deviceMgr&&t.deviceMgr.removeChannel(a),n.channel&&!n.channel.expectedDisconnect&&(n.clearMsgQueues(),n.channel=null)});return a?(n.channel=a,n.device.deviceMgr.addChannel(n.channel,function(e){e||o.reject()}),o.promise):r.reject(new u(u.ERRORS.MESSAGING_ERROR,"Failed to create cast channel"))},l.prototype.dispose=function(){var e=this;return a.prototype.end.call(e,!1,!0).then(e.cleanupCastConnection.bind(e))},l.prototype.cleanupCastConnection=function(e){var n=this,t=n.device;return e?t.initDeviceManager():(t.deviceMgr&&n.channel&&(n.channel.expectedDisconnect=!0,t.deviceMgr.removeChannel(n.channel),n.channel=null),r.resolve())},n.exports=l},{"../configuration.js":7,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./castTargetSessionBase.js":52,q:5}],55:[function(e,n,t){var r=e("q"),o=e("../logging/logger.js"),i=e("../enums.js"),s=e("../httpFactory.js"),c=e("../configuration.js"),a=e("./msgBusFactory.js"),u=e("../profiling/mdxProfiler.js"),d=e("./ping.js"),l=e("./mdxTargetSession.js"),f=e("../mdxError.js"),p=function(e){var n=this;return n.msgBus?r.resolve():a.createMsgBus(e).then(function(e){n.msgBus=e,e.onMessage=n.processMdxMessage.bind(n)})},v=function(e,n){var t=r.defer(),a=this,d=a.device,l=n.newSubEvent(u.EVENTS.DIAL_CONNECT),f=function(){var n=d.EVENTS.LAUNCH_STATE_CHANGED,r=function(){d.launchState===i.launchStates.LAUNCHED&&(d.removeEventListener(n,r),t.resolve())};d.launchState=i.launchStates.PENDING,d.addEventListener(n,r),o.info("Launching target",d.friendlyName);var a=d.dialInfo.dialAppUrl;s.createHttpClient(c.current.platform).post(a,e),d.discoveryComponent.enablePostLaunchSearch.call(d.discoveryComponent)};if(d.mdxInfo.isAvailable)a.verifyTargetLaunched.call(a,d,d.dialInfo.isAvailable).done(function(){t.resolve()},f);else{if(!d.dialInfo.isAvailable){var p="Cannot launch on target - DIAL service not available";return o.info(p,d.friendlyName),r.reject(p)}f()}return t.promise.finally(function(){l.complete()})},g=function(e){l.call(this,e);var n=null;return Object.defineProperties(this,{msgBus:{enumerable:!1,get:function(){return n},set:function(e){n=e}},protocol:{enumerable:!1,get:function(){return n?n.protocol:"unknown://"}}}),this};g.prototype=Object.create(l.prototype),g.prototype.processMdxMessage=function(e,n){try{l.prototype.processMdxMessage.call(this,e,n)}catch(e){o.error("Message handling failed",e,e.stack)}},g.prototype.dispatchMessage=function(e){var n=this;return n.msgBus?n.msgBus.send(e):r.reject(new f(f.ERRORS.PROTOCOL_ERROR,"Msg bus not initialized"))},g.prototype.sendMdxMessage=function(e,n){var t=this;return t.msgBus?l.prototype.sendMdxMessage.call(t,e,n):r.reject(new f(f.ERRORS.PROTOCOL_ERROR,"Msg bus not initialized"))},g.prototype.sendSessionMessage=function(e){var n=this;return n.msgBus?l.prototype.sendSessionMessage.call(n,e):r.reject(new f(f.ERRORS.PROTOCOL_ERROR,"Msg bus not initialized"))},g.prototype.verifyTargetLaunched=function(e,n){if(n){var t=e.dialInfo.dialAppUrl;s.createHttpClient(c.current.platform).post(t,"")}return p.call(this,e).then(function(){return d.pingTarget.call(e.session,e).fail(function(){throw new f(f.ERRORS.APP_NOT_RUNNING)})})},g.prototype.handleTargetConnection=function(e,n,t,o){var s,c=this,a=c.device,u=i.connectIntents,d=e===u.LAUNCH||e===u.LAUNCH_AND_CONTROL,l=e===u.LAUNCH_AND_CONTROL,g=r.defer();if(d)s=v.call(c,n,t,!0).then(p.bind(c,a));else{if(!a.mdxInfo.isAvailable)return g.reject(new f(f.ERRORS.APP_NOT_RUNNING)),g;s=c.verifyTargetLaunched.call(c,a,!1)}return s.then(c.startSession.bind(c,l,o),function(e){return f.ERRORS.PROTOCOL_ERROR.isEqual(e)?r.reject(new f(f.ERRORS.CONNECT_FAILED,e.message)):r.reject(e)}).done(g.resolve,g.reject),g},n.exports=g},{"../configuration.js":7,"../enums.js":33,"../httpFactory.js":35,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./mdxTargetSession.js":59,"./msgBusFactory.js":60,"./ping.js":63,q:5}],56:[function(e,n,t){var r=e("../../builds/ld.js"),o=e("../logging/logger.js"),i=e("../enums.js"),s=e("../profiling/mdxProfiler.js"),c={},a=function(e){return"error"===e.action},u=function(e,n,t){t&&(t.id=s.EVENTS.ERROR);var a=parseInt(e.errorcode),u=r.find(i.errors,function(e){return a===e.code});return c[e.nonce]?c[e.nonce](u):(o.warn("Remote device reported an error",n.id,e),n.disconnectFromApp())},d=function(e,n){c[e]=n},l=function(e){delete c[e]};n.exports={canHandle:a,handleMsg:u,registerErrorHandler:d,clearErrorHandler:l}},{"../../builds/ld.js":1,"../enums.js":33,"../logging/logger.js":38,"../profiling/mdxProfiler.js":45}],57:[function(e,n,t){var r=e("q"),o=e("../logging/logger.js"),i=e("./mdxSession.js"),s=e("../mdxError.js"),c=function(e,n,t,r){i.call(this,e,r);var o=n;return Object.defineProperties(this,{protocol:{enumerable:!1,value:"http://"},senderId:{enumerable:!0,get:function(){return o},set:function(e){o=e}},senderGuid:{enumerable:!1,get:function(){return o.substr(o.indexOf(":")+1)}},opts:{enumerable:!1,value:r||{}}}),t&&(this.messageBus=t),this};c.prototype=Object.create(i.prototype),c.prototype.processMdxMessage=function(e,n){try{var t=this;i.prototype.processMdxMessage.call(t,e,n)}catch(e){o.error("MdxControllerSession.processMdxMessage - Message  handling failed",e,e.stack)}},c.prototype.dispatchMessage=function(e){o.trace("MdxControllerSession.dispatchMessage",e);try{return this.messageBus.send(e),r.resolve()}catch(e){return r.reject(e)}},c.fromExisting=function(e,n){return new c(e.mdxVersion,n,e.mdxUuid,null,e.controllerOps)},c.prototype.sendAppMessage=function(e,n){return this.opts.incomingOnly?r.reject(new s(s.ERRORS.MESSAGING_ERROR),"Dropping message to device - this session only supports incoming messages"):i.prototype.sendAppMessage.call(this,e,n)},n.exports=c},{"../logging/logger.js":38,"../mdxError.js":44,"./mdxSession.js":58,q:5}],58:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("../profiling/mdxProfiler.js"),c=e("./validation.js"),a=e("./pairing.js"),u=e("./appMessage.js"),d=e("./broadcast.js"),l=e("./ping.js"),f=e("./error.js"),p=e("../configuration.js"),v=e("./securityFactory.js"),g=e("./msgFactory.js"),E=e("../enums.js"),h=e("../discovery/discoveryUtils.js"),m=e("../mdxError.js"),y=1,R=[u,a,d,l,f],S=function(e,n,t,r,o){var c=this,a=c.device,u=r.newSubEvent(s.EVENTS.DISPATCH_MSG);c.dispatchMessage.call(c,n).tap(function(){u.complete()}).timeout(6100).tap(function(){r.complete(),p.current.scheduler.async(I.bind(c))}).done(function(){o.resolve(t)},function(e){i.warn("Failed to dispatch message. Error: "+e,t),s.newMarker(s.EVENTS.DROPPED,a.id),o.reject(e)})},I=function e(){var n=this,t=n.device,r=n.sendQueue;if(r.processTimeout&&(p.current.scheduler.cancelDelay(r.processTimeout),r.processTimeout=null),!r.length)return void(r.isProcessing=null);r.processTimeout=p.current.scheduler.delay(function(){i.error("Outgoing message queue stalled",t.id,t.friendlyName),e.call(n)},1e4);var o=r.shift();t&&t.session||e.call(n);var a=o.msgData,u=a.body,d=l.canHandle(u)?u.id:u.nonce,f=d||n.createMsgNonce(),h=o.profilerEvent,y=function(e,t){var i=h.newSubEvent(s.EVENTS.PAIRIFY),a=c.processOutgoingMessage(t);i.complete(),S.call(n,r,{url:"/"+e,body:a},f,h,o.deferred)};if(o.isSessionMsg){var R=c.processOutgoingMessage(a.body);a.body=g.sessionMsgEnv(f,t,"1.0",R);var I=function(){n.context.processOutgoingSessionMsg(a.body,h).done(function(e){y.call(n,a.cmd,e)},function(e){m.ERRORS.CRYPTO_ERROR.isEqual(e)&&n.device.clearPairing(),o.deferred.reject()})};if(n.context)I();else if(t.sharedSecret){var A=h.newSubEvent(s.EVENTS.CREATE_CTX),T=v.createSecurityProvider(p.current.platform),N="Failed to create session context when processing outgoing message. Message will be dropped";T.beginContext(t.sharedSecret).finally(function(){A.complete()}).done(function(e){e||i.warn(N,a),n.context=e,I()},function(e){i.warn(N,e,a)})}else n.sendMdxMessage(g.error(f,t,E.errors.SESSION_INVALID_HMAC),"session"),p.current.scheduler.async(e.bind(n))}else y.call(n,a.cmd,a.body)},A=function(e,n,t,r,o,c){if(e.length>50)return i.error(c+"queue overflow. Dropping msg"),s.newMarker(s.EVENTS.DROPPED,r.id),void o.complete();e.push(n);var a=new Date-e.isProcessing;if(e.isProcessing){if(e.length>1||a<1e4)return;1===e.length&&a>1e4&&i.error("Stale queue.isProcessing flag detected",n)}e.isProcessing=new Date,t.call(r.session)},T=function(e,n){var t=this,o=t.device,i=r.defer(),c=e.cmd.toUpperCase(),a=s.EVENTS[c]||s.EVENTS.UNKNOWN,u=s.newEvent(a),d={msgData:e,profilerEvent:u,deferred:i,isSessionMsg:n};return A(t.sendQueue,d,I,o,u,"receive"),i.promise},N=function e(){var n=this,t=n.device,r=n.receiveQueue;if(r.processTimeout&&(p.current.scheduler.cancelDelay(r.processTimeout),r.processTimeout=null),!r.length)return void(r.isProcessing=null);r.processTimeout=p.current.scheduler.delay(function(){i.error("Receive message queue stalled",t.id,t.friendlyName),e.call(n)},1e4),r.processTimeout;var c=r.shift(),a=c.msg,u=(l.canHandle(a)?a.id:a.nonce,c.profilerEvent),d=c.queueStart;if(u.newSubEvent(s.EVENTS.QUEUED,d).complete(),(new Date).valueOf()-d>3e4)return i.error("Dropping msg. Queue timeout",a),s.newMarker(s.EVENTS.DROPPED,t.id),void p.current.scheduler.async(e.bind(n));var f=function(t){i.error("Exception when handling incoming message",a,t,t.stack),p.current.scheduler.async(e.bind(n))};try{if(!o.any(R,function(r){if(r.canHandle(a)){try{r.handleMsg.call(n,a,t,u).then(function(e){e&&(i.trace("Message handling complete. Forwarding on payload",e),t.onAppMessage(e))},function(e){i.warn("MdxSession.processReceivedQueue - Message handling failed",a,e,e.stack)}).finally(function(){u.complete(),p.current.scheduler.async(e.bind(n))})}catch(e){f(e)}return!0}return!1}))return s.newMarker(s.EVENTS.DROPPED,t.id),void p.current.scheduler.async(e.bind(n))}catch(e){f(e)}},O=function(e){var n=this;if(e.device===n.device){var t=Number(e.payload.duration);if(t<1)return void i.error("Invalid duration received for target restart. Will not track it",e.payload.duration);var r=n.deviceRestartTracker||(n.deviceRestartTracker={});r.promise=n.device.trackRestart(t),r.cb&&r.cb(r)}},j=function(e,n){var t=this,r=null,o=null;return Object.defineProperties(t,{receiveQueue:{enumerable:!1,writable:!1,value:[]},sendQueue:{enumerable:!1,writable:!1,value:[]},mdxVersion:{enumerable:!0,writable:!0,value:e},mdxSessionId:{enumerable:!0,writable:!0,value:null},device:{enumerable:!1,get:function(){return r},set:function(e){r=e}},extendedOpts:{enumerable:!0,value:n},errMsgCount:{enumerable:!1,writable:!0,value:0},fromUrl:{enumerable:!1,get:function(){return o||(o=t.protocol+h.getLocalIpAddress()+":"+p.current.localMdxPort),o},set:function(e){o=e}}}),t};j.prototype.createMsgNonce=function(){var e;return e="undefined"!=typeof nrdp&&o.isFunction(nrdp.now)?nrdp.now():(new Date).valueOf(),e<=y&&(e=y+1),y=e,e},j.prototype.processMdxMessage=function(e,n){try{var t=this,r=t.device;r.lastSeen=(new Date).valueOf();var o=s.newEvent(s.EVENTS.UNKNOWN_MSG,r.id,n),a=o.newSubEvent(s.EVENTS.VALIDATE_MSG),u=c.parseAndValidateMsg(e.body),d=l.canHandle(u)?u.id:u.nonce;if(!u){s.newMarker(s.EVENTS.DROPPED,r.id,n);var f=u?E.errors.SESSION_INVALID_NONCE:E.errors.SESSION_MALFORMED_MESSAGE;return void t.sendMdxMessage(g.error(d,r,f),"session")}a.complete();var p={msg:u,device:r,profilerEvent:o,queueStart:new Date};A(t.receiveQueue,p,N,r,o,"send")}catch(e){i.error("MdxSession.processMdxMessage - Message handling failed",e,e.stack)}},j.prototype.sendMdxMessage=function(e,n){var t=this,r=(t.device,n||e.action);return T.call(t,{cmd:r,body:e},!1)},j.prototype.sendSessionMessage=function(e){return T.call(this,{cmd:"session",body:e},!0)},j.prototype.sendAppMessage=function(e,n){var t=this,o=t.device;if("targetrestarting"===e){var s={action:"broadcast",nonce:t.createMsgNonce(),fromuuid:p.current.mdxUuid,fromurl:t.fromUrl,messageType:"targetrestarting",payload:n};return i.trace("MdxSession.sendMdxMessage",e,n,o.id,o.friendlyName),t.sendMdxMessage(s,"broadcast")}if(!t.mdxSessionId||t.disconnectDeferred){var c="Dropping message for this session as we don't have a valid session id or are in the process of disconnecting";return r.reject(new m(m.ERRORS.NOT_CONNECTED,c))}return t.sendSessionMessage(g.customAppMsg(t.mdxSessionId,e,n))},j.prototype.processEncryptedMessage=function(e,n){var t=r.defer(),o=this,c=o.device,a=o.context;if(a)return a.processEncryptedMessage(e,n);if(!c.sharedSecret){if(p.current.platform.role===E.roles.TARGET){i.warn("We don't have a pairing context to support message decryption");var u=l.canHandle(e)?e.id:e.nonce;o.sendMdxMessage(g.error(u,c,E.errors.SESSION_INVALID_HMAC),"session")}else s.newMarker(s.EVENTS.DROPPED);return r.reject(new m(m.ERRORS.MESSAGING_ERROR,"No shared secret"))}var d=n.newSubEvent(s.EVENTS.CREATE_CTX);return v.createSecurityProvider(p.current.platform).beginContext(c.sharedSecret).finally(function(){d.complete()}).done(function(r){r||t.reject(new m(m.ERRORS.MESSAGING_ERROR,"beginContext failed")),o.context=r,o.processEncryptedMessage(e,n).done(t.resolve,t.reject)},t.reject),t.promise},j.prototype.clearMsgQueues=function(){o.forEach([this.sendQueue,this.receiveQueue],function(e){for(e.processTimeout&&(p.current.scheduler.cancelDelay(e.processTimeout),e.processTimeout=null);e.length;)e.pop();e.isProcessing=null})},j.prototype.end=function(e,n,t){var o=this,i=r.defer(),s=n&&null!==o.mdxSessionId&&void 0!==o.mdxSessionId,c=function(){return o.clearMsgQueues(),t?o.sendSessionMessage(g.endSessionAck(o.mdxSessionId)):r.resolve()},a=function(){o.mdxSessionId=null,o.context&&(o.context.end(),delete o.context,o.errMsgCount=0),o.fromUrl=null,s&&o.device.onAppConnectionEnded(),o.disconnectDeferred&&(o.disconnectDeferred=null),i.resolve()},d=function(){var e=r.defer(),n=function(n){n.session===o&&n.msg.sessionId===o.mdxSessionId&&e.resolve()};return o.supportsEndAck?(u.addMessageListener(u.events.endSessionAck,n),e.promise.timeout(5e3).tap(u.removeMessageListener.bind(u,u.events.endSessionAck,n))):r.resolve()};return e?(o.disconnectDeferred=i,o.sendSessionMessage(g.endSession(o.mdxSessionId)).then(d).tap(c).finally(a)):c().finally(a),i.promise},j.prototype.startSession=function(e,n){var t=this,o=t.device,i=r.defer(),s=function(o){return o.code===E.errors.SESSION_INVALID_HMAC.code||o.code===E.errors.SESSION_UNKNOWN_SENDER.code?(t.device.clearPairing(),t.startSession(e,n)):r.reject(o)},c=O.bind(t);return e&&o.registrationMode===E.registrationModes.DARWIN_XPROFILE_V1&&d.addMessageListener("targetrestarting",c),o.sharedSecret&&p.current.currentMdxId?u.startSession.call(t,o).fail(s).done(i.resolve,i.reject):a.pairWithTarget.call(t,o,e,n).then(t.handleCrossProfileRegpairSupport.bind(t)).then(u.startSession.bind(t,o)).fail(s).done(i.resolve,i.reject),i.promise.finally(function(){e&&o.registrationMode===E.registrationModes.DARWIN_XPROFILE_V1&&(d.removeMessageListener("targetrestarting",c),delete t.targetRestartTracker)})},j.prototype.handleCrossProfileRegpairSupport=function(e){var n=this,t=n.device;if(!e.wasRegPair||t.registrationMode!==E.registrationModes.DARWIN_XPROFILE_V1)return r.resolve();var o=r.defer(),i=new m(m.ERRORS.CANNOT_PAIR,"Did not detect a successful target restart so the pairing is aborted");if(n.deviceRestartTracker)n.deviceRestartTracker.promise.done(o.resolve,o.reject.bind(o,i));else{var s=r.defer();n.deviceRestartTracker={cb:s.resolve},s.promise.timeout(5e3).then(function(e){e.promise.done(o.resolve,o.reject.bind(o,i))}).fail(o.reject.bind(o,new m(m.ERRORS.CANNOT_PAIR,"The target device did not notify the controller that is was restarting within the timeout period so the pair request is aborted")))}return o.promise.finally(function(){n.deviceRestartTracker=null})},n.exports=j},{"../../builds/ld.js":1,"../configuration.js":7,"../discovery/discoveryUtils.js":31,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./appMessage.js":49,"./broadcast.js":50,"./error.js":56,"./msgFactory.js":61,"./pairing.js":62,"./ping.js":63,"./securityFactory.js":65,"./validation.js":66,q:5}],59:[function(e,n,t){var r=e("q"),o=(e("../../builds/ld.js"),e("../logging/logger.js"),e("../enums.js")),i=e("./mdxSession.js"),s=e("../versionInfo.js"),c=e("../mdxError.js"),a={},u=function(){return i.call(this,new s),this};u.prototype=Object.create(i.prototype),u.prototype.connectToTarget=function(e,n,t,i){var s=this,u=s.device;if(s.mdxSessionId&&!s.disconnectDeferred)return r.resolve();var d=a[u.id];if(d){var l=r.defer();return d.deferred.promise.done(function(){s.mdxSessionId?l.resolve():s.connectToTarget.call(s,e,n,t,i).done(l.resolve,l.reject)},function(r){if(r)if(c.ERRORS.CANCELLED.isEqual(r))l.reject(new c(c.ERRORS.CANCELLED,"Pending connection cancelled"));else if("ETIMEDOUT"===r.code)return void s.connectToTarget.call(s,e,n,t,i).done(l.resolve,l.reject);d.intent>=e?l.reject(r):d.intent===o.connectIntents.JOIN?s.connectToTarget.call(s,e,n,t,i).done(l.resolve,l.reject):d.intent===o.connectIntents.LAUNCH&&c.ERRORS.USER_MISMATCH.isEqual(r)?s.connectToTarget.call(s,e,n,t,!0).done(l.resolve,l.reject):s.connectToTarget.call(s,e,n,t,i).done(l.resolve,l.reject)}),l.promise}var f;return s.disconnectDeferred?(f=r.defer(),s.disconnectDeferred.promise.then(function(){if(f.promise.isPending()){var r=s.handleTargetConnection(e,n,t,i);a[u.id].deferred=r,r.promise.done(f.resolve,f.reject)}})):f=s.handleTargetConnection.apply(s,arguments),f.promise.finally(function(){delete a[u.id]}),a[u.id]={deferred:f,intent:e},f.promise},u.prototype.cancelPendingConnections=function(){var e=this,n=a[e.device.id];n&&(n.deferred.reject(new c(c.ERRORS.CANCELLED,"Pending connection cancelled by MDX")),e.dispose&&e.dispose())},n.exports=u},{"../../builds/ld.js":1,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../versionInfo.js":74,"./mdxSession.js":58,q:5}],60:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("../configuration.js"),c=e("../webSocketFactory.js"),a=e("../httpFactory.js"),u=e("../enums.js"),d=e("../mdxError.js"),l=e("../devices/mdxTarget.js"),f=/v=(.*)\r\npath=(.*)\r\nxid=(.*)\r\n/,p=1,v=function(){return p++},g=function(){Object.defineProperties(this,{protocol:{enumerable:!1,writable:!0,value:"unknown://"}})},E=function(e){g.call(this);var n=this,t=e,o={};n.protocol="ws://",t.onmessage=function(e){var t,r=f.exec(e);if(r&&(t={version:r[1],path:r[2],xid:r[3],body:e.substr(e.indexOf("body=")+5)}),"response"===t.path){var i=o[t.xid];if(i){-1!==t.body.indexOf("error")?i.reject(t):i.resolve()}}else if(t){var c="status=ok";s.current.platform.role===u.roles.controller&&(c="body="+c),n.send({url:"response",body:c,reqId:t.xid}),n.onMessage&&n.onMessage(t)}},this.send=function(e){try{var n=e.url;n&&-1!==n.lastIndexOf("/",0)&&(n=n.substr(1));var i=e.reqId||v(),s=["v=1","path="+n,"xid="+i,"body="+e.body].join("\r\n"),c=r.defer();return o[i]=c,r(t.send(s)).fail(c.reject),c.promise.timeout(6e3)}catch(e){return r.reject(e)}}},h={enabled:!0,isCompatible:function(e){var n=e.mdxInfo.capabilities;return-1!==n.indexOf("websocket")&&-1!==n.indexOf("websocketclient")},createMsgBus:function(e){var n=r.defer(),t="ws://"+e.mdxInfo.ipAddressAndPort,o=c.createWebSocket(s.current.platform,t,!0),i=function(){o.onopen=null,n.resolve(new E(o))},a=function(e){o.onerror=null,n.reject(e)};return o.onopen=i,o.onError=a,n.promise}},m=function(e){g.call(this);var n=this,t=a.createHttpClient(s.current.platform),o="http://"+e.mdxInfo.ipAddressAndPort;if(n.protocol="http://",e instanceof l){i.info("HttpMsgBus target is instance of target");var c=function(e){e&&n.onMessage&&n.onMessage(e)};nrdp.mdx.addEventListener("incomingmessage",c)}this.send=function(e){try{return t.post(o+e.url,e.body).timeout(6e3)}catch(e){return r.reject(e)}}},y={enabled:!0,isCompatible:function(e){return-1!==e.mdxInfo.capabilities.indexOf("http")},createMsgBus:function(e){var n=new m(e);return r.resolve(n)}};n.exports={protocols:{ws:h,http:y},configureProtocolsForPlatform:function(e){var n=this.protocols;switch(e.id){case 2:case 6:n.ws.enabled=!o.isUndefined(nrdp.mdx&&nrdp.mdx.SendWebSocketMessage)&&!o.isUndefined(nrdp.websocket);break;case 3:case 8:n.ws.enabled=!1;break;case 4:case 5:n.http.enabled=!1;break;default:throw new d(d.ERRORS.PLATFORM_SUPPORT_ERROR,"Cannot configure msg bus protocols for platform: "+e)}},createMsgBus:function(e){var n=this.protocols,t=o.find(n,function(n){return n.enabled&&n.isCompatible(e)?n:null});if(!t){if(e.mdxInfo.isAvailable){var s=o.reduce(n,function(e,n,t){return n.enabled?e+t+"|":e},"");s="^("+s.substr(0,s.length-1)+")";var c=new RegExp(s),a=c.exec(e.mdxInfo.location);a&&n[a[1]]&&(t=n[a[1]])}if(!t){var u="No compatible protocol found";return i.error(u,n,e,e.mdxInfo),r.reject(new d(d.ERRORS.PROTOCOL_ERROR,u))}}return t.createMsgBus(e).timeout(3e3)}}},{"../../builds/ld.js":1,"../configuration.js":7,"../devices/mdxTarget.js":18,"../enums.js":33,"../httpFactory.js":35,"../logging/logger.js":38,"../mdxError.js":44,"../webSocketFactory.js":75,q:5}],61:[function(e,n,t){var r=e("../configuration.js"),o=e("nf-base64"),i=e("nf-utf8"),s=function(e,n,t){return{action:"error",nonce:e,fromuuid:r.current.mdxUuid,touuid:n.mdxUuid,errorcode:t.code,errorstring:t.desc}},c=function(e,n,t,o,i){return{action:"pairingrequest",version:e,controllerurl:n,nonce:t,controlleruuid:r.current.mdxUuid,pairdatahmac:o,cticket:i}},a=function(e,n,t,o,i){var s=r.current.mdxUuid;return{action:"pairingresponse",version:o,nonce:e,targetuuid:s,errorcode:t.code,errorstring:t.desc,targetuserid:i?n.mdxIdPairs[i]:s}},u=function(e,n,t,o,i,s,c){var a=r.current.mdxUuid;return{action:"pairingresponse",version:t,controllersharedsecret:o,nonce:e,controlleruuid:n.mdxUuid,targetuuid:a,controlleruserid:i,targetuserid:s||a,grantdatahmac:c}},d=function(e,n,t,o,i,s,c){var a={action:"regpairrequest",version:e,controllerurl:n,nonce:t,controlleruuid:r.current.mdxUuid,hmac:o,cticket:i,pin:s};return c&&(a.pairdatahmac=c),a},l=function(e,n,t,o){return{action:"regpairerror",version:o,nonce:e,targetuuid:r.current.mdxUuid,errorcode:t.code,errorstring:t.desc}},f=function(e,n,t,o,i){return{action:"regpairreply",version:n,controllersharedsecret:t,nonce:e,targetuuid:r.current.mdxUuid,userid:o,grantdatahmac:i}},p=function(e,n,t,o){var i=r.current.mdxUuid;return{action:"session",version:t,fromurl:n.session.fromUrl,fromuuid:i,fromuserid:r.current.currentMdxId,touuid:n.mdxUuid,touserid:n.currentMdxId||"",nonce:e,plaintext:o}},v=function(){return{sessionAction:"createSession"}},g=function(e){return{sessionAction:"startSessionResponse",sessionId:e,supportsEndAck:!0}},E=function(e){return{sessionAction:"endSession",sessionId:e,ack:!0}},h=function(e){return{sessionAction:"endSessionAck",sessionId:e}},m=function(e,n){return{sessionAction:"appMessage",sessionId:e,appAction:"HANDSHAKE_ACCEPTED",appBody:{accepted:r.current.mdxContractVersion==n,contractVersion:r.current.mdxContractVersion,volumeControl:!0===r.current.volumeControl,volumeStep:r.current.volumeStep}}},y=function(e,n,t){return{sessionAction:"appMessage",sessionId:e,appAction:n,appBody:t}},R=function(e,n,t){return{action:"pingsearch",fromuuid:r.current.mdxUuid,fromurl:n,servicetype:t,id:e}},S=function(e,n,t,s){return{action:"pingresponse",touuid:n.mdxUuid,fromuuid:r.current.mdxUuid,fromurl:t,responseheaders:r.current.responseHeaders,friendlyname:o.encode(i.encode(n.friendlyName||"")),servicetype:s,id:e}};n.exports={error:s,pairingRequest:c,pairingError:a,pairingSuccess:u,regPairRequest:d,regPairingError:l,regPairingSuccess:f,sessionMsgEnv:p,startSessionRequest:v,startSessionResponse:g,endSession:E,endSessionAck:h,handshakeAccepted:m,customAppMsg:y,pingRequest:R,pingResponse:S}},{"../configuration.js":7,"nf-base64":3,"nf-utf8":4}],62:[function(e,n,t){var r=e("q"),o=e("../../builds/ld.js"),i=e("../logging/logger.js"),s=e("../profiling/mdxProfiler.js"),c=e("./msgFactory.js"),a=e("../enums.js"),u=e("../configuration.js"),d=e("./regPairFactory.js"),l=e("../apiEvents.js"),f=e("./securityFactory.js"),p=e("../mdxError.js"),v=null,g={},E={},h=function(e,n,t){t&&(t.id=s.EVENTS.PAIRINGREQUEST);var o=this;o&&o.end(!!o.mdxSessionId);var l=e.version,f=e.nonce,p=a.errors;if("1.0"!==l)return i.error("Incorrect pairing request version. Expected 1.0 but got "+l),o.sendMdxMessage(c.error(f,n,p.PAIRING_UNKNOWN_VERSION)),s.newMarker(s.EVENTS.MDX_PAIRINGREJECTED),r.resolve();var E,h=d.createProvider(u.current.platform);h.isRegistered?v&&(i.warn("Cannot Pair - There is currently a regpair request inflight for another device."),E=p.REGISTRATION_PAIRING_IN_PROGRESS):(i.warn("Cannot Pair - Device is not registered"),E=p.PAIRING_NOT_PAIRING);var m=function(e){o.sendMdxMessage(c.pairingError(f,n,e,"1.0")),s.newMarker(s.EVENTS.MDX_PAIRINGREJECTED)};if(E)return m(E),r.resolve();var y=g[n.id];y&&y.deferred.reject(p.PAIRING_ABORTED);var R=r.defer();g[n.id]={device:n,deferred:R};var S=t.newSubEvent(s.EVENTS.SERVER_PAIR);return h.mdxPair.pair(e.cticket,e.controlleruuid,e.pairdatahmac,f,u.current.mdxUuid).timeout(15e3).finally(function(){S.complete()}).then(function(e){var t=e.controllerMdxId,r=e.targetMdxId;if(u.current.currentMdxId=r,t===r){var i=e.hmac;n.currentMdxId=t,n.sharedSecret=e.targetSharedSecret,o.sendMdxMessage(c.pairingSuccess(f,n,"1.0",e.controllerSharedSecret,t,r,i))}else m({code:"USER_MISMATCH",desc:"MDX UI: Target / controller user mismatch"})},function(e){if(e&&"ETIMEDOUT"===e.code)return i.error("The server pair request timed out",e),void m(p.PAIRING_NETWORK_ERROR);m(e)}).finally(function(){R.resolve()}).catch(function(){}),R.promise},m=function(e,n,t,o){var s=r.defer(),c=t.deferred;return t.context.hmac(o).then(function(r){if(e.grantdatahmac!==r){var o="Invalid hmac string in pairing response calculated: "+r+" received: "+e.grantdatahmac;return i.error(o),n.clearPairing(),c.resolve({isPaired:!1,retry:!0,error:new p(p.ERRORS.CRYPTO_ERROR)}),void s.resolve()}t.context.decrypt(e.controllersharedsecret).done(function(t){n.sharedSecret=t,n.isRegistered=!0,n.currentMdxId=e.targetuserid||e.userid,u.current.currentMdxId=e.controlleruserid||e.userid,c.resolve({isPaired:!0,wasRegPair:"regpairreply"===e.action}),s.resolve()},function(){c.reject(),s.resolve()})},function(e){c.reject(e),s.resolve()}),s.promise},y=function(e,n,t){t&&(t.id=s.EVENTS.PAIRINGRESPONSE);var o=E[e.nonce];if(!o)return i.error("Unexpected pairing response",e),r.resolve();var c=o.deferred,a=e.version;if("1.0"!==a){var u="Incorrect pairing response version. Expected 1.0 but got "+a;return i.error(u),c.reject(new p(p.ERRORS.CANNOT_PAIR,u)),r.resolve()}var d="controllersharedsecret="+encodeURIComponent(e.controllersharedsecret)+"&controlleruserid="+encodeURIComponent(e.controlleruserid)+"&controlleruuid="+encodeURIComponent(e.controlleruuid)+"&nonce="+encodeURIComponent(e.nonce)+"&targetuserid="+encodeURIComponent(e.targetuserid)+"&targetuuid="+encodeURIComponent(e.targetuuid);return m(e,n,o,d)},R=function(e,n){var t=this,o=r.defer(),s=t.createMsgNonce();return e.encrypt("00000").done(function(r){var a="action=regpairrequest&nonce="+encodeURIComponent(s)+"&pin="+encodeURIComponent(r);e.hmac(a).then(function(o){var i=function(e){return t.sendMdxMessage(c.regPairRequest("2.0",t.fromUrl,s,o,n,r,e))};if(t.device.isMsl){var a="controlleruuid="+encodeURIComponent(u.current.mdxUuid)+"&nonce="+encodeURIComponent(s);return e.hmac(a).then(function(e){return i(e)})}return i()}).done(function(n){E[n]={deferred:o,context:e}},function(){i.error("Failed to hmac sign the regpair payload"),t.device.clearPairing(),o.reject(new p(p.ERRORS.CRYPTO_ERROR))})},function(){i.error("Failed to encrypt the regpair pin"),t.device.clearPairing(),o.reject(new p(p.ERRORS.CRYPTO_ERROR))}),o.promise.timeout(15e3).finally(function(){delete E[s]})},S=function(e,n,t,o){var i=this,s=a.errors;"USER_MISMATCH"===e.errorcode?e.errorcode=s.PAIRING_USER_MISMATCH.code:"PROFILE_MISMATCH"===e.errorcode?e.errorcode=s.REGISTRATION_PROFILE_MISMATCH.code:e.errorcode=parseInt(e.errorcode);var c,d=t.deferred;switch(e.errorcode){case s.PAIRING_UNKNOWN_VERSION.code:c="Pair failed with PAIRING_UNKNOWN_VERSION",n.blacklist(c),d.reject(new p(p.ERRORS.CANNOT_PAIR,c));break;case s.PAIRING_INVALID_CONTROLLER_REQUEST.code:case s.PAIRING_SERVER_ERROR.code:case s.PAIRING_TARGET_ERROR.code:case s.PAIRING_SERVER_NOT_REACHABLE.code:case s.PAIRING_ABORTED.code:case s.PAIRING_CONTROLLER_HMAC_FAILURE.code:d.resolve({isPaired:!1,retry:!0});break;case s.PAIRING_CONTROLLER_CTICKET_EXPIRED.code:case s.PAIRING_CONTROLLER_CTICKET_CORRUPTED.code:case s.PAIRING_NO_CTICKET.code:c="CTICKET issue with pairing: "+e.errorstring,d.reject(new p(p.ERRORS.INVALID_CTICKET));break;case s.PAIRING_NOT_PAIRING.code:case s.PAIRING_USER_MISMATCH.code:o?d.reject(new p(p.ERRORS.CANNOT_PAIR,e.errorcode+" - "+e.errorstring)):t.activate&&n.registrationMode!==a.registrationModes.DISABLED?f.createSecurityProvider(u.current.platform).getCTicket().then(function(e){if(!e)return void d.reject(new p(p.ERRORS.INVALID_CTICKET));R.call(i,t.context,e).done(d.resolve,d.reject)}):d.resolve({isPaired:!1,retry:!1,canActivate:n.registrationMode!==a.registrationModes.DISABLED});break;case s.REGISTRATION_PROFILE_MISMATCH.code:d.resolve({isPaired:!1,retry:!1,canActivate:!1});break;default:d.reject(new p(p.ERRORS.CANNOT_PAIR,e.errorcode+" - "+e.errorstring))
}return r.resolve()},I=function(e,n,t){t&&(t.id=s.EVENTS.PAIRING_ERROR_RESPONSE);var o=E[e.nonce];return o?S.call(this,e,n,o,!1):(i.error("Unexpected pairing response",e),r.resolve())},A=function(){var e=r.defer();return o.forEach(u.current.dscMgr.devices,function(e){e.clearPairing()}),u.current.storage.clearPairings().finally(e.resolve),e.promise},T=function(e,n,t){t&&(t.id=s.EVENTS.REGPAIRREQUEST);var o=this;o&&o.end(!!o.mdxSessionId);var f=e.version,p=e.nonce,g=a.errors;if("2.0"!==f)return i.error("Incorrect reg pairing request version. Expected 2.0 but got "+f),o.sendMdxMessage(c.error(p,n,g.PAIRING_UNKNOWN_VERSION)),s.newMarker(s.EVENTS.MDX_PAIRINGREJECTED),r.resolve();var E,h=d.createProvider(u.current.platform),m=a.registrationModes,y=u.current.registrationMode;y!==m.ENABLED&&y!==m.DEFAULT_PIN&&y!==m.DARWIN_XPROFILE_V1?(i.warn("Regpair request rejected as registration mode is "+y),E=g.REGISTRATION_NOT_REGISTERING):v&&v.device.id!==n.id&&(i.warn("Cannot Pair - There is currently a regpair request inflight for another device."),E=g.REGISTRATION_PAIRING_IN_PROGRESS);var R=function(e){o.sendMdxMessage(c.regPairingError(p,n,e||g.PAIRING_NETWORK_ERROR,"2.0")),s.newMarker(s.EVENTS.MDX_PAIRINGREJECTED)};if(E)return R(E),r.resolve();v&&v.deferred.reject(g.PAIRING_ABORTED);var S=r.defer();v={device:n,deferred:S};var I=t.newSubEvent(s.EVENTS.SERVER_NFLXID);return h.mdxActivate(u.current.mdxUuid,e.cticket,p,e.pin,u.current.pairingPin,e.controlleruuid,e.hmac,e.pairdatahmac).timeout(15e3).finally(function(){I.complete()}).then(function(e){var t=r.defer(),s={device:n,cookies:e.cookies,guid:e.guid,resolve:t.resolve,reject:t.reject};n.evtMgr.fireEvent(l.SWITCH_CREDENTIALS,s),t.promise.finally(function(){return A.call(o)}).done(function(t){t&&(u.current.profileId=t.profileId||null);var r=e.hmac,s=e.controllerMdxId;n.currentMdxId=s,n.sharedSecret=e.targetSharedSecret,u.current.currentMdxId=e.targetMdxId,i.info("Sending regpair response to controller",n.id,n.friendlyName);var a=function(){},d=t&&t.cb||a;o.sendMdxMessage(c.regPairingSuccess(p,"2.0",e.controllerSharedSecret,s,r)).then(d())},function(e){i.warn("UI rejected credential switch or failed to handle it",e),R(g.PAIRING_ABORTED)})},function(e){if(e&&"ETIMEDOUT"===e.code)return i.error("The server reg pair request timed out",e),void R(g.PAIRING_NETWORK_ERROR);R(e)}).finally(function(){v=null,S.resolve()}).catch(function(){}),S.promise},N=function(e,n,t){t&&(t.id=s.EVENTS.REGPAIRRESPONSE);var o=E[e.nonce];if(!o)return i.error("Unexpected pairing response",e),r.resolve();var c=e.version;if("2.0"!==c){var a="Incorrect regppair response version. Expected 2.0 but got "+c;return i.error(a),o.deferred.reject(new p(p.ERRORS.CANNOT_PAIR,a)),r.resolve()}var d;return d=n.isMsl?"controllersharedsecret="+encodeURIComponent(e.controllersharedsecret)+"&controlleruserid="+encodeURIComponent(e.userid)+"&controlleruuid="+encodeURIComponent(u.current.mdxUuid)+"&nonce="+encodeURIComponent(e.nonce)+"&targetuserid="+encodeURIComponent(e.userid)+"&targetuuid="+encodeURIComponent(e.targetuuid):"action=regpairreply&controllersharedsecret="+encodeURIComponent(e.controllersharedsecret)+"&nonce="+encodeURIComponent(e.nonce)+"&userid="+encodeURIComponent(e.userid),m(e,n,o,d)},O=function(e,n,t){t&&(t.id=s.EVENTS.REGPAIR_ERROR_RESPONSE);var o=E[e.nonce];return o?S.call(this,e,n,o,!0):(i.error("Unexpected pairing response",e),r.resolve())},j={pairingrequest:h,pairingresponse:y,pairingresponseError:I,regpairrequest:T,regpairreply:N,regpairerror:O},C=function(e){return j.hasOwnProperty(e.action)},D=function(e,n,t){return j[e.action].call(this,e,n,t).finally(function(){u.current.storage.storeDeviceMap(u.current.dscMgr.devices)})},b=function e(n,t,o){n.sharedSecret&&n.clearPairing();var i=function(e){if(E[e]){var n=E[e].context;n&&n.end()}delete E[e]},s=r.defer(),a=this,d=a.createMsgNonce(),l=f.createSecurityProvider(u.current.platform);return l.getCTicket().then(function(f){if(!f)return void s.reject(new p(p.ERRORS.INVALID_CTICKET));l.beginContext().done(function(l){if(o)R.call(a,l,f).done(s.resolve,s.reject);else{var v="controlleruuid="+encodeURIComponent(u.current.mdxUuid)+"&nonce="+encodeURIComponent(d);l.hmac(v).then(function(o){return a.sendMdxMessage(c.pairingRequest("1.0",a.fromUrl,d,o,f)).then(function(){var o=r.defer();E[d]={deferred:o,activate:t,context:l,cticket:f},o.promise.fail(function(e){s.reject(e)}),o.promise.done(function(r){r.isPaired&&!r.isError?s.resolve({wasRegPair:r.wasRegPair}):r.error?s.reject(r.error):r.retry?(i(d),e.call(a,n,t).done(s.resolve,s.reject)):r.canActivate?s.reject(new p(p.ERRORS.USER_MISMATCH)):s.reject(new p(p.ERRORS.REGISTRATION_NOT_SUPPORTED))})})})}}).fail(function(){s.reject(new p(p.ERRORS.CONNECT_FAILED,"Failed to create the encryption context"))})},function(){s.reject(new p(p.ERRORS.INVALID_CTICKET))}),s.promise.timeout(3e4,"Timed out waiting for pairing response").fail(function(e){return"ETIMEDOUT"===e.code?r.reject(new p(p.ERRORS.CONNECT_FAILED,"Pair response timeout")):r.reject(e)}).finally(i.bind(null,d))};n.exports={canHandle:C,handleMsg:D,clearAllPairings:A,pairWithTarget:b}},{"../../builds/ld.js":1,"../apiEvents.js":6,"../configuration.js":7,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./msgFactory.js":61,"./regPairFactory.js":64,"./securityFactory.js":65,q:5}],63:[function(e,n,t){var r=e("q"),o=(e("../logging/logger.js"),e("./msgFactory.js")),i=e("../profiling/mdxProfiler.js"),s={},c=function(e,n,t){t&&(t.id=i.EVENTS.PINGREQUEST);var r=this;return r.sendMdxMessage(o.pingResponse(e.id,n,r.fromUrl,"urn:mdx-netflix-com:service:target:2"),"mdxping")},a=function(e,n,t){t&&(t.id=i.EVENTS.PINGRESPONSE);var o=s[e.id];return o&&o.resolve(),r.resolve()},u=function(e){return e&&e.action&&("pingsearch"===e.action||"pingresponse"===e.action)},d=function(e,n,t){return"pingsearch"===e.action?c.call(this,e,n,t):a.call(this,e,n,t)},l=function(e){var n=r.defer(),t=this,i=t.createMsgNonce();return t.sendMdxMessage(o.pingRequest(i,t.fromUrl,"urn:mdx-netflix-com:service:target"),"mdxping"),s[i]=n,n.promise.timeout(3e3).finally(function(){delete s[i]})};n.exports={canHandle:u,handleMsg:d,pingTarget:l}},{"../logging/logger.js":38,"../profiling/mdxProfiler.js":45,"./msgFactory.js":61,q:5}],64:[function(e,n,t){var r,o=e("q"),i=e("../../builds/ld.js"),s=(e("../logging/logger.js"),e("../enums.js")),c=e("../mdxError.js"),a=function(e,n,t,r){for(var o,c=i.isUndefined(nrdp)?"NETWORK_ERROR":nrdp.NETWORK_ERROR;r.length;){var a=r.pop();if(a.data&&a.data.controlleruuid){o=a.data,o.guid=a.guid;break}(i.isUndefined(o)||o.result!==c)&&a.actionID||a.errorcode?o=a:a.result===c&&(o=a)}if(t&&t(n),!o||o.result===c)return void e.reject(s.errors.PAIRING_SERVER_NOT_REACHABLE);if(o.actionID||o.errorcode){var u=i.find(s.errors,function(e){return e.code===o.errorcode})||s.errors.PAIRING_UNKNOWN_ERROR;return void e.reject(u)}var d={pairingContext:o.grantdatahmac||"",hmac:o.grantdatahmac,controllerMdxId:o.controlleruserid,controllerSharedSecret:o.controllersharedsecret,targetSharedSecret:o.targetsharedsecret,targetMdxId:o.targetuserid,guid:o.guid,cookies:o.cookies};e.resolve(d)},u=function(){var e=this;this.pair=function(n,t,r,i,s){var c=o.defer();return nrdp.mdxnccp.pair(n,t,r,i,s,a.bind(e,c,t,e.finish)),c.promise},this.abort=nrdp.mdxnccp.abort.bind(this),this.finish=nrdp.mdxnccp.finish.bind(this)},d=function(e){this.mdxPair=new e};Object.defineProperties(d.prototype,{isRegistered:{enumerable:!0,get:function(){return nrdp.registration.registered}},currentDeviceAccount:{enumerable:!0,get:function(){return nrdp.registration.currentDeviceAccount}}}),d.prototype.mdxActivateFinish=function(e){return nrdp.registration.mdxActivateFinish(e)};var l=function(){d.apply(this,arguments)};l.prototype=Object.create(d.prototype),l.prototype.mdxActivate=function(e,n,t,r,i,s,c,u){var d=this,l=o.defer();return nrdp.registration.mdxMslActivate(e,n,t,r,i,s,c,u,a.bind(d,l,s,d.mdxActivateFinish)),l.promise};var f=function(){d.apply(this,arguments)};f.prototype=Object.create(d.prototype),f.prototype.mdxActivate=function(e,n,t,r,i,s,c){var u=this,d=o.defer();return nrdp.registration.mdxActivate(e,n,t,r,i,s,c,a.bind(u,d,s,u.mdxActivateFinish)),d.promise};var p=function(){return new l(u)},v=function(){if(!i.isUndefined(nrdp)&&nrdp.device&&nrdp.device.SDKVersion){var e=i.isUndefined(nrdp.device.SDKVersion.components)?nrdp.device.SDKVersion:nrdp.device.SDKVersion.components.nrdlib,n=/([0-9]+).([0-9]+)/.exec(e),t=parseInt(n[1]),o=parseInt(n[2]||"0");if(t>2013||2013===t&&o>=3)return p()}return r||(r=new f(u))},g={2:v,3:p};n.exports={createProvider:function(e){var n=g[e.id];if(n)return n();throw new c(c.ERRORS.PLATFORM_SUPPORT_ERROR,"Cannot create registration provider for platform: "+e.name)}}},{"../../builds/ld.js":1,"../enums.js":33,"../logging/logger.js":38,"../mdxError.js":44,q:5}],65:[function(e,n,t){var r=e("q"),o=e("nf-base64"),i=e("nf-utf8"),s=e("../../builds/ld.js"),c=e("../profiling/mdxProfiler.js"),a=e("./validation.js"),u=e("../mdxError.js"),d=null,l=function(e){for(var n="",t=e instanceof ArrayBuffer?new Uint8Array(e):e,r=t.length,o=0;o<r;){var i=t[o++],s=i>>4;if(s<8)n+=String.fromCharCode(i);else if(s>=12&&s<=13){var c=t[o++];n+=String.fromCharCode((31&i)<<6|63&c)}else if(14===s){var a=t[o++],u=t[o++];n+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&u)<<0)}}return n},f=function(e){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return e;for(var n=new ArrayBuffer(3*e.length),t=new Uint8Array(n),r=0,o=e.length,i=0;i<o;i++){var s=e.charCodeAt(i);s>=1&&s<=127?t[r++]=s:s>2047?(t[r++]=224|s>>12&15,t[r++]=128|s>>6&63,t[r++]=128|s>>0&63):(t[r++]=192|s>>6&31,t[r++]=128|s>>0&63)}return t.subarray(0,r)},p=function(){var e=1;Object.defineProperties(this,{contexts:{enumerable:!0,writable:!1,value:{}},nextContextId:{enumerable:!0,get:function(){return e++}}})};p.prototype.processEncryptedMessage=function(e,n,t){var o=this;if(!o.contexts[e])return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=n.hmac;delete n.hmac;var s=r.defer(),d=t.newSubEvent(c.EVENTS.CANONICAL),l=a.canonicalForm(n);d.complete();var f=t.newSubEvent(c.EVENTS.HMAC);return o.hmac(e,l).finally(function(){f.complete()}).done(function(r){if(r!==i)return void s.reject(new u(u.ERRORS.CRYPTO_ERROR,"HMAC validation failed"));var a=t.newSubEvent(c.EVENTS.DECRYPT);o.decrypt(e,n.ciphertext).finally(function(){a.complete()}).done(function(e){if(!e)return void s.reject(new u(u.ERRORS.CRYPTO_ERROR,"Decryption failed"));s.resolve(e)},s.reject)},s.reject),s.promise},p.prototype.processOutgoingSessionMsg=function(e,n,t){var o=this;if(!o.contexts[e])return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));if(!n.plaintext)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"plaintext missing or empty"));var i=n.plaintext;delete n.plaintext;var s=r.defer(),d=t.newSubEvent(c.EVENTS.ENCRYPT);return o.encrypt(e,i).finally(function(){d.complete()}).done(function(r){if(!r)return void s.reject(new u(u.ERRORS.CRYPTO_ERROR,"Encryption failed"));n.ciphertext=r;var i=t.newSubEvent(c.EVENTS.CANONICAL),d=a.canonicalForm(n);i.complete();var l=t.newSubEvent(c.EVENTS.HMAC);o.hmac(e,d).finally(function(){l.complete()}).done(function(e){if(!e)return void s.reject(new u(u.ERRORS.CRYPTO_ERROR,"HMAC signing failed"));n.hmac=e,s.resolve(n)},s.reject)},s.reject),s.promise};var v=function(){p.call(this);var e,n=this,t={},c=function(n){var i=nrdjs.mslClient,s=i.getMslStore(),c=s.getMasterToken(),a=s.getUserIdToken(nrdp.registration.currentDeviceAccount),d=o.encode,p="";if(e=s.getCryptoContext(c),!c||!a)return void n({success:!1,cTicket:p});try{p=["1",d(f(JSON.stringify(c.toJSON()))),d(f(JSON.stringify(a.toJSON())))].join(",")}catch(e){throw new u(u.ERRORS.CRYPTO_ERROR,JSON.stringify(e))}t.hmac=function(n){var t=r.defer();return e.sign(f(n),{result:function(e){e?t.resolve(o.encode(e)):t.reject(new u(u.ERRORS.CRYPTO_ERROR,"msl hmac error"))},error:function(e){t.reject(new u(u.ERRORS.CRYPTO_ERROR,JSON.stringify(e)))}}),t.promise},t.end=function(){},t.decrypt=function(n){var t=r.defer();try{e.decrypt(f(o.decode(n)),{result:function(e){var n=l(e);t.resolve(n)},error:function(e){t.reject(new u(u.ERRORS.CRYPTO_ERROR,e||"msl decrypt error"))}})}catch(e){t.reject(new u(u.ERRORS.CRYPTO_ERROR,e||"msl decrypt exception"))}return t.promise},n({success:!0,cTicket:p,mslCryptoContext:t})};return this.getCTicket=function(){var e=r.defer();return c(function(n){if(!n.success)return r.reject(new u(u.ERRORS.INVALID_CTICKET));e.resolve(n.cTicket)}),e.promise},this.beginContext=function(e){var t=r.defer(),o=n.nextContextId++,s={encrypt:n.encrypt.bind(n,o),decrypt:n.decrypt.bind(n,o),hmac:n.hmac.bind(n,o),end:n.endContext.bind(n,o),processEncryptedMessage:n.processEncryptedMessage.bind(n,o),processOutgoingSessionMsg:n.processOutgoingSessionMsg.bind(n,o)};if(!e)return c(function(e){e.success?t.resolve(e.mslCryptoContext):t.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"))}),t.promise;var a="string"==typeof e?e:i.decode(e);return nrdp.mdx.beginContext(a,null,function(e){e&&e.context?(s.context=e.context,n.contexts[o]=s,t.resolve(s)):t.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"))}),t.promise},this.encrypt=function(e,t){if(!t||t.length>32766)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid data to encrypt"));var o=n.contexts[e];if(!o||!o.context)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=o.context,c=r.defer();try{nrdp.mdx.encrypt(i,t,function(e){s.isString(e)?e?c.resolve(e):c.reject(new u(u.ERRORS.CRYPTO_ERROR)):e.encrypted?c.resolve(e.data):c.reject(new u(u.ERRORS.CRYPTO_ERROR))})}catch(e){return r.reject(e)}return c.promise},this.decrypt=function(e,t){var o=n.contexts[e];if(!o||!o.context)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=o.context,s=r.defer();try{nrdp.mdx.decrypt(i,t,function(e){s.resolve(e)})}catch(e){return r.reject(e)}return s.promise},this.hmac=function(e,t){var o=n.contexts[e];if(!o||!o.context)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var s=o.context,c=r.defer(),a="string"==typeof t?i.encode(t):t;return nrdp.mdx.hmac(s,a,function(e){e?c.resolve(e):c.reject(new u(u.ERRORS.CRYPTO_ERROR,"msl hmac error"))}),c.promise},this.endContext=function(e){return delete n.contexts[e],r.resolve()},this};v.prototype=Object.create(p.prototype);var g=function(){p.call(this);var e=this;if(window.nfNewCrypto)d=window.nfNewCrypto;else{if(!window.crypto)throw new u(u.ERRORS.PLATFORM_SUPPORT_ERROR,"Failed to create Cast Target security provider. No crypto provider");d=window.crypto}return this.getCTicket=function(){throw new u(u.ERRORS.NOT_SUPPORTED)},this.beginContext=function(n){var t=o.decode(n);if(48!==t.length)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid shared secret"));var i,s,c=r.defer();return d.subtle.importKey("raw",t.subarray(32),{name:"AES-CBC"},!1,["encrypt","decrypt"]).then(function(e){if(!e)throw new Error("Import crypto keys failed");return i=e,d.subtle.importKey("raw",t.subarray(0,32),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"])}).then(function(n){if(!n)throw new Error("Import hmac keys failed");s=n;var t=e.nextContextId;e.contexts[t]={hmacKey:s,encryptionKey:i};var r={encrypt:e.encrypt.bind(e,t),decrypt:e.decrypt.bind(e,t),hmac:e.hmac.bind(e,t),end:e.endContext.bind(e,t),processEncryptedMessage:e.processEncryptedMessage.bind(e,t),processOutgoingSessionMsg:e.processOutgoingSessionMsg.bind(e,t)};c.resolve(r)}).catch(function(e){e=e||"Unknown failure",c.reject(e)}),c.promise},this.encrypt=function(n,t){if(!t||t.length>32766)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid data to encrypt"));var i=e.contexts[n];if(!i||!i.encryptionKey)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var s=r.defer(),c=d.getRandomValues(new Uint8Array(16));return d.subtle.encrypt({name:"AES-CBC",iv:c},i.encryptionKey,f(t)).then(function(e){if(!e||e.byteLength>32767)throw new Error("Encryption failure"+JSON.stringify(e));var n=new Uint8Array(e),t=new Uint8Array(18+function(e){return e<=127?1:e<=32767?2:-1}(n.length)+n.length);t[0]=2;var r=1,i=function(e){var n=e.length;if(n<=127)t[r++]=n;else{if(!(n<=32767))return!1;t[r++]=128|n>>8,t[r++]=255&n}return t.set(e,r),r+=n,!0};if(!i(c)||!i(n))throw new Error("Octet write failure");s.resolve(o.encode(t))}).catch(function(e){e=e||"Unknown failure",s.reject(e)}),s.promise},this.decrypt=function(n,t){var i=e.contexts[n];if(!i||!i.encryptionKey)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));if(!s.isString(t)||t.length>43717)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid decryption data"));if(t=o.decode(t),t.size<35||2!==t[0]||16!==t[1])return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid decryption data"));var c,a=18;if(t[a]<=127)c=t[a],++a;else{if(t.size<a+1)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid decryption data"));c=(127&t[a])<<8|255&t[a+1],a+=2}if(c%16)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid ciphertext length "+c+" not multiple of 16"));if(c+a!==t.length)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Unexpected Ciphertext Length "+c+" "+t.length+", Not Aligned With the End Of Envelope"));var f=r.defer();return d.subtle.decrypt({name:"AES-CBC",iv:t.subarray(2,18)},i.encryptionKey,t.subarray(a)).then(function(e){if(!e||e.byteLength>32767)throw new Error("Decryption error - payload too large");f.resolve(l(e))}).catch(function(e){e=e||"Unknown failure",f.reject(e)}),f.promise},this.hmac=function(n,t){var s=e.contexts[n];if(!s||!s.encryptionKey)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var c=r.defer();return d.subtle.sign({name:"HMAC",hash:{name:"SHA-256"}},s.hmacKey,i.encode(t)).then(function(e){if(!e||e.byteLength>32767)throw new Error("Invalid result",e?e.byteLength:-1);c.resolve(o.encode(new Uint8Array(e)))}).catch(function(e){e=e||"Unknown failure",c.reject(e)}),c.promise},this.endContext=function(n){return delete e.contexts[n],r.resolve()},this};g.prototype=Object.create(p.prototype);var E=function(){if(!d)throw new u(u.ERRORS.PLATFORM_SUPPORT_ERROR,"No crypto provider provided during start");p.call(this);var e=this;return this.getCTicket=function(){var e=r.defer();try{d.createCryptoContext(function(n){if(!n.success||!n.cryptoContext)throw new u(u.ERRORS.INVALID_CTICKET);e.resolve(n.cryptoContext.cTicket)})}catch(e){return r.reject(e)}return e.promise},this.beginContext=function(n){var t=r.defer();return(n?d.createCryptoContextFromSharedSecret.bind(null,n):d.createCryptoContext)(function(n){if(!n.success||!n.cryptoContext)throw new u(u.ERROR.CRYPTO_ERROR,"Invalid security context");var r=e.nextContextId++;e.contexts[r]=n.cryptoContext;var o={encrypt:e.encrypt.bind(e,r),decrypt:e.decrypt.bind(e,r),hmac:e.hmac.bind(e,r),end:e.endContext.bind(e,r),processEncryptedMessage:e.processEncryptedMessage.bind(e,r),processOutgoingSessionMsg:e.processOutgoingSessionMsg.bind(e,r)};t.resolve(o)}),t.promise},this.encrypt=function(n,t){var o=e.contexts[n];if(!o)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=r.defer();return o.encrypt(t,function(e){e.success?i.resolve(e.encryptedDataAsn1Base64||e.mslEncryptionEnvelopeBase64):i.reject(new u(u.ERRORS.CRYPTO_ERROR,"Encryption failed"))}),i.promise},this.decrypt=function(n,t){var o=e.contexts[n];if(!o)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=r.defer();return o.decrypt(t,function(e){e.success?i.resolve(e.text):i.reject(new u(u.ERRORS.CRYPTO_ERROR,"Decryption failed"))}),i.promise},this.hmac=function(n,t){var o=e.contexts[n];if(!o)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=r.defer();return o.hmac(t,function(e){e.success?i.resolve(e.hmacBase64):i.reject(new u(u.ERRORS.CRYPTO_ERROR,"HMAC failed"))}),i.promise},this.endContext=function(n){return delete e.contexts[n],r.resolve()},this};E.prototype=Object.create(p.prototype);var h=function(){p.call(this);var e=this;return this.getCTicket=function(){var e=r.defer();try{nrdp.ntba.getCticket(function(n){e.resolve(n.cticket)})}catch(e){return r.reject(e)}return e.promise},this.beginContext=function(n){var t,o=r.defer(),i=e.nextContextId++,c={encrypt:e.encrypt.bind(e,i),decrypt:e.decrypt.bind(e,i),hmac:e.hmac.bind(e,i),end:e.endContext.bind(e,i),processEncryptedMessage:e.processEncryptedMessage.bind(e,i),processOutgoingSessionMsg:e.processOutgoingSessionMsg.bind(e,i)};try{if(n){var a=s.isString(n)?n:l(n);nrdp.mdx.beginContext(a,null,function(n){t={context:n.context,scope:nrdp.mdx,encryptImpl:nrdp.mdx.encrypt,decryptImpl:nrdp.mdx.decrypt,hmacImpl:nrdp.mdx.hmac,endImpl:nrdp.mdx.endContext},e.contexts[i]=t,o.resolve(c)})}else nrdp.ntba.beginTransaction(nrdp.registration.currentDeviceAccount,"read",function(n){t={context:n,scope:nrdp.ntba,encryptImpl:nrdp.ntba.encrypt,decryptImpl:nrdp.ntba.decrypt,hmacImpl:nrdp.ntba.hmac,endImpl:nrdp.ntba.endTransaction},e.contexts[i]=t,o.resolve(c)})}catch(e){return r.reject(e)}return o.promise},this.encrypt=function(n,t){var o=e.contexts[n];if(!o)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=r.defer();try{o.encryptImpl.call(o.scope,o.context,t,function(e){s.isString(e)?e?i.resolve(e):i.reject(new u(u.ERRORS.CRYPTO_ERROR)):e.encrypted?i.resolve(e.data):i.reject(new u(u.ERRORS.CRYPTO_ERROR))})}catch(e){return r.reject(e)}return i.promise},this.decrypt=function(n,t){var o=e.contexts[n];if(!o)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=r.defer();try{o.decryptImpl.call(o.scope,o.context,t,function(e){i.resolve(e)})}catch(e){return r.reject(e)}return i.promise},this.hmac=function(n,t){var o=e.contexts[n];if(!o)return r.reject(new u(u.ERRORS.CRYPTO_ERROR,"Invalid security context"));var i=r.defer();try{o.hmacImpl.call(o.scope,o.context,t,function(e){i.resolve(e)})}catch(e){return r.reject(e)}return i.promise},this.endContext=function(n){var t=e.contexts[n];return t&&(t.endImpl.call(t.scope,t.context),delete e.contexts[n]),r.resolve()},this};h.prototype=Object.create(p.prototype);var m,y,R,S,I=function(){return void 0!==nrdp.mdx.beginContext?S||(S=new v):R||(R=new h)},A=function(){return m||(m=new g)},T=function(){return y||(y=new E)},N=function(){return R||(R=new h)},O={2:I,3:A,4:T,5:T,6:I,8:N};n.exports={get platformCrypto(){return d},set platformCrypto(e){d=e},createSecurityProvider:function(e){var n=O[e.id];if(n)return n();throw new u(u.ERRORS.PLATFORM_SUPPORT_ERROR,"Cannot create security provider for platform: "+e.name)}}},{"../../builds/ld.js":1,"../mdxError.js":44,"../profiling/mdxProfiler.js":45,"./validation.js":66,"nf-base64":3,"nf-utf8":4,q:5}],66:[function(e,n,t){var r=e("../../builds/ld.js"),o=e("../logging/logger.js"),i=function(e){return null!==/^(?:[0-9])+.(?:[0-9])+$/.exec(e)},s=function(e){return null!==/^-?\d{1,}$/.exec(e)},c=function(e){var n=/^(https?|wss?|cast?):\/\/(.*\@.*)?([a-z0-9]+[a-z0-9\.]*|\[[a-f0-9]{0,4}\:[a-f0-9]{0,4}\:[a-f0-9]{0,4}\:[a-f0-9]{0,4}\:[a-f0-9]{0,4}\:[a-f0-9]{0,4}\:[a-f0-9]{0,4}\:[a-f0-9]{0,4}\])(\:([^$\/]+))?(\/[a-z0-9\/\.\_\-\~\%]*)?(\#.*)?(\?.*)?/i,t=/\.\.+/,r=n.exec(e)||[],o=r[1],i=r[2],s=r[3],c=r[4],a=r[5],u=r[6],d=r[7],l=r[8],f=!c||isFinite(a);return o&&!i&&s&&f&&!d&&!l&&!t.test(u)},a=function(e){return!/[^\ -~]/.test(e)},u=function(e){return!/[^A-Za-z0-9\+\/\=]/.test(e)},d=function(e){return!/[^A-Za-z0-9\+\/\=,]/.test(e)},l={pairingrequest:{fields:{action:a,version:i,nonce:s,controllerurl:c,controlleruuid:a,pairdatahmac:u,cticket:d},isResponse:!1},pairingresponse:{fields:{action:a,version:i,nonce:s,controllersharedsecret:a,targetuuid:a,targetuserid:a,controlleruuid:a,controlleruserid:a,grantdatahmac:u},isResponse:!0},regpairrequest:{fields:{action:a,nonce:s,pin:u,cticket:d,hmac:u,version:i,controlleruuid:a,controllerurl:c,pairdatahmac:{optional:!0,validator:u}},isResponse:!1},regpairreply:{fields:{action:a,nonce:s,userid:a,controllersharedsecret:a,grantdatahmac:u,version:i,targetuuid:a},isResponse:!0},regpairerror:{fields:{action:a,nonce:s,version:i,targetuuid:a,errorcode:a,errorstring:a},isResponse:!0},pairingresponseError:{fields:{action:a,version:i,nonce:s,targetuuid:a,targetuserid:a,errorcode:a,errorstring:a},isResponse:!0},session:{fields:{action:a,version:i,nonce:s,fromurl:c,fromuuid:a,fromuserid:a,touuid:a,touserid:a,hmac:u,plaintext:{optional:!0,validator:a},ciphertext:{optional:!0,validator:u}},isResponse:!1},pingsearch:{fields:{action:a,fromuuid:a,fromurl:c,servicetype:a,id:a},isResponse:!1},pingresponse:{fields:{action:a,friendlyname:u,fromurl:c,fromuuid:a,responseheaders:a,servicetype:a,touuid:a,id:a},isResponse:!0},error:{fields:{action:a,nonce:s,fromuuid:a,touuid:a,errorcode:a,errorstring:a},isResponse:!0},broadcast:{fields:{action:a,nonce:s,fromuuid:a,fromurl:c,messageType:a,payload:{optional:!0,validator:a}},isResponse:!1}},f=function e(n,t,o){var i,s;r.isString(t)?(i=t.indexOf("."),s=t.indexOf("[")):(i=-1,s=-1);var c;if(i>=0&&(s<0||i<s))return i>0?(c=t.substring(0,i),n.hasOwnProperty(c)||(n[c]={}),n[c]=e(n[c],t.slice(i+1),o),n):(n||(n={}),n=e(n,t.slice(i+1),o));if(!(s>0))return t&&(n[t]=o),n;var a=t.indexOf("]");if(a>0){c=t.substring(0,s);var u=parseInt(t.substr(s+1,a-1),10);if(n.hasOwnProperty(c)||(n[c]=[]),!isNaN(u)){var d=t.slice(a+1);""!==d?n[c][u]=e(n[c][u],d,o):n[c]=e(n[c],u.toString(),o)}return n}return null},p=function(e){return r.reduce(r.map(e.split("\r\n"),function(e){var n=e.indexOf("=");return-1===n?null:[e.substr(0,n),e.substr(n+1)]}),function(e,n){return n?f(e,n[0],n[1]):e},{})},v=function(e){if(!e)return o.warn("No message payload to parse and validate"),null;var n=p(e),t=r.zipObject(r.map(n,function(e,n){return[n,!0]})),i=n.action;if("pairingresponse"===i&&(n.hasOwnProperty("errorstring")||n.hasOwnProperty("errorcode"))&&(n.action=i="pairingresponseError"),!l[i])return o.warn("Unknown command received. Messge dropped",e),null;var s=r.findKey(l[i].fields,function(o,i){if(!n.hasOwnProperty(i)&&!o.optional)return!0;var s=n[i];delete t[i];var c;if(r.isFunction(o))c=o(s);else{c=e.hasOwnProperty(i)?o.validator(s):o.optional}return!c});return s?(o.warn("Message failed validation due to invalid field or missing field: "+s,e),null):r.isEqual(t,{})?n:(o.warn("Message failed validation due to unexpected fields",r.keys(t)),null)},g=function e(n,t,o){var i,s,c,a=!1;return r.isArray(n)?(o<5&&(r.forEach(n,function(n,r){i=t?[t,"[",r,"]"].join(""):r,s=e(n,i,o+1),c=[c,s].join(""),a=!0}),a||(c=t?[t,"[]=","\r\n"].join(""):null)),c):r.isNull(n)||"object"!=typeof n?[t,"=",n,"\r\n"].join(""):(o<5&&(r.forEach(n,function(n,r){i=t?[t,r].join("."):r,s=e(n,i,o+1),c=[c,s].join(""),a=!0}),a||(c=t?[t,".=","\r\n"].join(""):null)),c)},E=function(e){return g(e,null,0)},h=function(e){var n=r.map(e,function(e,n){return n+"="+encodeURIComponent(e)});return r.sortBy(n,function(e){return e}).join("&")};n.exports={parsePairedPayload:p,parseAndValidateMsg:v,processOutgoingMessage:E,canonicalForm:h},n.exports.versionValidator=i,n.exports.numberValidator=s,n.exports.urlValidator=c,n.exports.asciiValidator=a,n.exports.base64Validator=u,n.exports.cticketValidator=d},{"../../builds/ld.js":1,"../logging/logger.js":38}],67:[function(e,n,t){var r,o=e("q"),i=e("../builds/ld.js"),s=(e("./logging/logger.js"),e("./mdxError.js")),c=function(){};c.prototype.setMdxId=function(e){return this.setItem("MDX_USERID",e||"")},c.prototype.getMdxId=function(){return this.getItem("MDX_USERID")},c.prototype.setProfileId=function(e){return this.setItem("MDX_PROFILEID",e||"")},c.prototype.getProfileId=function(){return this.getItem("MDX_PROFILEID")||null},c.prototype.storeDeviceMap=function(e){var n=o.defer(),t=this;return t.retrieveDeviceMapData().done(function(r){try{i.isPlainObject(r)||(r={});var o=i.map(e,function(e){return e.getPersistentData()});i.forEach(o,function(e){e&&e.id&&(r[e.id]?i.forEach(e,function(n,t){i.isUndefined(n)||(r[e.id][t]=n)}):r[e.id]=e)}),r=i.reduce(i.take(i.sortBy(r,function(e){return-e.lastSeen}),32),function(e,n){return e[n.id]=n,e},{}),t.setItem("MDX_REMOTE_DEVICE_MAP",JSON.stringify(r)).done(n.resolve,n.reject)}catch(e){n.resolve()}},n.reject),n.promise},c.prototype.clearPairings=function(){var e=o.defer(),n=this;return n.retrieveDeviceMapData().done(function(t){try{i.isPlainObject(t)||(t={}),i.forEach(t,function(e){e.sharedSecret=null,e.currentMdxId=null}),n.setItem("MDX_REMOTE_DEVICE_MAP",JSON.stringify(t)).done(e.resolve,e.reject)}catch(n){e.reject()}},e.reject),e.promise},c.prototype.retrieveDeviceMapData=function(){var e=o.defer();try{this.getItem("MDX_REMOTE_DEVICE_MAP").done(function(n){var t=n?JSON.parse(n):{};e.resolve(t)},function(){e.resolve({})})}catch(e){return o.resolve({})}return e.promise},c.prototype.reset=function(){var e=this;return e.setItem("MDX_REMOTE_DEVICE_MAP",JSON.stringify({})).then(e.setMdxId).then(e.setProfileId)};var a=function(){c.call(this);var n=i.isUndefined(localStorage)?null:localStorage;r||(r=e("./configuration.js")),this.setItem=function(e,t){if(e){var i={id:r.current.profileId,data:t},s=i?JSON.stringify(i):"";n[e]=s}return o.resolve()},this.getItem=function(e){try{if(e){var t=n[e];if(t){var i=JSON.parse(t);return o.resolve(i.id===r.current.profileId?i.data:null)}}return o.resolve(null)}catch(e){return o.resolve(null)}}};a.prototype=Object.create(c.prototype);var u=function(){this.setItem=function(e,n){try{var t=nrdp.registration.currentDeviceAccount;if(t){var r=nrdp.storage.setItem(t,e,n);return o.resolve(r)}return o.resolve()}catch(e){return o.resolve()}},this.getItem=function(e){try{var n=nrdp.registration.currentDeviceAccount;if(n){var t=nrdp.storage.getItem(n,e);return o.resolve(t)}return o.resolve(null)}catch(e){return o.resolve(null)}}};u.prototype=Object.create(c.prototype);var d=function(){var e=function(){var e=o.defer();return WinJS.Application.local.readText("mdxdata.txt").done(function(n){var t=JSON.parse(n);t.id!==nrdp.registration.currentDeviceAccount&&(t={id:nrdp.registration.currentDeviceAccount,data:null}),e.resolve(t.data)},e.resolve(null)),e.promise};this.setItem=function(n,t){var r=o.defer();try{e.done(function(e){e.data[n]=t,WinJS.Application.local.writeText("mdxdata.txt",JSON.stringify(e)).done(r.resolve,r.reject)},r.reject)}catch(e){return o.reject(e)}return r.promise},this.getItem=function(n){var t=o.defer();try{e.done(function(e){t.resolve(e.data[n])},t.reject)}catch(e){return o.resolve(null)}return t.promise}};d.prototype=Object.create(c.prototype);var l,f,p,v=function(){return l||(l=new a)},g=function(){return f||(f=new u)},E=function(){return p||(p=new d)},h={2:g,3:g,4:v,5:E,6:g,8:g};n.exports={createStorageProvider:function(e){var n=h[e.id];if(n)return n();throw new s(s.ERRORS.PLATFORM_SUPPORT_ERROR,"Cannot create storage provider for platform: "+e.name)}}},{"../builds/ld.js":1,"./configuration.js":7,"./logging/logger.js":38,"./mdxError.js":44,q:5}],68:[function(e,n,t){var r=function(e){};n.exports=r},{}],69:[function(e,n,t){n.exports={}},{"../discovery/discoveryComponent.js":27,"../test/mockMdxTarget.js":70,q:5}],70:[function(e,n,t){var r=e("../test/mockMdxTarget.js"),o=e("./mockTargetSession.js"),i=function(e,n){var t=this;return r.call(t,e,n,o),t};i.prototype=Object.create(r.prototype),n.exports=i},{"../test/mockMdxTarget.js":70,"./mockTargetSession.js":71}],71:[function(e,n,t){var r=e("../session/mdxTargetSession.js"),o=e("../versionInfo.js"),i=function(){return r.call(this,new o),this};i.prototype=Object.create(r.prototype),n.exports=i},{"../session/mdxTargetSession.js":59,"../versionInfo.js":74}],72:[function(e,n,t){var r,o,i,s,c,a,u,d,l,f,p,v,g,E,h,m},{"../../builds/ld.js":1,"../configuration.js":7,"../discovery/discoveryConfig.js":28,"../enums.js":33,"../logging/consoleLogSink.js":37,"../logging/logger.js":38,"../mdxError.js":44,"./webSocketTestChannel.js":73}],73:[function(e,n,t){},{"../../builds/ld.js":1,"../enums.js":33,"../logging/bufferedWebSocketLogSink.js":36,"../logging/logger.js":38,"../mdxError.js":44,
"../schedulerFactory.js":48,"../webSocketFactory.js":75}],74:[function(e,n,t){var r=e("../builds/ld.js"),o=/^([0-9]+)(?:\.([0-9]+))?(?:\.([0-9]+))?(?:-([\w\.]+))*$/,i=function(e){var n=0,t=0,i=0,s="";if(r.isString(e)){var c=o.exec(e);c&&(n=parseInt(c[1])||n,t=parseInt(c[2])||t,i=parseInt(c[3])||i,s=c[4]||s)}else r.isPlainObject(e)&&(n=e.major||0,t=e.minor||0,i=e.revision||0,s=e.build||"");return Object.defineProperties(this,{major:{enumerable:!0,value:n},minor:{enumerable:!0,value:t},revision:{enumerable:!0,value:i},build:{enumerable:!0,value:s}}),this};i.prototype.toString=function(){var e=this.major+"."+this.minor+"."+this.revision;return this.build&&(e=e+"-"+this.build),e},i.prototype.matches=function(e,n,t,o){var i=this;return i.major===e&&i.minor===n&&i.revision===t&&r.isUndefined(o)||i.build===o},i.prototype.isGreaterThan=function(e,n,t){var r=this;return r.major>e||r.major===e&&r.minor>n||r.major===e&&r.minor===n&&r.revision>t},i.prototype.isGreaterThanOrEqual=function(e,n,t){var r=this;return r.matches(e,n,t)||r.isGreaterThan(e,n,t)},n.exports=i},{"../builds/ld.js":1}],75:[function(e,n,t){var r=e("./mdxError.js"),o=function(e,n){try{return n?new window.WebSocket(e,"mdx"):new window.WebSocket(e)}catch(e){return}},i=function(e,n){try{return n?new nrdp.WebSocket(e,"mdx"):new nrdp.WebSocket(e)}catch(e){return}},s=function(e,n){var t,o=this,i=new Windows.Networking.Sockets.MessageWebSocket;i.control.messageType=Windows.Networking.Sockets.SocketMessageType.utf8,n&&i.control.supportedProtocols.append("mdx"),i.onmessagereceived=function(e){if(o.onmessage){var n=e.getDataReader();o.onmessage(n.readString(n.unconsumedBufferLength))}},i.onclosed=function(){o.onclosed&&o.onclosed.apply(null,arguments)},this.close=i.close,this.send=function(e){if(!t)throw new r(r.ERRORS.PLATFORM_SUPPORT_ERROR,"WinJS websocket write failure");return t.writeString(e),t.storeAsync()};var s=new Windows.Foundation.Uri(e);i.connectAsync(s).done(function(){t=new Windows.Storage.Streams.DataWriter(i.outputStream),o.onopen&&o.onopen()},function(e){o.onerror&&o.onerror(e)})},c=function(e,n){try{return new s(e,n)}catch(e){return}},a={2:i,3:o,4:o,5:c,6:i};n.exports={createWebSocket:function(e,n,t){if(!n)throw new r(r.ERRORS.INVALID_ARG,"Invalid url for createWebSocket");var o=a[e.id];if(o)return o(n,t);throw new r(r.ERRORS.PLATFORM_SUPPORT_ERROR,"Cannot create a websocket connection for platform: "+e.name)}}},{"./mdxError.js":44}]},{},[42]),n}()});C.r("mdx2/mdx2.js",function(s,t,x){"use strict";s("./mdx2Manager.js"),s("./components/mdxControls.jsx"),s("./hoc/mdxTargetData.jsx")});!function(o){"use strict";if(!(o&&o.C&&o.C.k))throw new Error("[Codex] Codex bootstrap not loaded!");o.C.k()}(window);